---
title: Premiers pas
locale: fr
description: Apprenez à installer et utiliser le plugin NFC pour lire et écrire des balises NFC dans votre application Capacitor.
sidebar:
  order: 2
---

import { Steps } from '@astrojs/starlight/components';
import { PackageManagers } from 'starlight-package-managers'

<Steps>
1. **Installer le package**
   <PackageManagers pkg="@capgo/capacitor-nfc" pkgManagers={['npm', 'pnpm', 'yarn', 'bun']} />

2. **Synchroniser avec les projets natifs**
   <PackageManagers type="exec" pkg="cap" args="sync" pkgManagers={['npm', 'pnpm', 'yarn', 'bun']} />
</Steps>

## Configuration

### Configuration iOS

Ajoutez la description d'utilisation NFC à votre `Info.plist` :

```xml
<key>NFCReaderUsageDescription</key>
<string>Cette application a besoin d'un accès NFC pour lire et écrire des balises</string>
```

Activez la capacité Near Field Communication Tag Reading dans votre projet Xcode.

### Configuration Android

Ajoutez la permission NFC à votre `AndroidManifest.xml` :

```xml
<manifest>
  <uses-permission android:name="android.permission.NFC" />
  <uses-feature android:name="android.hardware.nfc" android:required="false" />
</manifest>
```

## Utilisation

### Démarrer la numérisation des balises NFC

```typescript
import { CapacitorNfc } from '@capgo/capacitor-nfc';

await CapacitorNfc.startScanning({
  invalidateAfterFirstRead: false, // Garder la session ouverte (iOS)
  alertMessage: 'Maintenez une balise près du haut de votre appareil.',
});

const listener = await CapacitorNfc.addListener('nfcEvent', (event) => {
  console.log('Balise détectée:', event.type);
  console.log('ID de la balise:', event.tag?.id);
  console.log('Message NDEF:', event.tag?.ndefMessage);
});
```

### Lire une balise NFC

```typescript
await CapacitorNfc.addListener('nfcEvent', (event) => {
  if (event.tag?.ndefMessage) {
    event.tag.ndefMessage.forEach(record => {
      console.log('TNF:', record.tnf);
      console.log('Type:', record.type);
      console.log('Payload:', record.payload);

      // Décoder un enregistrement texte
      if (record.tnf === 1 && record.type[0] === 0x54) { // Enregistrement texte
        const langLen = record.payload[0] & 0x3f;
        const text = new TextDecoder().decode(
          new Uint8Array(record.payload.slice(langLen + 1))
        );
        console.log('Texte:', text);
      }
    });
  }
});
```

### Écrire sur une balise NFC

```typescript
// Préparer un enregistrement texte
const encoder = new TextEncoder();
const langBytes = Array.from(encoder.encode('fr'));
const textBytes = Array.from(encoder.encode('Bonjour NFC'));
const payload = [langBytes.length & 0x3f, ...langBytes, ...textBytes];

await CapacitorNfc.write({
  allowFormat: true,
  records: [
    {
      tnf: 0x01, // TNF bien connu
      type: [0x54], // 'T' pour Texte
      id: [],
      payload,
    },
  ],
});

console.log('Balise écrite avec succès');
```

### Écrire une URL sur une balise NFC

```typescript
const url = 'https://capgo.app';
const urlBytes = Array.from(new TextEncoder().encode(url));

await CapacitorNfc.write({
  allowFormat: true,
  records: [
    {
      tnf: 0x01, // TNF bien connu
      type: [0x55], // 'U' pour URI
      id: [],
      payload: [0x01, ...urlBytes], // 0x01 = https://
    },
  ],
});
```

### Effacer une balise NFC

```typescript
await CapacitorNfc.erase();
console.log('Balise effacée');
```

### Rendre une balise en lecture seule

```typescript
await CapacitorNfc.makeReadOnly();
console.log('La balise est maintenant en lecture seule');
```

### Arrêter la numérisation

```typescript
await listener.remove();
await CapacitorNfc.stopScanning();
```

### Vérifier le statut NFC

```typescript
const { status } = await CapacitorNfc.getStatus();
console.log('Statut NFC:', status);
// Valeurs possibles : 'NFC_OK', 'NO_NFC', 'NFC_DISABLED', 'NDEF_PUSH_DISABLED'

if (status === 'NFC_DISABLED') {
  // Ouvrir les paramètres système
  await CapacitorNfc.showSettings();
}
```

### Android Beam (Partage P2P)

```typescript
// Partager des données via Android Beam
const message = {
  records: [
    {
      tnf: 0x01,
      type: [0x54], // Texte
      id: [],
      payload: [/* charge utile d'enregistrement texte */],
    },
  ],
};

await CapacitorNfc.share(message);

// Plus tard, arrêter le partage
await CapacitorNfc.unshare();
```

## Référence API

### startScanning(options?)

Démarrer l'écoute des balises NFC.

```typescript
interface StartScanningOptions {
  invalidateAfterFirstRead?: boolean; // iOS uniquement, par défaut à true
  alertMessage?: string; // iOS uniquement
  androidReaderModeFlags?: number; // Android uniquement
}

await CapacitorNfc.startScanning(options);
```

### stopScanning()

Arrêter la session de numérisation NFC.

```typescript
await CapacitorNfc.stopScanning();
```

### write(options)

Écrire des enregistrements NDEF sur la dernière balise découverte.

```typescript
interface WriteTagOptions {
  records: NdefRecord[];
  allowFormat?: boolean; // Par défaut à true
}

interface NdefRecord {
  tnf: number; // Format de nom de type
  type: number[]; // Type d'enregistrement
  id: number[]; // ID d'enregistrement
  payload: number[]; // Charge utile d'enregistrement
}

await CapacitorNfc.write(options);
```

### erase()

Effacer la dernière balise découverte.

```typescript
await CapacitorNfc.erase();
```

### makeReadOnly()

Rendre la dernière balise découverte en lecture seule (permanent).

```typescript
await CapacitorNfc.makeReadOnly();
```

### share(options)

Partager un message NDEF via Android Beam (Android uniquement).

```typescript
await CapacitorNfc.share({ records: [...] });
```

### unshare()

Arrêter le partage (Android uniquement).

```typescript
await CapacitorNfc.unshare();
```

### getStatus()

Obtenir le statut actuel de l'adaptateur NFC.

```typescript
const { status } = await CapacitorNfc.getStatus();
// Retourne : 'NFC_OK' | 'NO_NFC' | 'NFC_DISABLED' | 'NDEF_PUSH_DISABLED'
```

### showSettings()

Ouvrir les paramètres NFC du système.

```typescript
await CapacitorNfc.showSettings();
```

## Événements

### nfcEvent

Déclenché lorsqu'une balise NFC est découverte.

```typescript
interface NfcEvent {
  type: 'tag' | 'ndef' | 'ndef-mime' | 'ndef-formattable';
  tag?: NfcTag;
}

interface NfcTag {
  id: number[];
  techTypes: string[];
  type: string | null;
  maxSize: number | null;
  isWritable: boolean | null;
  canMakeReadOnly: boolean | null;
  ndefMessage: NdefRecord[] | null;
}
```

### nfcStateChange

Déclenché lorsque la disponibilité de l'adaptateur NFC change (Android uniquement).

```typescript
interface NfcStateChangeEvent {
  status: NfcStatus;
  enabled: boolean;
}
```

## Exemple complet

```typescript
import { CapacitorNfc } from '@capgo/capacitor-nfc';

export class NfcService {
  private listener: any;

  async startReading() {
    // Vérifier le statut NFC
    const { status } = await CapacitorNfc.getStatus();

    if (status === 'NO_NFC') {
      throw new Error('NFC non disponible sur cet appareil');
    }

    if (status === 'NFC_DISABLED') {
      await CapacitorNfc.showSettings();
      return;
    }

    // Démarrer la numérisation
    await CapacitorNfc.startScanning({
      invalidateAfterFirstRead: false,
      alertMessage: 'Prêt à scanner les balises NFC',
    });

    // Écouter les balises
    this.listener = await CapacitorNfc.addListener('nfcEvent', (event) => {
      this.handleNfcEvent(event);
    });
  }

  private handleNfcEvent(event: any) {
    console.log('Événement NFC:', event.type);

    if (event.tag?.ndefMessage) {
      event.tag.ndefMessage.forEach(record => {
        this.processRecord(record);
      });
    }
  }

  private processRecord(record: any) {
    // Traiter les enregistrements texte
    if (record.tnf === 1 && record.type[0] === 0x54) {
      const langLen = record.payload[0] & 0x3f;
      const text = new TextDecoder().decode(
        new Uint8Array(record.payload.slice(langLen + 1))
      );
      console.log('Texte:', text);
    }

    // Traiter les enregistrements URI
    if (record.tnf === 1 && record.type[0] === 0x55) {
      const uriCode = record.payload[0];
      const uri = new TextDecoder().decode(
        new Uint8Array(record.payload.slice(1))
      );
      console.log('URI:', uri);
    }
  }

  async writeText(text: string) {
    const encoder = new TextEncoder();
    const langBytes = Array.from(encoder.encode('fr'));
    const textBytes = Array.from(encoder.encode(text));
    const payload = [langBytes.length & 0x3f, ...langBytes, ...textBytes];

    await CapacitorNfc.write({
      allowFormat: true,
      records: [
        {
          tnf: 0x01,
          type: [0x54],
          id: [],
          payload,
        },
      ],
    });
  }

  async stopReading() {
    if (this.listener) {
      await this.listener.remove();
    }
    await CapacitorNfc.stopScanning();
  }
}
```

## Types d'enregistrement NDEF

### TNF (Format de nom de type)

- `0x00` : Vide
- `0x01` : Bien connu (par exemple, Texte, URI)
- `0x02` : Type de média MIME
- `0x03` : URI absolu
- `0x04` : Type externe
- `0x05` : Inconnu
- `0x06` : Inchangé
- `0x07` : Réservé

### Types d'enregistrement courants

- **Texte** : `type: [0x54]` ('T')
- **URI** : `type: [0x55]` ('U')
- **Smart Poster** : `type: [0x53, 0x70]` ('Sp')

### Préfixes URI

- `0x00` : (pas de préfixe)
- `0x01` : `https://`
- `0x02` : `https://`
- `0x03` : `http://`
- `0x04` : `https://www.`

## Bonnes pratiques

1. **Vérifier le statut NFC** : Toujours vérifier que le NFC est disponible et activé
2. **Gérer les permissions** : Demander les permissions NFC de manière appropriée
3. **Arrêter la numérisation** : Toujours arrêter la numérisation lorsque terminé pour économiser la batterie
4. **Gestion des erreurs** : Envelopper les opérations NFC dans des blocs try-catch
5. **Tester sur les appareils** : Les fonctionnalités NFC ne fonctionnent pas sur les simulateurs/émulateurs

## Notes de plateforme

### iOS
- Nécessite iOS 11.0+
- Utilise le framework Core NFC
- Prend en charge la lecture de balises en arrière-plan (iOS 13+)
- Limité à la lecture de balises formatées NDEF
- Ne peut pas écrire de balises en arrière-plan
- Nécessite NFCReaderUsageDescription dans Info.plist

### Android
- Nécessite Android 4.4 (API 19)+
- Utilise l'API Android NFC
- Prend en charge la lecture de balises en premier plan et en arrière-plan
- Peut écrire sur les balises
- Prend en charge Android Beam (P2P) sur les appareils avec NFC
- Nécessite la permission NFC dans AndroidManifest.xml

### Web
- Non pris en charge sur la plateforme web
