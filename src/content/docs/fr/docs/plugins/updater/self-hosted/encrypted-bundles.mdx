---
title: "Bundles chiffrés"
locale: fr
description: "Un guide complet sur l'utilisation du plugin de mise à jour manuelle dans un environnement auto-hébergé, détaillant les étapes et les processus impliqués dans la gestion des bundles chiffrés pour des mises à jour sécurisées et efficaces."
sidebar:
  order: 5
---
import { LinkCard, CardGrid } from '@astrojs/starlight/components';

## Chiffrement de bout en bout

À partir de la version 4.15.0, le plugin vous permet d'envoyer des mises à jour chiffrées.

### Étape 1 : Créer une clé privée
```bash title='Créer une clé privée'
npx @capgo/cli key create
```

### Étape 2 : Créer et zipper votre bundle
```bash title="Créer un bundle zip avec checksum"
npx @capgo/cli bundle zip [appId] --key-v2 --json
```

Le flag `--key-v2` utilise le nouveau système de chiffrement avec de meilleurs checksums, et le flag `--json` affichera les informations du bundle incluant le checksum dont vous aurez besoin pour le chiffrement.

### Étape 3 : Chiffrer votre bundle
```bash title="Chiffrer le zip bundlé avec checksum"
npx @capgo/cli encrypt [chemin/vers/zip] [checksum]
```

Le paramètre `checksum` est le checksum SHA256 généré par la commande zip à l'étape 2. La commande encrypt retournera une `ivSessionKey` et générera un checksum chiffré. N'oubliez pas de renommer la clé `ivSessionKey` en `session_key` dans le payload de mise à jour.

### Étape 4 : Utiliser dans votre payload de mise à jour
```json
{
"version": "1.2.3",
"url": "https://monserveur.com/app/updates/ma-nouvelle-app-2.0.0.zip",
"session_key": "cle_session_chiffree",
"checksum": "checksum_chiffre_de_la_commande_encrypt"
}
```

La `session_key` est la `ivSessionKey` retournée par la commande encrypt, et le `checksum` est le checksum chiffré généré pendant le chiffrement (pas le checksum original de la commande zip).

Ensuite, votre application pourra utiliser la clé privée pour déchiffrer la `session_key` et utiliser la `session_key` déchiffrée pour déchiffrer la mise à jour. Le checksum chiffré garantit la vérification de l'intégrité du bundle.

## En savoir plus

<CardGrid>
<LinkCard
	title="Guide du chiffrement de bout en bout"
	href="https://capgo.app/blog/introducing-end-to-end-security-to-capacitor-updater-with-code-signing/"
	description="Plongée en profondeur dans le fonctionnement du système de chiffrement de Capgo avec la cryptographie RSA + AES"
/>
<LinkCard
	title="Mises à jour en direct auto-hébergées"
	href="https://capgo.app/blog/self-hosted-live-updates/"
	description="Flux de travail complet pour configurer les mises à jour auto-hébergées"
/>
</CardGrid>
