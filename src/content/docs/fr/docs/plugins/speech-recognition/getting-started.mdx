---
title: Commencer
locale: fr
description: Apprenez à installer et utiliser le plugin Speech Recognition pour ajouter la transcription vocale à votre application Capacitor
sidebar:
  order: 2
---

import { Steps } from '@astrojs/starlight/components';
import { PackageManagers } from 'starlight-package-managers'

<Steps>
1. **Installer le package**
   <PackageManagers pkg="@capgo/capacitor-speech-recognition" pkgManagers={['npm', 'pnpm', 'yarn', 'bun']} />

2. **Synchroniser avec les projets natifs**
   <PackageManagers type="exec" pkg="cap" args="sync" pkgManagers={['npm', 'pnpm', 'yarn', 'bun']} />

3. **Configurer les permissions de la plateforme** (voir ci-dessous)
</Steps>

## Configuration de la plateforme

### iOS

Ajoutez les clés suivantes au fichier `Info.plist` de votre application :

```xml
<key>NSSpeechRecognitionUsageDescription</key>
<string>Nous avons besoin d'accéder à la reconnaissance vocale pour transcrire votre voix</string>
<key>NSMicrophoneUsageDescription</key>
<string>Nous avons besoin d'accéder à votre microphone pour enregistrer l'audio pour la transcription</string>
```

### Android

Le plugin ajoute automatiquement la permission `RECORD_AUDIO` requise à votre `AndroidManifest.xml`. Aucune configuration supplémentaire n'est nécessaire.

## Utilisation de base

### Vérifier la disponibilité

Avant d'utiliser la reconnaissance vocale, vérifiez si elle est disponible sur l'appareil :

```typescript
import { SpeechRecognition } from '@capgo/capacitor-speech-recognition';

const checkAvailability = async () => {
  const { available } = await SpeechRecognition.available();
  if (!available) {
    console.warn('La reconnaissance vocale n\'est pas prise en charge sur cet appareil');
    return false;
  }
  return true;
};
```

### Demander les permissions

Demandez les permissions nécessaires avant de commencer la reconnaissance :

```typescript
const requestPermissions = async () => {
  const { speechRecognition } = await SpeechRecognition.requestPermissions();

  if (speechRecognition === 'granted') {
    console.log('Permission accordée');
    return true;
  } else {
    console.log('Permission refusée');
    return false;
  }
};
```

### Démarrer la reconnaissance

Commencez à écouter la parole avec une configuration optionnelle :

```typescript
// Utilisation de base
await SpeechRecognition.start({
  language: 'fr-FR',
  maxResults: 3,
  partialResults: true,
});

// Avec toutes les options
await SpeechRecognition.start({
  language: 'fr-FR',
  maxResults: 5,
  prompt: 'Parlez maintenant...',          // Android uniquement
  popup: false,                     // Android uniquement
  partialResults: true,
  addPunctuation: true,             // iOS 16+ uniquement
  allowForSilence: 2000,            // Android uniquement, millisecondes
});
```

### Écouter les résultats

Abonnez-vous aux résultats partiels pendant que la reconnaissance est active :

```typescript
const partialListener = await SpeechRecognition.addListener(
  'partialResults',
  (event) => {
    const transcription = event.matches?.[0];
    console.log('Résultat partiel :', transcription);
  }
);

// N'oubliez pas de supprimer l'écouteur quand vous avez terminé
await partialListener.remove();
```

### Arrêter la reconnaissance

Arrêtez l'écoute et nettoyez les ressources :

```typescript
await SpeechRecognition.stop();
```

## Exemple complet

Voici un exemple complet montrant comment utiliser le plugin :

```typescript
import { SpeechRecognition } from '@capgo/capacitor-speech-recognition';

export class VoiceRecognitionService {
  private partialListener: any = null;
  private isListening = false;

  async initialize(): Promise<boolean> {
    // Vérifier la disponibilité
    const { available } = await SpeechRecognition.available();
    if (!available) {
      throw new Error('Reconnaissance vocale non disponible');
    }

    // Demander les permissions
    const { speechRecognition } = await SpeechRecognition.requestPermissions();
    if (speechRecognition !== 'granted') {
      throw new Error('Permission refusée');
    }

    return true;
  }

  async startListening(
    onPartialResult: (text: string) => void,
    onFinalResult: (text: string) => void
  ): Promise<void> {
    if (this.isListening) {
      console.warn('Déjà en écoute');
      return;
    }

    try {
      // Configurer l'écouteur de résultats partiels
      this.partialListener = await SpeechRecognition.addListener(
        'partialResults',
        (event) => {
          const text = event.matches?.[0] || '';
          onPartialResult(text);
        }
      );

      // Démarrer la reconnaissance
      const result = await SpeechRecognition.start({
        language: 'fr-FR',
        maxResults: 3,
        partialResults: true,
        addPunctuation: true,
      });

      this.isListening = true;

      // Gérer le résultat final si partialResults est false
      if (result.matches && result.matches.length > 0) {
        onFinalResult(result.matches[0]);
      }
    } catch (error) {
      console.error('Erreur lors du démarrage de la reconnaissance vocale :', error);
      throw error;
    }
  }

  async stopListening(): Promise<void> {
    if (!this.isListening) {
      return;
    }

    try {
      await SpeechRecognition.stop();

      // Nettoyer l'écouteur
      if (this.partialListener) {
        await this.partialListener.remove();
        this.partialListener = null;
      }

      this.isListening = false;
    } catch (error) {
      console.error('Erreur lors de l\'arrêt de la reconnaissance vocale :', error);
      throw error;
    }
  }

  async getSupportedLanguages(): Promise<string[]> {
    const { languages } = await SpeechRecognition.getSupportedLanguages();
    return languages;
  }

  async checkListeningState(): Promise<boolean> {
    const { listening } = await SpeechRecognition.isListening();
    return listening;
  }
}
```

## Référence API

### available()

Vérifie si le service de reconnaissance vocale natif est utilisable sur l'appareil actuel.

```typescript
const result = await SpeechRecognition.available();
// Retourne : { available: boolean }
```

### start(options?)

Commence à capturer l'audio et à transcrire la parole.

```typescript
interface SpeechRecognitionStartOptions {
  language?: string;          // Identifiant de locale (ex. : 'fr-FR')
  maxResults?: number;        // Nombre maximum de résultats (par défaut : 5)
  prompt?: string;            // Android uniquement : Invite de dialogue
  popup?: boolean;            // Android uniquement : Afficher le dialogue système
  partialResults?: boolean;   // Diffuser les résultats partiels
  addPunctuation?: boolean;   // iOS 16+ uniquement : Ajouter la ponctuation
  allowForSilence?: number;   // Android uniquement : Délai de silence en ms
}

const result = await SpeechRecognition.start(options);
// Retourne : { matches?: string[] }
```

### stop()

Arrête l'écoute et nettoie les ressources natives.

```typescript
await SpeechRecognition.stop();
```

### getSupportedLanguages()

Obtient les locales prises en charge par le reconnaisseur sous-jacent.

**Note** : Les appareils Android 13+ n'exposent plus cette liste ; dans ce cas `languages` sera vide.

```typescript
const result = await SpeechRecognition.getSupportedLanguages();
// Retourne : { languages: string[] }
```

### isListening()

Retourne si le plugin écoute activement la parole.

```typescript
const result = await SpeechRecognition.isListening();
// Retourne : { listening: boolean }
```

### checkPermissions()

Obtient l'état actuel des permissions.

```typescript
const result = await SpeechRecognition.checkPermissions();
// Retourne : { speechRecognition: 'prompt' | 'prompt-with-rationale' | 'granted' | 'denied' }
```

### requestPermissions()

Demande les permissions de microphone et de reconnaissance vocale.

```typescript
const result = await SpeechRecognition.requestPermissions();
// Retourne : { speechRecognition: 'prompt' | 'prompt-with-rationale' | 'granted' | 'denied' }
```

## Écouteurs d'événements

### partialResults

Écoute les mises à jour de transcription partielle pendant que `partialResults` est activé.

```typescript
const listener = await SpeechRecognition.addListener(
  'partialResults',
  (event: { matches: string[] }) => {
    console.log('Partiel :', event.matches?.[0]);
  }
);
```

### segmentResults (Android uniquement)

Écoute les résultats de reconnaissance segmentés.

```typescript
const listener = await SpeechRecognition.addListener(
  'segmentResults',
  (event: { matches: string[] }) => {
    console.log('Segment :', event.matches?.[0]);
  }
);
```

### endOfSegmentedSession (Android uniquement)

Écoute les événements de fin de session segmentée.

```typescript
const listener = await SpeechRecognition.addListener(
  'endOfSegmentedSession',
  () => {
    console.log('Session segmentée terminée');
  }
);
```

### listeningState

Écoute les changements d'état d'écoute natif.

```typescript
const listener = await SpeechRecognition.addListener(
  'listeningState',
  (event: { status: 'started' | 'stopped' }) => {
    console.log('État d\'écoute :', event.status);
  }
);
```

### removeAllListeners()

Supprime tous les écouteurs enregistrés.

```typescript
await SpeechRecognition.removeAllListeners();
```

## Bonnes pratiques

1. **Toujours vérifier la disponibilité et les permissions**
   ```typescript
   const { available } = await SpeechRecognition.available();
   if (!available) return;

   const { speechRecognition } = await SpeechRecognition.requestPermissions();
   if (speechRecognition !== 'granted') return;
   ```

2. **Nettoyer les écouteurs**
   Supprimez toujours les écouteurs lorsqu'ils ne sont plus nécessaires pour éviter les fuites de mémoire :
   ```typescript
   await listener.remove();
   // ou
   await SpeechRecognition.removeAllListeners();
   ```

3. **Gérer les erreurs avec élégance**
   ```typescript
   try {
     await SpeechRecognition.start({ language: 'fr-FR' });
   } catch (error) {
     console.error('La reconnaissance vocale a échoué :', error);
     // Afficher un message d'erreur convivial
   }
   ```

4. **Fournir un retour visuel**
   Utilisez l'événement `listeningState` pour montrer aux utilisateurs quand l'application écoute activement.

5. **Tester avec différents accents et langues**
   La précision de la reconnaissance vocale varie selon la langue et l'accent. Testez minutieusement avec votre public cible.

## Notes de plateforme

### iOS
- Nécessite iOS 10.0+
- Utilise `SFSpeechRecognizer` natif
- Prend en charge la ponctuation sur iOS 16+
- Nécessite à la fois les permissions de microphone et de reconnaissance vocale
- La reconnaissance peut échouer si la langue de l'appareil ne correspond pas à la langue demandée

### Android
- Nécessite Android 6.0 (API 23)+
- Utilise l'API `SpeechRecognizer`
- Prend en charge les sessions segmentées avec détection de silence configurable
- Android 13+ n'expose pas la liste des langues prises en charge
- Certains appareils peuvent afficher l'interface utilisateur de reconnaissance système

### Web
- Support limité via l'API Web Speech
- Tous les navigateurs ne prennent pas en charge la reconnaissance vocale
- Nécessite une connexion HTTPS
- Peut avoir un comportement différent selon les navigateurs

## Dépannage

### Permission refusée
Si les permissions sont refusées, guidez les utilisateurs vers les paramètres de l'application :
```typescript
const { speechRecognition } = await SpeechRecognition.checkPermissions();
if (speechRecognition === 'denied') {
  // Afficher les instructions pour activer les permissions dans les Paramètres
}
```

### Aucun résultat retourné
- Vérifier que le microphone fonctionne
- Assurer un environnement calme
- Vérifier que le code de langue correspond aux capacités de l'appareil
- Vérifier la connexion réseau (certaines plateformes en ont besoin)

### La reconnaissance s'arrête de manière inattendue
- Utiliser `isListening()` pour vérifier l'état
- Écouter les événements `listeningState`
- Implémenter une logique de redémarrage automatique si nécessaire

## Prochaines étapes

- [Voir la référence API sur GitHub](https://github.com/Cap-go/capacitor-speech-recognition#api)
- [Signaler des problèmes](https://github.com/Cap-go/capacitor-speech-recognition/issues)
- [Explorer l'application exemple](https://github.com/Cap-go/capacitor-speech-recognition/tree/main/example)
