---
title: Premiers pas
locale: fr
description: Configurez Apple Pay et Google Pay pour votre paiement Capacitor avec le plugin Pay.
sidebar:
  order: 2
---

import { Steps } from '@astrojs/starlight/components';
import { PackageManagers } from 'starlight-package-managers'

<Steps>
1. **Installer le plugin**
   <PackageManagers pkg="@capgo/capacitor-pay" pkgManagers={['npm', 'pnpm', 'yarn', 'bun']} />

2. **Synchroniser les projets natifs**
   <PackageManagers type="exec" pkg="cap" args="sync" pkgManagers={['npm', 'pnpm', 'yarn', 'bun']} />
</Steps>

## Prérequis natifs

- **Apple Pay (iOS)**
  1. Créez un identifiant marchand Apple Pay dans le portail développeur Apple.
  2. Générez et téléchargez le certificat de traitement des paiements requis par votre passerelle.
  3. Activez la capacité **Apple Pay** dans Xcode et assurez-vous que votre profil de provisionnement l'inclut.
  4. Mettez à jour `Info.plist` avec une description d'utilisation si votre passerelle nécessite un accès réseau pour valider les paiements.

- **Google Pay (Android)**
  1. Connectez-vous à la [Console Business Google Pay](https://pay.google.com/business/console/).
  2. Configurez les paramètres de votre passerelle de paiement ou configurez la tokenisation directe pour les tests.
  3. Si vous prévoyez d'utiliser des cartes de production, passez `environment` à `PRODUCTION` et enregistrez des cartes de test pour l'assurance qualité.
  4. Confirmez que les services Google Play sont disponibles sur l'appareil (requis par Google Pay).

Consultez les guides sous `docs/` dans le dépôt du plugin pour des captures d'écran étape par étape.

## Vérifier la disponibilité

```typescript
import { Pay } from '@capgo/capacitor-pay';

const availability = await Pay.isPayAvailable({
  apple: { supportedNetworks: ['visa', 'masterCard', 'amex'] },
  google: {
    isReadyToPayRequest: {
      allowedPaymentMethods: [
        {
          type: 'CARD',
          parameters: {
            allowedAuthMethods: ['PAN_ONLY', 'CRYPTOGRAM_3DS'],
            allowedCardNetworks: ['VISA', 'MASTERCARD'],
          },
        },
      ],
    },
  },
});

if (!availability.available) {
  console.warn('Paiement natif non disponible:', availability);
}
```

## Demander un paiement (Apple Pay)

```typescript
const appleResult = await Pay.requestPayment({
  apple: {
    merchantIdentifier: 'merchant.com.example.app',
    countryCode: 'US',
    currencyCode: 'USD',
    supportedNetworks: ['visa', 'masterCard'],
    paymentSummaryItems: [
      { label: 'Plan Starter', amount: '9.99' },
      { label: 'Capgo Store', amount: '9.99' },
    ],
    requiredShippingContactFields: ['name', 'emailAddress'],
  },
});

const token = appleResult.apple?.paymentData;
```

## Demander un paiement (Google Pay)

```typescript
const googleResult = await Pay.requestPayment({
  google: {
    environment: 'test',
    paymentDataRequest: {
      apiVersion: 2,
      apiVersionMinor: 0,
      allowedPaymentMethods: [
        {
          type: 'CARD',
          parameters: {
            allowedAuthMethods: ['PAN_ONLY', 'CRYPTOGRAM_3DS'],
            allowedCardNetworks: ['VISA', 'MASTERCARD'],
            billingAddressRequired: true,
            billingAddressParameters: { format: 'FULL' },
          },
          tokenizationSpecification: {
            type: 'PAYMENT_GATEWAY',
            parameters: {
              gateway: 'example',
              gatewayMerchantId: 'exampleMerchantId',
            },
          },
        },
      ],
      merchantInfo: {
        merchantName: 'Capgo Store',
      },
      transactionInfo: {
        totalPriceStatus: 'FINAL',
        totalPrice: '9.99',
        currencyCode: 'USD',
        countryCode: 'US',
      },
    },
  },
});

const paymentData = googleResult.google?.paymentData;
```

## Gestion des réponses

- Tokenisez la charge utile retournée avec votre processeur de paiement et confirmez la transaction côté serveur.
- Proposez un chemin de secours (saisie de carte, facture) si le paiement natif n'est pas disponible ou si l'utilisateur annule la feuille.
- Mettez en cache le résultat de disponibilité afin de ne pas afficher les boutons sur les appareils non pris en charge.
