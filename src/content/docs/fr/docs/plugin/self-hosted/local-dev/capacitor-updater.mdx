---
title: Usando el actualizador de Capacitor con capgo auto-alojado
description: Comment auto-héberger Capgo pour utiliser capacitor updater
sidebar:
  order: 4
locale: fr
---

## Que couvre ce tutoriels ?

Ce tutoriel montrera comment utiliser capacitor updater dans un environnement de développement avec capgo auto-hébergé.

## Prérequis

1. [Capgo cloné](https://githubcom/Cap-go/capgo)

## Pour commencer

Pour utiliser capacitor updater avec capgo auto-hébergé, modifiez le `capacitorconfigts` depuis le répertoire de votre application et configurez-le comme ceci :

```ts
const config: CapacitorConfig = {
  appId: 'comdemoapp',
  appName: 'demoApp',
  webDir: 'dist',
  bundledWebRuntime: false,
  plugins: {
    CapacitorUpdater : {
      statsUrl: "http://localhost:54321/functions/v1/stats",
      channelUrl: "http://localhost:54321/functions/v1/channel_self",
      updateUrl: "http://localhost:54321/functions/v1/updates"
    },
  },
};
```

Cela vous permettra d'utiliser capgo local en développement. Cependant, par défaut, ce n'est pas suffisant.

Sur Android, l'activation de la [communication en texte brut](https://developerandroidcom/topic/security/risks/cleartext) est nécessaire car par défaut SSL est désactivé en local.
Cela peut être réalisé en modifiant [AndroidManifestxml](https://githubcom/Cap-go/capacitor-updater/blob/main/android/src/main/AndroidManifestxml) et en ajoutant `android:usesCleartextTraffic="true"` dans la balise `application`.
Un exemple complet de cette modification peut être vu [ici](https://gistgithubcom/WcaleNieWolny/061a015acdebe35eaf3afd7030797701)

Comme Android n'autorise pas `http` par défaut, capgo a implémenté une vérification pour http [ici](https://githubcom/Cap-go/capgo/blob/4cce6c0707d745faa2afbab643e636bad927c602/supabase/functions/updates/indexts#L396)
Ce code pourrait ne pas toujours être présent, mais pour l'instant une modification de cette ligne est nécessaire pour faire fonctionner les mises à jour.
Cette ligne devrait ressembler à ceci :
```ts
    if (!signedURL || (signedURLstartsWith('http://') || signedURLstartsWith('https://'))) {
```

:::danger
⚠️ Ne validez pas `supabase/functions/updates/indexts` dans le dépôt distant\
Ce code est ici [intentionnellement](https://githubcom/Cap-go/capacitor-updater/issues/37#issuecomment-1684916354)
:::

Il pourrait également y avoir un problème empêchant l'application Android de se connecter. Si vous ne voyez pas de requêtes envoyées aux fonctions edge, exécutez
```bash
adb reverse tcp:54321 tcp:54321
```