---
title: "Canaux"
description: "Guide de gestion des canaux de mise à jour d'applications dans Capgo, couvrant le contrôle de version, le ciblage de plateforme et les politiques de mise à jour."
sidebar:
  order: 6
---

Les canaux sont le mécanisme central de gestion des mises à jour d'applications dans Capgo. Ils vous permettent de contrôler comment et quand vos utilisateurs reçoivent les mises à jour, en permettant des fonctionnalités comme les tests A/B, les déploiements progressifs et les mises à jour spécifiques à la plateforme.

## Comprendre les Canaux

Un canal représente une piste de distribution pour vos mises à jour d'applications. Chaque canal peut être configuré avec des règles et des contraintes spécifiques :

- **Contrôle de Version**: Spécifiez quelle version les utilisateurs reçoivent
- **Ciblage de Plateforme**: Ciblez des plateformes spécifiques (iOS/Android)
- **Politiques de Mise à Jour**: Contrôlez comment les mises à jour sont livrées
- **Restrictions de Dispositif**: Gérez quels dispositifs peuvent accéder aux mises à jour

## Options de Configuration des Canaux

- **public**: Définir comme canal par défaut pour les nouveaux dispositifs
- **disableAutoUpdateUnderNative**: Empêcher les mises à jour lorsque la version native de l'application du dispositif est plus récente que la version de mise à jour disponible dans le canal (ex., dispositif est en version 1.2.3, mais le canal a 1.2.2)
- **disableAutoUpdate**: Contrôler le comportement de mise à jour ("major", "minor", "version_number", "none")
- **ios/android**: Activer/désactiver pour des plateformes spécifiques
- **allow_device_self_set**: Permettre aux dispositifs de choisir leur canal
- **allow_emulator**: Autoriser les mises à jour sur les dispositifs émulateurs
- **allow_dev**: Autoriser les mises à jour sur les builds de développement

## Meilleures Pratiques

1. **Canal de Test**: Maintenez un canal de test pour la validation interne
2. **Déploiement Progressif**: Utilisez plusieurs canaux pour un déploiement graduel des mises à jour
3. **Séparation de Plateforme**: Créez des canaux séparés pour iOS et Android si nécessaire
4. **Contrôle de Version**: Utilisez le versionnage sémantique pour des chemins de mise à jour clairs

## Endpoints

### POST

`https://api.capgo.app/channel/`

Créer ou mettre à jour une configuration de canal.

#### Request Body

```typescript
type disable_update = "major" | "minor" | "version_number" | "none"
interface ChannelSet {
  app_id: string
  channel: string
  version?: string
  public?: boolean
  disableAutoUpdateUnderNative?: boolean
  disableAutoUpdate?: disable_update
  ios?: boolean
  android?: boolean
  allow_device_self_set?: boolean
  allow_emulator?: boolean
  allow_dev?: boolean
}
```

#### Exemple de Requête

```bash
curl -X POST \
  -H "authorization: your-api-key" \
  -H "Content-Type: application/json" \
  -d '{
    "app_id": "app_123",
    "channel": "beta",
    "version": "1.2.0",
    "public": false,
    "disableAutoUpdate": "minor",
    "ios": true,
    "android": true,
    "allow_emulator": true
  }' \
  https://api.capgo.app/channel/
```

#### Réponse de Succès

```json
{
  "status": "ok"
}
```

### GET

`https://api.capgo.app/channel/`

Récupérer les informations du canal. Renvoie 50 canaux par page.

#### Paramètres de Requête
- `app_id`: Requis. L'ID de votre application
- `page`: Optionnel. Numéro de page pour la pagination
- `channel`: Optionnel. Nom de canal spécifique à récupérer

#### Exemples de Requête

```bash
# Obtenir tous les canaux
curl -H "authorization: your-api-key" \
  "https://api.capgo.app/channel/?app_id=app_123"

# Obtenir un canal spécifique
curl -H "authorization: your-api-key" \
  "https://api.capgo.app/channel/?app_id=app_123&channel=beta"

# Obtenir la page suivante
curl -H "authorization: your-api-key" \
  "https://api.capgo.app/channel/?app_id=app_123&page=1"
```

#### Type de Réponse

```typescript
interface Channel {
    id: number;
    created_at: string;
    name: string;
    app_id: string;
    version: {
        id: number,
        name: string
    };
    created_by: string;
    updated_at: string;
    public: boolean;
    disableAutoUpdateUnderNative: boolean;
    disableAutoUpdate: boolean;
    allow_emulator: boolean;
    allow_dev: boolean;
}
```

#### Exemple de Réponse

```json
{
  "data": [
    {
      "id": 1,
      "name": "production",
      "app_id": "app_123",
      "version": {
        "id": 1,
        "name": "1.0.0"
      },
      "created_at": "2024-01-01T00:00:00Z",
      "updated_at": "2024-01-01T00:00:00Z",
      "created_by": "user_123",
      "public": true,
      "disableAutoUpdateUnderNative": false,
      "disableAutoUpdate": false,
      "allow_emulator": false,
      "allow_dev": false
    }
  ]
}
```

### DELETE

`https://api.capgo.app/channel/`

Supprimer un canal. Notez que cela affectera tous les dispositifs utilisant ce canal.

#### Paramètres de Requête

```typescript
interface Channel {
  channel: string
  app_id: string
}
```

#### Exemple de Requête

```bash
curl -X DELETE \
  -H "authorization: your-api-key" \
  -H "Content-Type: application/json" \
  -d '{
    "app_id": "app_123",
    "channel": "beta"
  }' \
  https://api.capgo.app/channel/
```

#### Réponse de Succès

```json
{
  "status": "ok"
}
```

## Gestion des Erreurs

Scénarios d'erreur courants et leurs réponses :

```json
// Canal non trouvé
{
  "error": "Channel not found",
  "status": "KO"
}

// Format de version invalide
{
  "error": "Invalid version format. Use semantic versioning",
  "status": "KO"
}

// Politique de mise à jour invalide
{
  "error": "Invalid disableAutoUpdate value",
  "status": "KO"
}

// Permission refusée
{
  "error": "Insufficient permissions to manage channels",
  "status": "KO"
}
```

## Cas d'Usage Courants

1. **Tests Bêta**
```typescript
{
  "app_id": "app_123",
  "channel": "beta",
  "version": "1.2.0-beta",
  "public": false,
  "allow_emulator": true,
  "allow_dev": true
}
```

2. **Déploiement en Production**
```typescript
{
  "app_id": "app_123",
  "channel": "production",
  "version": "1.2.0",
  "public": true,
  "disableAutoUpdate": "minor"
}
```

3. **Mises à Jour Spécifiques à la Plateforme**
```typescript
{
  "app_id": "app_123",
  "channel": "ios-hotfix",
  "version": "1.2.1",
  "ios": true,
  "android": false
}
```
