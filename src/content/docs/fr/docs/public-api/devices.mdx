---
title: Devices
description: >-
  Documentation pour gérer les appareils via l'API Capgo, couvrant le suivi, le
  versionnage et les affectations de canaux pour les installations
  d'applications.
sidebar:
  order: 7
locale: fr
---

Les Devices représentent les installations individuelles de votre application qui sont gérées par Capgo. L'API Devices vous permet de suivre et de gérer les appareils, y compris leurs versions, canaux et statut de mise à jour.

:::note[Conservation des Données]
Les données des appareils sont conservées pendant **90 jours** à compter de la dernière activité de l'appareil. Les appareils qui ne se sont pas connectés à Capgo pendant cette période seront automatiquement supprimés du système. Les appareils actifs sont suivis en continu lorsqu'ils vérifient les mises à jour.
:::

## Comprendre les Devices

Chaque appareil possède des caractéristiques et états uniques :
- **Platform** : iOS ou Android
- **Version** : Version actuelle du bundle et version de build native
- **Environment** : Production ou développement, émulateur ou appareil physique
- **Channel** : Affectation actuelle du canal de mise à jour
- **Custom ID** : Identifiant optionnel pour vos propres besoins de suivi

## Meilleures Pratiques

1. **Suivi des Versions** : Surveillez les versions des appareils pour assurer l'adoption des mises à jour
2. **Gestion des Canaux** : Affectez les appareils aux canaux appropriés en fonction des besoins de test
3. **Conscience de l'Environnement** : Gérez les différents environnements (prod/dev/émulateur) de manière appropriée
4. **Identification Personnalisée** : Utilisez des IDs personnalisés pour intégrer avec vos systèmes existants

## Endpoints

### POST

`https://api.capgo.app/device/`

Lier un appareil à une version ou un canal spécifique.

#### Request Body

```typescript
interface DeviceLink {
  app_id: string
  device_id: string
  version_id?: string // version name
  channel?: string    // channel name
}
```

#### Exemple de Requête

```bash
curl -X POST \
  -H "authorization: your-api-key" \
  -H "Content-Type: application/json" \
  -d '{
    "app_id": "app_123",
    "device_id": "device_456",
    "channel": "beta"
  }' \
  https://api.capgo.app/device/
```

#### Réponse de Succès

```json
{
  "status": "ok"
}
```

### GET

`https://api.capgo.app/device/`

Récupérer les informations de l'appareil. Utilise la pagination basée sur curseur pour une récupération efficace de grandes listes d'appareils.

#### Paramètres de Requête
- `app_id` : Requis. L'ID de votre application
- `device_id` : Optionnel. ID d'appareil spécifique pour récupérer un seul appareil
- `cursor` : Optionnel. Curseur de la réponse précédente pour la pagination
- `limit` : Optionnel. Nombre d'appareils par page (par défaut : 50)

#### Exemple de Requêtes

```bash
# Get all devices (first page)
curl -H "authorization: your-api-key" \
  "https://api.capgo.app/device/?app_id=app_123"

# Get specific device
curl -H "authorization: your-api-key" \
  "https://api.capgo.app/device/?app_id=app_123&device_id=device_456"

# Get next page using cursor
curl -H "authorization: your-api-key" \
  "https://api.capgo.app/device/?app_id=app_123&cursor=2024-01-01T00:00:00Z|device_456"
```

#### Type de Réponse (Liste)

Lors de la demande de plusieurs appareils (sans paramètre `device_id`) :

```typescript
interface DeviceListResponse {
  data: Device[];
  nextCursor?: string;  // Passez ceci comme paramètre 'cursor' pour obtenir la page suivante
  hasMore: boolean;     // true s'il y a plus de pages disponibles
}

interface Device {
  updated_at: string;
  device_id: string;
  custom_id: string;
  version?: number;
  version_name: string | null;
  channel?: string;
  app_id: string;
  platform: "ios" | "android";
  plugin_version: string;
  os_version: string;
  version_build: string;
  is_prod: boolean;
  is_emulator: boolean;
}
```

#### Type de Réponse (Appareil Unique)

Lors de la demande d'un appareil spécifique avec le paramètre `device_id`, renvoie l'objet appareil directement :

```typescript
interface Device {
  updated_at: string;
  device_id: string;
  custom_id: string;
  version?: number;
  version_name: string | null;
  channel?: string;
  app_id: string;
  platform: "ios" | "android";
  plugin_version: string;
  os_version: string;
  version_build: string;
  is_prod: boolean;
  is_emulator: boolean;
}
```

#### Exemple de Réponse (Liste)

```json
{
  "data": [
    {
      "device_id": "device_456",
      "custom_id": "test-device-1",
      "version": 1,
      "version_name": "1.0.0",
      "app_id": "app_123",
      "platform": "ios",
      "plugin_version": "5.0.0",
      "os_version": "17.0",
      "version_build": "1",
      "is_prod": true,
      "is_emulator": false,
      "updated_at": "2024-01-01T00:00:00Z"
    }
  ],
  "nextCursor": "2024-01-01T00:00:00Z|device_456",
  "hasMore": true
}
```

#### Exemple de Réponse (Appareil Unique)

```json
{
  "device_id": "device_456",
  "custom_id": "test-device-1",
  "version": 1,
  "version_name": "1.0.0",
  "app_id": "app_123",
  "platform": "ios",
  "plugin_version": "5.0.0",
  "os_version": "17.0",
  "version_build": "1",
  "is_prod": true,
  "is_emulator": false,
  "updated_at": "2024-01-01T00:00:00Z",
  "channel": "production"
}
```

### DELETE

`https://api.capgo.app/device/`

Dissocier un appareil de son remplacement de canal. Cela réinitialise l'appareil pour utiliser son canal par défaut.

:::note[Supprimer l'appareil]
Les données des appareils sont conservées pendant **90 jours** à compter de la dernière activité de l'appareil. Les appareils qui ne se sont pas connectés à Capgo pendant cette période seront automatiquement supprimés du système. Les appareils actifs sont suivis en continu lorsqu'ils vérifient les mises à jour.
Vous ne pouvez pas supprimer un appareil avec ce endpoint, il n'affecte que le remplacement du canal.
:::

#### Query Parameters

```typescript
interface Device {
  device_id: string
  app_id: string
}
```

#### Exemple de Requête

```bash
curl -X DELETE \
  -H "authorization: your-api-key" \
  -H "Content-Type: application/json" \
  -d '{
    "app_id": "app_123",
    "device_id": "device_456"
  }' \
  https://api.capgo.app/device/
```

#### Réponse de Succès

```json
{
  "status": "ok"
}
```

## Gestion des Erreurs

Scénarios d'erreur courants et leurs réponses :

```json
// Device not found
{
  "error": "Device not found",
  "status": "KO"
}

// Invalid version
{
  "error": "Version not found",
  "status": "KO"
}

// Invalid channel
{
  "error": "Channel not found",
  "status": "KO"
}

// Permission denied
{
  "error": "Insufficient permissions to manage devices",
  "status": "KO"
}
```

## Cas d'Usage Courants

1. **Beta Device Registration**
```typescript
{
  "app_id": "app_123",
  "device_id": "device_456",
  "channel": "beta"
}
```

2. **Version Override**
```typescript
{
  "app_id": "app_123",
  "device_id": "device_456",
  "version_id": "1.1.0"
}
```

3. **Reset to Default Channel**
```typescript
// Use DELETE endpoint to remove overrides
```

## Conseils pour la Gestion des Appareils

1. **Surveillance** : Vérifiez régulièrement l'état des appareils et la distribution des versions
2. **Tests** : Utilisez des IDs personnalisés pour identifier facilement les appareils de test
3. **Dépannage** : Suivez les mises à jour des appareils et les affectations de canaux
4. **Contrôle de Version** : Surveillez les versions natives de l'application pour garantir la compatibilité 
