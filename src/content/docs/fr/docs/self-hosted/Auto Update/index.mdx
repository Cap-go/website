---
title: Pengenalan - Pembaruan Otomatis
description: Comment utiliser le plugin d'auto-mise √† jour en mode auto-h√©berg√©
sidebar:
  order: 1
locale: fr
---

import { LinkCard, CardGrid } from '@astrojs/starlight/components';

Cette documentation expliquera comment ex√©cuter votre serveur de mise √† jour automatique

## Avant de commencer

Si vous utilisez ce travail pour votre propre compte, je ne peux que vous sugg√©rer de soutenir mon travail via [ceci](https://github.com/sponsors/riderx/)

J'ai fait un grand pari en rendant open source tout le pr√©cieux code que j'ai construit ici

J'aurais pu le garder pour moi et fixer un prix √©lev√©

De plus, je veux me concentrer sur les outils Capgo et en faire une entreprise ouverte et transparente

De m√™me, je pense que cela rendrait notre monde meilleur en s'ouvrant plut√¥t qu'en se battant et en se cachant

Mais pour que cela soit possible, nous devons tous faire notre part, y compris vous ü•π

Si les offres de Capgo ne vous conviennent pas, fixez votre prix et soutenez un cr√©ateur ind√©pendant [ICI](https://github.com/sponsors/riderx/) selon vos conditions

## Installation rapide

```
npm install @capgo/capacitor-updater
npx cap sync
```

### Configuration

Vous devez configurer le plugin pour utiliser votre URL comme ceci :

```json
{
	"plugins": {
		"CapacitorUpdater": {
			"updateUrl": "https://VOTREURL",
		}
	}
}
```

> üöß Sur Android, les requ√™tes HTTP ne sont pas autoris√©es, pour les tests [permettez-les](https://stackoverflow.com/questions/45940861/android-8-cleartext-http-traffic-not-permitted/)

### API de mise √† jour

Le plugin fera un appel POST √† votre API chaque fois que l'application est ouverte, avec ce corps :

```typescript
interface AppInfos {
    "platform": "ios" | "android",
    "device_id": "UUID_of_device_unique_by_install",
    "app_id": "APPID_FROM_CAPACITOR_CONFIG",
    "custom_id": "your_custom_id_set_on_runtime",
    "plugin_version": "PLUGIN_VERSION",
    "version_build": "VERSION_NUMBER_FROM_NATIVE_CODE",
    "version_code": "VERSION_CODE_FROM_NATIVE_CODE",
    "version_name": "LAST_DOWNLOADER_VERSION" | "builtin"
    "version_os": "VERSION_OF_SYSYEM_OS",
    "is_emulator": boolean,
    "is_prod": boolean,
}
```

Le serveur API doit r√©pondre, en JSON, au plugin capacitor-updater avec ces donn√©es si une mise √† jour est n√©cessaire :

```json
{
"version": "123",
"url": "https://path_to_the_zip_file_of_the_codecom"
}
```

En mise √† jour automatique, le serveur doit faire le travail de comparaison des versions et renvoyer la bonne, si la cl√© URL est pr√©sente, le plugin d√©marre le processus de t√©l√©chargement

Si vous ajoutez les cl√©s "message" et "error", la version ne sera pas d√©finie et le message sera affich√© dans les logs √† la place

La cl√© `version` doit √™tre au format [`semver`](https://semverorg/)

Le zip doit avoir `indexhtml` comme fichier √† la racine, ou un seul dossier √† la racine avec `indexhtml` √† l'int√©rieur

Vous pouvez utiliser la commande du CLI pour zipper votre bundle :

```bash
npx @capgo/cli bundle zip --path [/path/to/my/bundle]
```

<LinkCard
	title="Point de terminaison de mise √† jour"
	href="/docs/self-hosted/auto-update/update-endpoint"
/>

#### Chiffrement de bout en bout

√Ä partir de la version 4150, le plugin permet d'envoyer des mises √† jour chiffr√©es

Vous pouvez utiliser cette fonctionnalit√© en cr√©ant une cl√© priv√©e ``npx @capgo/cli key create``

Ensuite, chiffrez votre fichier zip avec ``npx @capgo/cli encrypt [path/to/zip]``

La commande vous affichera une `ivSessionKey` qui doit √™tre envoy√©e avec votre payload de mise √† jour dans la cl√© `session_key`\
Ensuite, votre application pourra utiliser la cl√© priv√©e pour d√©chiffrer la `session_key` et utiliser la `session_key` d√©chiffr√©e pour d√©chiffrer la mise √† jour

En savoir plus ici :

<LinkCard
	title="Mises √† jour en direct auto-h√©berg√©es"
	href="https://capgo.app/blog/self-hosted-live-updates/"
/>

### API de statistiques

√Ä partir de la version 130, le syst√®me de mise √† jour envoie des statistiques !

Par d√©faut, toutes les statistiques sont envoy√©es √† notre serveur, pour comprendre l'utilisation

> üí° Aucune donn√©e priv√©e n'est envoy√©e pour les statistiques, uniquement UUID al√©atoire, version de mise √† jour, version de l'application native, plateforme, action et ID d'application

Si vous voulez envoyer les donn√©es √† votre serveur √† la place, modifiez la configuration ci-dessous :

```tsx
// capacitorconfigjson
{
	"appId": "*******",
	"appName": "Name",
	"plugins": {
		"CapacitorUpdater": {
			"statsUrl": "VOTRE_URL"
		}
	}
}
```

Ce que votre serveur recevra :

```tsx
interface AppInfosStats {
	"action": "set", // peut √™tre set, delete, set_fail, reset, revert
	// Ensuite ce sont les m√™mes infos que la mise √† jour
	"app_id": "*******", // identifiant de l'application dans le store
	"device_id": "*******", // id unique par installation d'application
	"platform": "ios", // ou android
	"custom_id": "user_1", // repr√©sente votre utilisateur
        "version_name": "123", // version de la build web
        "version_build": "120", // version de la build native
        "version_code": "120", // num√©ro de build de la build native
	"version_os": "16", // version OS de l'appareil
        "plugin_version": "400"// pour faire que votre api se comporte diff√©remment avec diff√©rents plugins
        "is_emulator": false,
    	"is_prod": false,
}
```

Vous pouvez aussi totalement le d√©sactiver, avec une cha√Æne vide. Gardez √† l'esprit que les statistiques sont faites de mani√®re respectueuse de la vie priv√©e et m'aident √† comprendre comment les gens utilisent le plugin, pour r√©soudre les probl√®mes et l'am√©liorer

<LinkCard
	title="Point de terminaison des statistiques"
	href="/docs/self-hosted/auto-update/stats-endpoint/"
/>

### API de canal

√Ä documenter
