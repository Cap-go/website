---
title: Introduction - Mise √† jour automatique
description: Comment utiliser le plugin d'auto-mise √† jour en mode auto-h√©berg√©
sidebar:
  order: 1
locale: fr
---

import { LinkCard, CardGrid } from '@astrojs/starlight/components';

Cette documentation expliquera comment ex√©cuter votre serveur de mise √† jour automatique

## Avant de commencer

Si vous utilisez ce travail par vous-m√™me, je ne peux que vous sugg√©rer de soutenir mon travail via [ceci](https://githubcom/sponsors/riderx/)

J'ai fait un grand pari d'ouvrir le code source de tout le pr√©cieux code que j'ai construit ici

J'aurais pu le garder pour moi et fixer un prix √©lev√©

De plus, je veux me concentrer sur les outils Capgo et en faire une entreprise ouverte et transparente

De m√™me, je pense que cela rendrait notre monde meilleur en s'ouvrant plut√¥t qu'en se battant et en se cachant

Mais pour que cela soit possible, nous devons tous faire notre part, y compris vous ü•π

Si les offres Capgo ne vous conviennent pas, alors fixez votre prix et soutenez un cr√©ateur ind√©pendant [ICI](https://githubcom/sponsors/riderx/) selon vos conditions

## Installation rapide

```
npm install @capgo/capacitor-updater
npx cap sync
```

### Configuration

Vous devez configurer le plugin pour utiliser votre URL comme ceci :

```json
{
	"plugins": {
		"CapacitorUpdater": {
			"updateUrl": "https://VOTREURL",
		}
	}
}
```

> üöß Sur Android, les requ√™tes HTTP ne sont pas autoris√©es, pour les tests [permettez-le](https://stackoverflowcom/questions/45940861/android-8-cleartext-http-traffic-not-permitted/)

### API de mise √† jour

Le plugin effectuera un appel POST vers votre API chaque fois que l'application est ouverte, avec ce corps :

```typescript
interface AppInfos {
    "platform": "ios" | "android",
    "device_id": "UUID_du_dispositif_unique_par_installation",
    "app_id": "APPID_DU_CONFIG_CAPACITOR",
    "custom_id": "votre_id_personnalise_defini_a_l_execution",
    "plugin_version": "VERSION_DU_PLUGIN",
    "version_build": "NUMERO_VERSION_DU_CODE_NATIF",
    "version_code": "CODE_VERSION_DU_CODE_NATIF",
    "version_name": "DERNIERE_VERSION_TELECHARGEE" | "builtin"
    "version_os": "VERSION_DU_SYSTEME_OS",
    "is_emulator": boolean,
    "is_prod": boolean,
}
```

L'API du serveur doit r√©pondre, en JSON, au plugin capacitor-updater avec ces donn√©es si une mise √† jour est n√©cessaire :

```json
{
"version": "123",
"url": "https://chemin_vers_le_fichier_zip_du_codecom"
}
```

En mise √† jour automatique, le serveur doit faire le travail de comparaison des versions et renvoyer la bonne version, si la cl√© URL est pr√©sente, le plugin d√©marre le processus de t√©l√©chargement

Si vous ajoutez les cl√©s "message" et "error", la version ne sera pas d√©finie, et le message sera affich√© dans les logs √† la place

La cl√© `version` doit √™tre au format [`semver`](https://semverorg/)

Le zip doit avoir `indexhtml` comme fichier √† la racine, ou un seul dossier √† la racine avec `indexhtml` √† l'int√©rieur

Vous pouvez utiliser la commande du CLI pour zipper votre bundle :

```bash
npx @capgo/cli bundle zip --path [/chemin/vers/mon/bundle]
```

<LinkCard
	title="Point de terminaison de mise √† jour"
	href="/docs/self-hosted/auto-update/update-endpoint"
/>

#### Chiffrement de bout en bout

√Ä partir de la version 4150, le plugin permet d'envoyer des mises √† jour chiffr√©es

Vous pouvez utiliser cette fonctionnalit√© en cr√©ant une cl√© priv√©e ``npx @capgo/cli key create``

Ensuite, chiffrez votre fichier zip avec ``npx @capgo/cli encrypt [chemin/vers/zip]``

La commande vous affichera une `ivSessionKey` qui doit √™tre envoy√©e avec votre payload de mise √† jour dans la cl√© `session_key`\
Ensuite, votre application pourra utiliser la cl√© priv√©e pour d√©chiffrer la `session_key` et utiliser la `session_key` d√©chiffr√©e pour d√©chiffrer la mise √† jour

En savoir plus ici :

<LinkCard
	title="Mises √† jour en direct auto-h√©berg√©es"
	href="https://capgoapp/blog/self-hosted-live-updates/"
/>

### API de statistiques

√Ä partir de la version 130, le syst√®me de mise √† jour envoie des statistiques !

Par d√©faut, toutes les statistiques sont envoy√©es √† notre serveur, pour comprendre l'utilisation

> üí° Aucune donn√©e priv√©e n'est envoy√©e pour les statistiques, uniquement UUID al√©atoire, version de mise √† jour, version de l'application native, plateforme, action et ID d'application

Si vous voulez envoyer les donn√©es √† votre serveur √† la place, changez la configuration ci-dessous :

```tsx
// capacitorconfigjson
{
	"appId": "*******",
	"appName": "Nom",
	"plugins": {
		"CapacitorUpdater": {
			"statsUrl": "VOTRE_URL"
		}
	}
}
```

Ce que votre serveur recevra :

```tsx
interface AppInfosStats {
	"action": "set", // peut √™tre set, delete, set_fail, reset, revert
	// Ensuite, ce sont les m√™mes informations que la mise √† jour
	"app_id": "*******", // identifiant de l'application dans le store
	"device_id": "*******", // id unique par installation d'application
	"platform": "ios", // ou android
	"custom_id": "utilisateur_1", // repr√©sente votre utilisateur
        "version_name": "123", // version de la build web
        "version_build": "120", // version de la build native
        "version_code": "120", // num√©ro de build de la build native
	"version_os": "16", // version OS de l'appareil
        "plugin_version": "400"// pour que votre api se comporte diff√©remment selon les plugins
        "is_emulator": false,
    	"is_prod": false,
}
```

Vous pouvez aussi totalement le d√©sactiver, avec une cha√Æne vide. Gardez √† l'esprit que les statistiques sont con√ßues pour respecter la vie priv√©e et m'aident √† comprendre comment les gens utilisent le plugin, pour r√©soudre les probl√®mes et l'am√©liorer

<LinkCard
	title="Point de terminaison des statistiques"
	href="/docs/self-hosted/auto-update/stats-endpoint"
/>

### API de canal

√Ä documenter