---
title: Einf√ºhrung - Automatische Aktualisierung
description: Verwendung des Auto-Update-Plugins im Self-Hosting-Modus
sidebar:
  order: 1
locale: de
---

import { LinkCard, CardGrid } from '@astrojs/starlight/components';

Diese Dokumentation erkl√§rt, wie Sie Ihren Auto-Update-Server ausf√ºhren k√∂nnen

## Bevor Sie beginnen

Wenn Sie diese Arbeit selbst nutzen, kann ich nur empfehlen, meine Arbeit √ºber [this](https://githubcom/sponsors/riderx/) zu unterst√ºtzen

Ich habe eine gro√üe Wette abgeschlossen, indem ich den wertvollen Code, den ich hier erstellt habe, als Open Source zur Verf√ºgung stelle

Ich h√§tte es f√ºr mich behalten und einen hohen Preis verlangen k√∂nnen

Dar√ºber hinaus m√∂chte ich mich auf Capgo-Tools konzentrieren und daraus ein offenes und transparentes Gesch√§ft machen

Ebenso denke ich, dass es unsere Welt durch √ñffnung statt Kampf und Verstecken besser machen w√ºrde

Aber um dies zu erm√∂glichen, m√ºssen wir alle unseren Teil dazu beitragen, auch Sie ü•π

Wenn die Capgo-Angebote nicht zu Ihnen passen, dann setzen Sie Ihren Preis fest und unterst√ºtzen Sie einen bootstrapped Maker [HIER](https://githubcom/sponsors/riderx/) zu Ihren Bedingungen

## Schnellinstallation

```
npm install @capgo/capacitor-updater
npx cap sync
```

### Konfiguration

Sie m√ºssen das Plugin konfigurieren, um Ihre URL wie folgt zu verwenden:

```json
{
	"plugins": {
		"CapacitorUpdater": {
			"updateUrl": "https://IHREURL",
		}
	}
}
```

> üöß Unter Android sind HTTP-Anfragen nicht erlaubt. Zu Testzwecken [erlauben Sie es](https://stackoverflowcom/questions/45940861/android-8-cleartext-http-traffic-not-permitted/)

### Update API

Das Plugin f√ºhrt bei jedem App-Start einen POST-Aufruf an Ihre API mit diesem Body durch:

```typescript
interface AppInfos {
    "platform": "ios" | "android",
    "device_id": "UUID_of_device_unique_by_install",
    "app_id": "APPID_FROM_CAPACITOR_CONFIG",
    "custom_id": "your_custom_id_set_on_runtime",
    "plugin_version": "PLUGIN_VERSION",
    "version_build": "VERSION_NUMBER_FROM_NATIVE_CODE",
    "version_code": "VERSION_CODE_FROM_NATIVE_CODE",
    "version_name": "LAST_DOWNLOADER_VERSION" | "builtin"
    "version_os": "VERSION_OF_SYSYEM_OS",
    "is_emulator": boolean,
    "is_prod": boolean,
}
```

Der Server-API sollte in JSON dem Capacitor-Updater-Plugin mit diesen Daten antworten, wenn ein Update erforderlich ist:

```json
{
"version": "123",
"url": "https://path_to_the_zip_file_of_the_codecom"
}
```

Bei Auto-Update sollte der Server die Versionsvergleichsarbeit durchf√ºhren und die richtige Version zur√ºckgeben. Wenn der URL-Schl√ºssel vorhanden ist, startet das Plugin den Download-Prozess

Wenn Sie die Schl√ºssel "message" und "error" hinzuf√ºgen, wird die Version nicht gesetzt und die Nachricht wird stattdessen in den Logs angezeigt

Der `version`-Schl√ºssel sollte im [`semver`](https://semverorg/)-Format sein

Die ZIP-Datei sollte `indexhtml` als Datei im Root-Verzeichnis haben oder nur einen Ordner im Root mit `indexhtml` darin


Sie k√∂nnen den Befehl der CLI verwenden, um Ihr Bundle zu zippen:

```bash
npx @capgo/cli bundle zip --path [/path/to/my/bundle]
```

<LinkCard
	title="Update Endppint"
	href="/docs/self-hosted/auto-update/update-endpoint"
/>

#### Ende-zu-Ende-Verschl√ºsselung

Ab Version 4150 erm√∂glicht das Plugin das Senden verschl√ºsselter Updates

Sie k√∂nnen diese Funktion nutzen, indem Sie einen privaten Schl√ºssel erstellen ``npx @capgo/cli key create``

Dann verschl√ºsseln Sie Ihre ZIP-Datei mit ``npx @capgo/cli encrypt [path/to/zip]``

Der Befehl gibt Ihnen einen `ivSessionKey` aus, der mit Ihrer Update-Payload im Schl√ºssel `session_key` gesendet werden muss\
Dann kann Ihre App den privaten Schl√ºssel verwenden, um den `session_key` zu entschl√ºsseln und den entschl√ºsselten `session_key` zur Entschl√ºsselung des Updates nutzen

Erfahren Sie mehr dar√ºber hier:

<LinkCard
	title="Self-hosted Live Updates"
	href="https://capgoapp/blog/self-hosted-live-updates/"
/>

### Statistik-API

Ab Version 130 sendet das Update-System Statistiken!

Standardm√§√üig werden alle Statistiken an unseren Server gesendet, um die Nutzung zu verstehen

> üí° F√ºr Statistiken werden keine privaten Daten gesendet, nur zuf√§llige UUID, Versions-Update, Version der nativen App, Plattform, Aktion und App-ID

Wenn Sie die Daten stattdessen an Ihren Server senden m√∂chten, √§ndern Sie die Konfiguration wie folgt:

```tsx
// capacitorconfigjson
{
	"appId": "*******",
	"appName": "Name",
	"plugins": {
		"CapacitorUpdater": {
			"statsUrl": "IHRE_URL"
		}
	}
}
```

Was Ihr Server empf√§ngt:

```tsx
interface AppInfosStats {
	"action": "set", // kann set, delete, set_fail, reset, revert sein
	// Dann sind es die gleichen Infos wie beim Update
	"app_id": "*******", // App-Identifier im Store
	"device_id": "*******", // eindeutige ID pro App-Installation
	"platform": "ios", // oder android
	"custom_id": "user_1", // repr√§sentiert Ihren Benutzer
        "version_name": "123", // Version des Web-Builds
        "version_build": "120", // Version des nativen Builds
        "version_code": "120", // Build-Nummer des nativen Builds
	"version_os": "16", // OS-Version des Ger√§ts
        "plugin_version": "400"// um Ihre API bei verschiedenen Plugins unterschiedlich zu verhalten
        "is_emulator": false,
    	"is_prod": false,
}
```

Sie k√∂nnen es auch komplett deaktivieren, mit einem leeren String. Bedenken Sie, dass Statistiken datenschutzfreundlich gestaltet sind und mir helfen zu verstehen, wie Menschen das Plugin nutzen, um Probleme zu l√∂sen und es zu verbessern

<LinkCard
	title="Stats Endpoint"
	href="/docs/self-hosted/auto-update/stats-endpoint"
/>

### Channel API

Noch zu dokumentieren