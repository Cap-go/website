---
title: Aktualisierungsverhalten
sidebar:
  order: 3
locale: de
---

import { Aside, Steps } from '@astrojs/starlight/components';

Wenn Sie ein Update für Ihre Capgo-App veröffentlichen, möchten Sie wahrscheinlich, dass Ihre Nutzer dieses Update so schnell wie möglich erhalten. Allerdings möchten Sie deren Nutzungserfahrung nicht stören, indem Sie sie zwingen, mitten in einer Sitzung auf einen Download zu warten oder die App neu zu starten.

Das Update-Verhalten von Capgo wurde entwickelt, um eine Balance zwischen schneller Update-Bereitstellung und minimaler Störung der Nutzer zu gewährleisten.

## Standard Update-Ablauf

Standardmäßig handhabt Capgo App-Updates wie folgt:

<Steps>

1. Beim App-Start prüft das Capgo-Plugin, ob ein neues Update verfügbar ist

2. Wenn ein Update gefunden wird, wird es im Hintergrund heruntergeladen, während der Nutzer die aktuelle Version der App weiter verwendet

3. Sobald der Download abgeschlossen ist, wartet Capgo darauf, dass der Nutzer die App entweder in den Hintergrund verschiebt oder vollständig beendet

4. Wenn der Nutzer die App das nächste Mal startet, läuft die aktualisierte Version

</Steps>

Dieser Ablauf stellt sicher, dass Nutzer immer die neueste Version Ihrer App verwenden, ohne jemals durch Update-Meldungen unterbrochen zu werden oder auf Downloads warten zu müssen.

<Aside type="tip">
Capgo prüft auch nach Updates, wenn die App aus dem Hintergrund fortgesetzt wird, sodass Nutzer Updates erhalten, auch wenn sie die App nicht vollständig beenden
</Aside>

## Warum dieser Ansatz?

Das Anwenden von Updates bei Hintergrund- oder Beendigungsereignissen bietet einige wichtige Vorteile für die Benutzererfahrung:

- Nutzer werden nicht durch Update-Meldungen unterbrochen oder müssen mitten in einer Sitzung auf Downloads warten

- Updates werden nahtlos zwischen den Sitzungen angewendet, sodass das Starten der App immer aktuell ist

- Sie können häufig Updates bereitstellen, ohne sich Sorgen zu machen, aktive Nutzer zu stören

Der Hauptnachteil ist, dass Nutzer möglicherweise nicht gespeicherte Daten verlieren können, wenn sie die App in den Hintergrund verschieben und schnell wieder aufrufen, da das Update zwischen diesen Aktionen angewendet wurde.

Um dies abzumildern, empfehlen wir:

- Häufiges Speichern des Status und dessen geschmeidige Wiederherstellung beim Fortsetzen der App

- Vermeidung sehr häufiger Updates, die große Teile des App-Status ändern

- Erwägung der Anpassung des Update-Verhaltens für sensible Abläufe (siehe unten)

## Anpassen des Update-Zeitpunkts

In manchen Fällen möchten Sie möglicherweise mehr Kontrolle darüber haben, wann genau ein Update angewendet wird. Zum Beispiel möchten Sie vielleicht sicherstellen, dass ein Nutzer einen laufenden Prozess abschließt, bevor das Update installiert wird, oder ein App-Update mit einer serverseitigen Änderung koordinieren.

Capgo bietet eine `setDelay`-Funktion, mit der Sie Bedingungen festlegen können, die erfüllt sein müssen, bevor ein Update installiert wird:

```typescript
import { CapacitorUpdater } from '@capgo/capacitor-updater';

await CapacitorUpdater.setMultiDelay({
  delayConditions: [
    {
      kind: 'date',
      value: '2023-06-01T00:00:00.000Z',
    },
    {
      kind: 'background',
      value: '60000',
    },
  ],
});
```

Dieses Beispiel würde die Installation eines Updates verzögern, bis nach dem 1. Juni 2023 UND die App mindestens 60 Sekunden im Hintergrund war.

Die verfügbaren Verzögerungsbedingungen sind:

- `date`: Warten bis nach einem bestimmten Datum/Uhrzeit, um das Update anzuwenden
- `background`: Nach dem Wechsel der App in den Hintergrund eine Mindestdauer warten, bevor das Update angewendet wird
- `nativeVersion`: Warten auf die Installation einer nativen Binary mit einer Mindestversion, bevor das Update angewendet wird
- `kill`: Warten bis zum nächsten App-Beendigungsereignis, um das Update anzuwenden

Sie können diese Bedingungen kombinieren, um präzise zu steuern, wann ein Update installiert wird.

<Aside type="danger">
Beachten Sie, dass die `kill`-Bedingung das Update derzeit nach dem ersten Beendigungsereignis auslöst und nicht nach dem nächsten Hintergrundereignis wie die anderen Bedingungen. Diese Inkonsistenz wird in einer zukünftigen Version behoben.
</Aside>

## Sofortiges Anwenden von Updates

Für kritische Updates oder Apps mit sehr einfachem Status möchten Sie möglicherweise ein Update sofort nach dem Download anwenden, ohne auf ein Hintergrund- oder Beendigungsereignis zu warten. Capgo unterstützt dies über die `directUpdate`-Konfigurationsoption.

`directUpdate` wird in Ihrer `capacitor.config.ts`-Datei festgelegt, nicht im JavaScript-Code:

```typescript
import { CapacitorConfig } from '@capacitor/cli';

const config: CapacitorConfig = {
  plugins: {
    CapacitorUpdater: {
      autoUpdate: true,
      directUpdate: true,
    },
  },
  keepUrlPathAfterReload: true,
};

export default config;
```

Mit aktiviertem `directUpdate` wird Capgo ein Update sofort anwenden, sobald der Download abgeschlossen ist, auch wenn der Nutzer die App aktiv verwendet.

Beachten Sie, dass `directUpdate` als native Konfiguration eine zusätzliche Behandlung in Ihrem JavaScript-Code erfordert.

Bei Verwendung von `directUpdate` müssen Sie auf das `appReady`-Event hören und den Splash-Screen Ihrer App als Reaktion darauf ausblenden:

```js
import { CapacitorUpdater } from '@capgo/capacitor-updater';
import { SplashScreen } from '@capacitor/splash-screen';

CapacitorUpdater.addListener('appReady', () => {
  // Splash Screen ausblenden
  SplashScreen.hide();
});

CapacitorUpdater.notifyAppReady();
```

Das `appReady`-Event wird ausgelöst, sobald die App die Initialisierung abgeschlossen und alle ausstehenden Updates angewendet hat. Dies ist der Zeitpunkt, an dem es sicher ist, die Benutzeroberfläche Ihrer App anzuzeigen, da sichergestellt ist, dass der Nutzer die neueste Version sieht.

Zusätzlich zur Behandlung des `appReady`-Events empfehlen wir, die Konfigurationsoption `keepUrlPathAfterReload` bei Verwendung von `directUpdate` auf `true` zu setzen. Dies bewahrt den aktuellen URL-Pfad, wenn die App aufgrund eines Updates neu geladen wird, und hilft, die Position des Nutzers in der App beizubehalten und Desorientierung zu reduzieren.

Wenn Sie das `appReady`-Event nicht behandeln und `keepUrlPathAfterReload` bei Verwendung von `directUpdate` nicht setzen, sieht der Nutzer möglicherweise kurz eine veraltete Version der App, wird zur Anfangsroute zurückgebracht oder sieht ein Flackern, während das Update angewendet wird.

Die Verwendung von `directUpdate` kann nützlich sein, um kritische Fehlerbehebungen oder Sicherheitsupdates bereitzustellen, bringt aber einige Kompromisse mit sich:

- Der Nutzer sieht möglicherweise ein kurzes Flackern oder einen Ladezustand, während das Update angewendet wird, wenn Sie das `appReady`-Event nicht richtig behandeln
- Wenn das Update den App-Status oder die Benutzeroberfläche ändert, sieht der Nutzer möglicherweise eine störende Änderung mitten in einer Sitzung
- Die Position des Nutzers in der App kann verloren gehen, wenn `keepUrlPathAfterReload` nicht gesetzt ist, was möglicherweise desorientierend wirkt
- Sie müssen sorgfältig das Speichern und Wiederherstellen des Status handhaben, um einen reibungslosen Übergang zu gewährleisten

Wenn Sie `directUpdate` aktivieren, empfehlen wir:

- Behandlung des `appReady`-Events zur Kontrolle, wann die Benutzeroberfläche Ihrer App angezeigt wird
- Setzen von `keepUrlPathAfterReload` auf `true`, um die Position des Nutzers in der App zu bewahren
- Speichern und Wiederherstellen des App-Status nach Bedarf, um Nutzungsfortschritte nicht zu verlieren
- Gründliches Testen des Update-Verhaltens Ihrer App, um sicherzustellen, dass es keine störenden Übergänge, verlorene Status oder desorientierende Positionsänderungen gibt

In den meisten Fällen bietet das Standard-Update-Verhalten die beste Balance zwischen schneller Update-Bereitstellung und minimaler Störung. Aber für Apps mit spezifischen Anforderungen bietet Capgo die Flexibilität, den Zeitpunkt und die Art der Update-Anwendung anzupassen.