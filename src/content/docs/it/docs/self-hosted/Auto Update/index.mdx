---
title: Einf√ºhrung - Automatische Aktualisierung
description: Come usare il plugin di auto-aggiornamento in modalit√† self-hosted
sidebar:
  order: 1
locale: it
---

import { LinkCard, CardGrid } from '@astrojs/starlight/components';

Questa documentazione spiegher√† come eseguire il tuo server di auto-aggiornamento

## Prima di iniziare

Se utilizzi questo lavoro per conto tuo, non potrei suggerire di pi√π di supportare il mio lavoro attraverso [questo](https://githubcom/sponsors/riderx/)

Ho fatto una grande scommessa rendendo open source tutto il prezioso codice che ho costruito qui

Avrei potuto tenerlo per me e metterci un prezzo alto

Inoltre, voglio concentrarmi sugli strumenti Capgo e renderlo un business aperto e trasparente

Allo stesso modo, penso che renderebbe il nostro mondo un posto migliore aprendo invece di combattere e nascondere

Ma per renderlo possibile, tutti noi dobbiamo fare la nostra parte, incluso te ü•π

Se le offerte di capgo non ti si addicono, allora stabilisci il tuo prezzo e sostieni un Maker bootstrapped [QUI](https://githubcom/sponsors/riderx/) alle tue condizioni

## Installazione rapida

```
npm install @capgo/capacitor-updater
npx cap sync
```

### Configurazione

Devi configurare il plugin per utilizzare il tuo URL in questo modo:

```json
{
	"plugins": {
		"CapacitorUpdater": {
			"updateUrl": "https://TUOURL",
		}
	}
}
```

> üöß In android non √® consentito richiedere HTTP, per scopi di test [consentilo](https://stackoverflowcom/questions/45940861/android-8-cleartext-http-traffic-not-permitted/)

### API di Aggiornamento

Il plugin effettuer√† una chiamata POST alla tua API ogni volta che l'app viene aperta, con questo corpo:

```typescript
interface AppInfos {
    "platform": "ios" | "android",
    "device_id": "UUID_del_dispositivo_unico_per_installazione",
    "app_id": "APPID_DAL_CAPACITOR_CONFIG",
    "custom_id": "tuo_id_personalizzato_impostato_runtime",
    "plugin_version": "VERSIONE_PLUGIN",
    "version_build": "NUMERO_VERSIONE_DAL_CODICE_NATIVO",
    "version_code": "CODICE_VERSIONE_DAL_CODICE_NATIVO",
    "version_name": "ULTIMA_VERSIONE_SCARICATA" | "builtin"
    "version_os": "VERSIONE_DEL_SISTEMA_OS",
    "is_emulator": boolean,
    "is_prod": boolean,
}
```

Il server API dovrebbe rispondere, in JSON, al plugin capacitor-updater con questi dati se √® necessario un aggiornamento:

```json
{
"version": "123",
"url": "https://percorso_del_file_zip_del_codicecom"
}
```

In Auto-update il server dovrebbe fare il lavoro di confrontare la versione e restituire quella giusta, se la chiave URL √® presente, il plugin inizia il processo di download

Se aggiungi le chiavi "message" e "error", la versione non verr√† impostata e il messaggio verr√† visualizzato nei log invece

La chiave `version` dovrebbe essere nel formato [`semver`](https://semverorg/)

Lo zip dovrebbe avere `indexhtml` come file alla radice, o una sola cartella alla radice con `indexhtml` all'interno

Puoi utilizzare il comando della CLI per comprimere il tuo bundle:

```bash
npx @capgo/cli bundle zip --path [/percorso/del/mio/bundle]
```

<LinkCard
	title="Endpoint di Aggiornamento"
	href="/docs/self-hosted/auto-update/update-endpoint"
/>

#### Crittografia End-to-end

A partire dalla versione 4150 il plugin permette di inviare aggiornamenti crittografati

Puoi utilizzare questa funzione creando una chiave privata ``npx @capgo/cli key create``

Poi puoi crittografare il tuo file zip con ``npx @capgo/cli encrypt [percorso/dello/zip]``

Il comando ti stamper√† una `ivSessionKey` che deve essere inviata con il payload di aggiornamento nella chiave `session_key`\
Quindi la tua app potr√† utilizzare la chiave privata per decrittografare la `session_key` e utilizzare la `session_key` decrittografata per decrittografare l'aggiornamento

Scopri di pi√π qui:

<LinkCard
	title="Aggiornamenti Live Self-hosted"
	href="https://capgoapp/blog/self-hosted-live-updates/"
/>

### API delle Statistiche

A partire dalla versione 130 il sistema di aggiornamento invia statistiche!

Per impostazione predefinita, tutte le statistiche vengono inviate al nostro server, per comprendere l'utilizzo

> üí° Nessun dato privato viene inviato per le statistiche, solo UUID casuali, versione aggiornamento, versione app nativa, piattaforma, azione e ID app

Se vuoi inviare i dati al tuo server invece, modifica la configurazione qui sotto:

```tsx
// capacitorconfigjson
{
	"appId": "*******",
	"appName": "Nome",
	"plugins": {
		"CapacitorUpdater": {
			"statsUrl": "TUO_URL"
		}
	}
}
```

Quello che il tuo server ricever√† √®:

```tsx
interface AppInfosStats {
	"action": "set", // pu√≤ essere set, delete, set_fail, reset, revert
	// Poi sono le stesse informazioni dell'aggiornamento
	"app_id": "*******", // identificatore app nello store
	"device_id": "*******", // id unico per installazione app
	"platform": "ios", // o android
	"custom_id": "utente_1", // rappresenta il tuo utente
        "version_name": "123", // versione del build web
        "version_build": "120", // versione del build nativo
        "version_code": "120", // numero build del build nativo
	"version_os": "16", // versione OS del dispositivo
        "plugin_version": "400"// per far comportare la tua api diversamente con plugin diversi
        "is_emulator": false,
    	"is_prod": false,
}
```

Puoi anche disabilitarlo completamente, con una stringa vuota. Tieni presente che le statistiche sono rese private-friendly e mi aiutano a capire come le persone usano il plugin, per risolvere problemi e migliorarlo

<LinkCard
	title="Endpoint delle Statistiche"
	href="/docs/self-hosted/auto-update/stats-endpoint"
/>

### API dei Canali

Da documentare