---
title: "Devices"
description: "Documentazione per gestire i dispositivi tramite l'API Capgo, che copre tracciamento, versioning e assegnazioni di canali per installazioni di app."
sidebar:
  order: 7
---

I Devices rappresentano singole installazioni della tua app gestite da Capgo. L'API Devices ti permette di tracciare e gestire i dispositivi, incluse le loro versioni, canali e stato di aggiornamento.

:::note[Conservazione dei Dati]
I dati dei dispositivi vengono conservati per **90 giorni** dall'ultima attività del dispositivo. I dispositivi che non si sono connessi a Capgo entro questo periodo verranno automaticamente rimossi dal sistema. I dispositivi attivi vengono tracciati continuamente mentre controllano gli aggiornamenti.
:::

## Comprendere i Devices

Ogni dispositivo ha caratteristiche e stati unici:
- **Platform**: iOS o Android
- **Version**: Versione bundle corrente e versione build nativa
- **Environment**: Produzione o sviluppo, emulatore o dispositivo fisico
- **Channel**: Assegnazione canale di aggiornamento corrente
- **Custom ID**: Identificatore opzionale per i tuoi scopi di tracciamento

## Migliori Pratiche

1. **Tracciamento Versioni**: Monitora le versioni dei dispositivi per garantire l'adozione degli aggiornamenti
2. **Gestione Canali**: Assegna i dispositivi ai canali appropriati in base alle esigenze di test
3. **Consapevolezza Ambiente**: Gestisci diversi ambienti (prod/dev/emulator) in modo appropriato
4. **Identificazione Personalizzata**: Usa ID personalizzati per integrare con i tuoi sistemi esistenti

## Endpoints

### POST

`https://api.capgo.app/device/`

Collega un dispositivo a una versione o canale specifico.

#### Request Body

```typescript
interface DeviceLink {
  app_id: string
  device_id: string
  version_id?: string // version name
  channel?: string    // channel name
}
```

#### Richiesta di Esempio

```bash
curl -X POST \
  -H "authorization: your-api-key" \
  -H "Content-Type: application/json" \
  -d '{
    "app_id": "app_123",
    "device_id": "device_456",
    "channel": "beta"
  }' \
  https://api.capgo.app/device/
```

#### Risposta di Successo

```json
{
  "status": "ok"
}
```

### GET

`https://api.capgo.app/device/`

Recupera informazioni sul dispositivo. Utilizza la paginazione basata su cursore per un recupero efficiente di grandi liste di dispositivi.

#### Parametri Query
- `app_id`: Obbligatorio. L'ID della tua app
- `device_id`: Opzionale. ID dispositivo specifico per recuperare un singolo dispositivo
- `cursor`: Opzionale. Cursore dalla risposta precedente per la paginazione
- `limit`: Opzionale. Numero di dispositivi per pagina (predefinito: 50)

#### Richiesta di Esempios

```bash
# Get all devices (first page)
curl -H "authorization: your-api-key" \
  "https://api.capgo.app/device/?app_id=app_123"

# Get specific device
curl -H "authorization: your-api-key" \
  "https://api.capgo.app/device/?app_id=app_123&device_id=device_456"

# Get next page using cursor
curl -H "authorization: your-api-key" \
  "https://api.capgo.app/device/?app_id=app_123&cursor=2024-01-01T00:00:00Z|device_456"
```

#### Tipo di Risposta (Lista)

Quando si richiedono più dispositivi (nessun parametro `device_id`):

```typescript
interface DeviceListResponse {
  data: Device[];
  nextCursor?: string;  // Passa questo come parametro 'cursor' per ottenere la pagina successiva
  hasMore: boolean;     // true se ci sono più pagine disponibili
}

interface Device {
  updated_at: string;
  device_id: string;
  custom_id: string;
  version?: number;
  version_name: string | null;
  channel?: string;
  app_id: string;
  platform: "ios" | "android";
  plugin_version: string;
  os_version: string;
  version_build: string;
  is_prod: boolean;
  is_emulator: boolean;
}
```

#### Tipo di Risposta (Dispositivo Singolo)

Quando si richiede un dispositivo specifico con il parametro `device_id`, restituisce l'oggetto dispositivo direttamente:

```typescript
interface Device {
  updated_at: string;
  device_id: string;
  custom_id: string;
  version?: number;
  version_name: string | null;
  channel?: string;
  app_id: string;
  platform: "ios" | "android";
  plugin_version: string;
  os_version: string;
  version_build: string;
  is_prod: boolean;
  is_emulator: boolean;
}
```

#### Risposta di Esempio (Lista)

```json
{
  "data": [
    {
      "device_id": "device_456",
      "custom_id": "test-device-1",
      "version": 1,
      "version_name": "1.0.0",
      "app_id": "app_123",
      "platform": "ios",
      "plugin_version": "5.0.0",
      "os_version": "17.0",
      "version_build": "1",
      "is_prod": true,
      "is_emulator": false,
      "updated_at": "2024-01-01T00:00:00Z"
    }
  ],
  "nextCursor": "2024-01-01T00:00:00Z|device_456",
  "hasMore": true
}
```

#### Risposta di Esempio (Dispositivo Singolo)

```json
{
  "device_id": "device_456",
  "custom_id": "test-device-1",
  "version": 1,
  "version_name": "1.0.0",
  "app_id": "app_123",
  "platform": "ios",
  "plugin_version": "5.0.0",
  "os_version": "17.0",
  "version_build": "1",
  "is_prod": true,
  "is_emulator": false,
  "updated_at": "2024-01-01T00:00:00Z",
  "channel": "production"
}
```

### DELETE

`https://api.capgo.app/device/`

Scollega un dispositivo dalla sua sovrascrittura del canale. Questo reimposta il dispositivo per utilizzare il suo canale predefinito.

:::note[Elimina dispositivo]
I dati dei dispositivi vengono conservati per **90 giorni** dall'ultima attività del dispositivo. I dispositivi che non si sono connessi a Capgo entro questo periodo verranno automaticamente rimossi dal sistema. I dispositivi attivi vengono tracciati continuamente mentre controllano gli aggiornamenti.
Non puoi eliminare un dispositivo con questo endpoint, influisce solo sulla sovrascrittura del canale.
:::

#### Query Parameters

```typescript
interface Device {
  device_id: string
  app_id: string
}
```

#### Richiesta di Esempio

```bash
curl -X DELETE \
  -H "authorization: your-api-key" \
  -H "Content-Type: application/json" \
  -d '{
    "app_id": "app_123",
    "device_id": "device_456"
  }' \
  https://api.capgo.app/device/
```

#### Risposta di Successo

```json
{
  "status": "ok"
}
```

## Gestione degli Errori

Scenari di errore comuni e le loro risposte:

```json
// Device not found
{
  "error": "Device not found",
  "status": "KO"
}

// Invalid version
{
  "error": "Version not found",
  "status": "KO"
}

// Invalid channel
{
  "error": "Channel not found",
  "status": "KO"
}

// Permission denied
{
  "error": "Insufficient permissions to manage devices",
  "status": "KO"
}
```

## Casi d'Uso Comuni

1. **Beta Device Registration**
```typescript
{
  "app_id": "app_123",
  "device_id": "device_456",
  "channel": "beta"
}
```

2. **Version Override**
```typescript
{
  "app_id": "app_123",
  "device_id": "device_456",
  "version_id": "1.1.0"
}
```

3. **Reset to Default Channel**
```typescript
// Use DELETE endpoint to remove overrides
```

## Suggerimenti per la Gestione dei Dispositivi

1. **Monitoraggio**: Controlla regolarmente lo stato del dispositivo e la distribuzione delle versioni
2. **Test**: Usa ID personalizzati per identificare facilmente i dispositivi di test
3. **Risoluzione Problemi**: Traccia gli aggiornamenti dei dispositivi e le assegnazioni dei canali
4. **Controllo Versioni**: Monitora le versioni native dell'app per garantire la compatibilità 
