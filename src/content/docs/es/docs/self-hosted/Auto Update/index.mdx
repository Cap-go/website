---
title: 鉥넒끷 醇꼻述엀궞
description: C칩mo usar el plugin de actualizaci칩n autom치tica en modo autohospedado
sidebar:
  order: 1
locale: es
---

import { LinkCard, CardGrid } from '@astrojs/starlight/components';

Esta documentaci칩n explicar치 c칩mo ejecutar tu servidor de actualizaci칩n autom치tica

## Antes de empezar

Si usas este trabajo por tu cuenta, no podr칤a sugerir m치s que apoyes mi trabajo a trav칠s de [esto](https://githubcom/sponsors/riderx/)

Hice una gran apuesta al hacer de c칩digo abierto todo el valioso c칩digo que constru칤 aqu칤

Podr칤a haberlo guardado para m칤 y ponerle un precio alto

Adem치s, quiero centrarme en las herramientas de Capgo y hacer que sea un negocio abierto y transparente

Del mismo modo, creo que har칤a nuestro mundo un mejor lugar al abrir en lugar de luchar y ocultar

Pero para hacerlo posible, todos debemos hacer nuestra parte, incluido t칰 游봋

Si las ofertas de Capgo no te convienen, entonces pon tu precio y respalda a un Maker bootstrapped [AQU칈](https://githubcom/sponsors/riderx/) en tus t칠rminos

## Instalaci칩n r치pida

```
npm install @capgo/capacitor-updater
npx cap sync
```

### Configuraci칩n

Tienes que configurar el plugin para usar tu URL as칤:

```json
{
	"plugins": {
		"CapacitorUpdater": {
			"updateUrl": "https://TUURL",
		}
	}
}
```

> 游뚾 En Android no est치 permitido hacer peticiones HTTP, para prop칩sitos de prueba [perm칤telo](https://stackoverflowcom/questions/45940861/android-8-cleartext-http-traffic-not-permitted/)

### API de Actualizaci칩n

El plugin har치 una llamada POST a tu API cada vez que la aplicaci칩n se abra, con este cuerpo:

```typescript
interface AppInfos {
    "platform": "ios" | "android",
    "device_id": "UUID_del_dispositivo_칰nico_por_instalaci칩n",
    "app_id": "APPID_DE_CONFIGURACION_CAPACITOR",
    "custom_id": "tu_id_personalizado_establecido_en_tiempo_de_ejecuci칩n",
    "plugin_version": "VERSION_DEL_PLUGIN",
    "version_build": "NUMERO_VERSION_DEL_CODIGO_NATIVO",
    "version_code": "CODIGO_VERSION_DEL_CODIGO_NATIVO",
    "version_name": "ULTIMA_VERSION_DESCARGADA" | "builtin"
    "version_os": "VERSION_DEL_SISTEMA_OPERATIVO",
    "is_emulator": boolean,
    "is_prod": boolean,
}
```

El servidor API deber칤a responder, en JSON, al plugin capacitor-updater con estos datos si una actualizaci칩n es necesaria:

```json
{
"version": "123",
"url": "https://ruta_al_archivo_zip_del_codigo.com"
}
```

En Auto-update el servidor deber칤a hacer el trabajo de comparar la versi칩n y devolver la correcta, si la clave URL est치 presente, el plugin inicia el proceso de descarga

Si agregas las claves "message" y "error", la versi칩n no se establecer치, y el mensaje se mostrar치 en los registros en su lugar

La clave `version` debe estar en formato [`semver`](https://semver.org/)

El zip debe tener `index.html` como archivo en la ra칤z, o solo una carpeta en la ra칤z con `index.html` dentro

Puedes usar el comando de la CLI para comprimir tu bundle:

```bash
npx @capgo/cli bundle zip --path [/ruta/a/mi/bundle]
```

<LinkCard
	title="Endpoint de Actualizaci칩n"
	href="/docs/self-hosted/auto-update/update-endpoint"
/>

#### Cifrado de extremo a extremo

A partir de la versi칩n 4.15.0 el plugin permite enviar actualizaciones cifradas

Puedes usar esta caracter칤stica creando una clave privada ``npx @capgo/cli key create``

Luego cifras tu archivo zip con ``npx @capgo/cli encrypt [ruta/al/zip]``

El comando te mostrar치 un `ivSessionKey` que debe ser enviado con tu payload de actualizaci칩n en la clave `session_key`\
Entonces tu app podr치 usar la clave privada para descifrar el `session_key` y usar el `session_key` descifrado para descifrar la actualizaci칩n

Aprende m치s sobre esto aqu칤:

<LinkCard
	title="Actualizaciones en vivo auto-alojadas"
	href="https://capgo.app/blog/self-hosted-live-updates/"
/>

### API de Estad칤sticas

춰A partir de la versi칩n 1.3.0 el sistema de actualizaci칩n env칤a estad칤sticas!

Por defecto, todas las estad칤sticas se env칤an a nuestro servidor, para entender el uso

> 游눠 No se env칤an datos privados para las estad칤sticas, solo UUID aleatorio, versi칩n de actualizaci칩n, versi칩n de app nativa, plataforma, acci칩n y ID de app

Si quieres enviar datos a tu servidor en su lugar, cambia la configuraci칩n a continuaci칩n:

```tsx
// capacitor.config.json
{
	"appId": "*******",
	"appName": "Name",
	"plugins": {
		"CapacitorUpdater": {
			"statsUrl": "TU_URL"
		}
	}
}
```

Lo que tu servidor recibir치 es:

```tsx
interface AppInfosStats {
	"action": "set", // puede ser set, delete, set_fail, reset, revert
	// Luego es la misma informaci칩n que la actualizaci칩n
	"app_id": "*******", // identificador de app en la tienda
	"device_id": "*******", // id 칰nico por instalaci칩n de app
	"platform": "ios", // o android
	"custom_id": "usuario_1", // representa tu usuario
        "version_name": "123", // versi칩n de la compilaci칩n web
        "version_build": "120", // versi칩n de la compilaci칩n nativa
        "version_code": "120", // n칰mero de compilaci칩n de la compilaci칩n nativa
	"version_os": "16", // versi칩n del SO del dispositivo
        "plugin_version": "4.0.0"// para hacer que tu api se comporte diferente con diferentes plugins
        "is_emulator": false,
    	"is_prod": false,
}
```

Tambi칠n puedes deshabilitarlo completamente, con una cadena vac칤a. Ten en cuenta que las estad칤sticas est치n hechas amigables con la privacidad y me ayudan a entender c칩mo la gente usa el plugin, para resolver problemas y mejorarlo

<LinkCard
	title="Endpoint de Estad칤sticas"
	href="/docs/self-hosted/auto-update/stats-endpoint"
/>

### API de Canal

Por documentar