---
title: Introduction - Mise  jour automatique
description: C贸mo usar el complemento de actualizaci贸n autom谩tica en modo autohospedado
sidebar:
  order: 1
locale: es
---

import { LinkCard, CardGrid } from '@astrojs/starlight/components';

Esta documentaci贸n explicar谩 c贸mo ejecutar tu servidor de actualizaci贸n autom谩tica

## Antes de empezar

Si utilizas este trabajo por tu cuenta, no puedo sugerir m谩s que apoyes mi trabajo a trav茅s de [esto](https://githubcom/sponsors/riderx/)

Hice una gran apuesta al c贸digo abierto de todo el valioso c贸digo que constru铆 aqu铆

Podr铆a haberlo guardado para m铆 y ponerle un precio alto

Adem谩s, quiero centrarme en las herramientas de Capgo y convertirlo en un negocio abierto y transparente

Asimismo, creo que har铆a de nuestro mundo un lugar mejor al abrir en lugar de luchar y esconder

Pero para hacerlo posible, todos debemos hacer nuestra parte, incluido t煤 ス

Si las ofertas de Capgo no te convienen, entonces establece tu precio y respalda a un creador independiente [AQU](https://githubcom/sponsors/riderx/) en tus t茅rminos

## Instalaci贸n r谩pida

```
npm install @capgo/capacitor-updater
npx cap sync
```

### Configuraci贸n

Tienes que configurar el plugin para usar tu URL as铆:

```json
{
	"plugins": {
		"CapacitorUpdater": {
			"updateUrl": "https://TUURL",
		}
	}
}
```

>  En Android no est谩 permitido hacer peticiones HTTP, para pruebas [perm铆telo](https://stackoverflowcom/questions/45940861/android-8-cleartext-http-traffic-not-permitted/)

### API de actualizaci贸n

El plugin har谩 una llamada POST a tu API cada vez que se abra la aplicaci贸n, con este cuerpo:

```typescript
interface AppInfos {
    "platform": "ios" | "android",
    "device_id": "UUID_del_dispositivo_煤nico_por_instalaci贸n",
    "app_id": "APPID_DE_CONFIGURACION_CAPACITOR",
    "custom_id": "tu_id_personalizado_establecido_en_tiempo_de_ejecuci贸n",
    "plugin_version": "VERSION_DEL_PLUGIN",
    "version_build": "NUMERO_VERSION_DEL_CODIGO_NATIVO",
    "version_code": "CODIGO_VERSION_DEL_CODIGO_NATIVO",
    "version_name": "ULTIMA_VERSION_DESCARGADA" | "builtin"
    "version_os": "VERSION_DEL_SISTEMA_OPERATIVO",
    "is_emulator": boolean,
    "is_prod": boolean,
}
```

El servidor API debe responder, en JSON, al plugin capacitor-updater con estos datos si es necesaria una actualizaci贸n:

```json
{
"version": "123",
"url": "https://ruta_al_archivo_zip_del_codigo.com"
}
```

En Auto-update el servidor debe hacer el trabajo de comparar la versi贸n y devolver la correcta, si la clave URL est谩 presente, el plugin inicia el proceso de descarga

Si agregas las claves "message" y "error", la versi贸n no se establecer谩 y el mensaje se mostrar谩 en los registros en su lugar

La clave `version` debe estar en formato [`semver`](https://semverorg/)

El zip debe tener `indexhtml` como archivo en la ra铆z, o solo una carpeta en la ra铆z con `indexhtml` dentro

Puedes usar el comando de la CLI para comprimir tu paquete:

```bash
npx @capgo/cli bundle zip --path [/ruta/a/mi/paquete]
```

<LinkCard
	title="Endpoint de Actualizaci贸n"
	href="/docs/self-hosted/auto-update/update-endpoint"
/>

#### Cifrado de extremo a extremo

A partir de la versi贸n 4150 el plugin permite enviar actualizaciones cifradas

Puedes usar esta funci贸n creando una clave privada ``npx @capgo/cli key create``

Luego cifras tu archivo zip con ``npx @capgo/cli encrypt [ruta/al/zip]``

El comando te mostrar谩 un `ivSessionKey` que debe enviarse con tu carga 煤til de actualizaci贸n en la clave `session_key`\
Entonces tu aplicaci贸n podr谩 usar la clave privada para descifrar el `session_key` y usar el `session_key` descifrado para descifrar la actualizaci贸n

Aprende m谩s sobre esto aqu铆:

<LinkCard
	title="Actualizaciones en vivo auto-alojadas"
	href="https://capgoapp/blog/self-hosted-live-updates/"
/>

### API de Estad铆sticas

隆A partir de la versi贸n 130 el sistema de actualizaci贸n env铆a estad铆sticas!

Por defecto, todas las estad铆sticas se env铆an a nuestro servidor, para entender el uso

>  No se env铆an datos privados para las estad铆sticas, solo UUID aleatorio, versi贸n de actualizaci贸n, versi贸n de la aplicaci贸n nativa, plataforma, acci贸n y ID de la aplicaci贸n

Si quieres enviar datos a tu servidor en su lugar, cambia la configuraci贸n a continuaci贸n:

```tsx
// capacitorconfigjson
{
	"appId": "*******",
	"appName": "Nombre",
	"plugins": {
		"CapacitorUpdater": {
			"statsUrl": "TU_URL"
		}
	}
}
```

Lo que tu servidor recibir谩 es:

```tsx
interface AppInfosStats {
	"action": "set", // puede ser set, delete, set_fail, reset, revert
	// Luego es la misma informaci贸n que la actualizaci贸n
	"app_id": "*******", // identificador de la aplicaci贸n en la tienda
	"device_id": "*******", // id 煤nico por instalaci贸n de la aplicaci贸n
	"platform": "ios", // o android
	"custom_id": "usuario_1", // representa a tu usuario
        "version_name": "123", // versi贸n de la compilaci贸n web
        "version_build": "120", // versi贸n de la compilaci贸n nativa
        "version_code": "120", // n煤mero de compilaci贸n de la compilaci贸n nativa
	"version_os": "16", // versi贸n del SO del dispositivo
        "plugin_version": "400"// para que tu api se comporte diferente con diferentes plugins
        "is_emulator": false,
    	"is_prod": false,
}
```

Tambi茅n puedes desactivarlo completamente, con una cadena vac铆a. Ten en cuenta que las estad铆sticas est谩n hechas de manera amigable con la privacidad y me ayudan a entender c贸mo la gente usa el plugin, para resolver problemas y mejorarlo

<LinkCard
	title="Endpoint de Estad铆sticas"
	href="/docs/self-hosted/auto-update/stats-endpoint"
/>

### API de Canal

Por documentar