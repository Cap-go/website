---
title: Inicio de Sesi√≥n de Google con Supabase - Configuraci√≥n General
locale: es
description: Aprende c√≥mo configurar el inicio de sesi√≥n de Google con Supabase Authentication usando el Plugin Capacitor Inicio de sesi√≥n social.
sidebar:
    order: 1
---
Importar { Pasos } De '@astrojs/starlight/components';

## Introducci√≥n

Esta gu√≠a te llevar√° a trav√©s de la integraci√≥n del inicio de sesi√≥n de Google con Supabase Authentication usando el Plugin Capacitor Inicio de sesi√≥n social. Esta configuraci√≥n te permite usar el inicio de sesi√≥n nativo de Google en plataformas m√≥viles mientras aprovechas Supabase Auth para la autenticaci√≥n backend.

## Requisitos Previos

Antes de comenzar, aseg√∫rate de tener:

1. [Creado un proyecto de Supabase](https://database.new/)
2. Le√≠do la gu√≠a de [Configuraci√≥n General de inicio de sesi√≥n de Google](/docs/plugins/social-login/google/general/) para configurar las credenciales OAuth de Google
3. Seguido las respectivas gu√≠as espec√≠ficas de plataforma para configurar las credenciales OAuth de Google para tu plataforma objetivo:
    - [Configuraci√≥n de Android](/docs/plugins/social-login/google/android/)
    - [Configuraci√≥n de iOS](/docs/plugins/social-login/google/ios/)
    - [Configuraci√≥n Web](/docs/plugins/social-login/google/web/)

    :::Nota
        Antes de comenzar el Tutorial de Supabase, necesitas generar los IDs de cliente para las plataformas que planeas usar.
        Los usar√°s en el paso 7 de esta gu√≠a.
    :::

## Habilitar el proveedor OAuth de Google en Supabase

<Pasos>
1. Ve a tu [Panel de Supabase](https://app.supabase.com/)
2. Haz clic en tu proyecto
    <img src="/social-login-assets/supabase_project_select.webp" alt="Selector de Proyecto de Supabase" />
3. Ve al men√∫ de `Authentication`
    <img src="/social-login-assets/supabase_authentication_menu.webp" alt="Men√∫ de Autenticaci√≥n de Supabase" />
4. Haz clic en la pesta√±a `Providers`
    <img src="/social-login-assets/supabase_providers_tab.webp" alt="Pesta√±a de Proveedores de Supabase" />
5. Encuentra el proveedor `Google`
    <img src="/social-login-assets/supabase_google_provider.webp" alt="Proveedor de Google de Supabase" />
6. Habilita el proveedor
    <img src="/social-login-assets/supabase_google_provider_enable.webp" alt="Habilitar Proveedor de Google de Supabase" />
7. Agrega los IDs de cliente para las plataformas que planeas usar
    <img src="/social-login-assets/supabase_google_provider_add_client_ids.webp" alt="Agregar IDs de Cliente del Proveedor de Google de Supabase" />

    :::Nota
        Esto incluye el ID de cliente web, el ID de cliente iOS y el ID de cliente Android. Puedes omitir algunos de ellos, dependiendo de las plataformas que planees usar.
    :::
8. Haz clic en el bot√≥n `Save`
    <img src="/social-login-assets/supabase_google_provider_save.webp" alt="Guardar Proveedor de Google de Supabase" />

</Pasos>

:::Nota
__**NO DEBES**__ configurar `Client Secret (for OAuth)` o `Callback URL (for OAuth)`. Algunas fuentes tambi√©n podr√≠an sugerir configurar `Skip nonce checks` para Google en iOS, pero con esta gu√≠a no es necesario.
:::

¬°Voil√†, ahora has habilitado el inicio de sesi√≥n de Google con Supabase Authentication! üéâ

## C√≥mo Funciona el Helper de Inicio de Sesi√≥n de Google con Supabase Authentication

Esta secci√≥n explica c√≥mo funciona la integraci√≥n del inicio de sesi√≥n de Google con Supabase bajo el cap√≥. Entender este flujo te ayudar√° a implementar y solucionar problemas del proceso de autenticaci√≥n.

:::Consejo[Implementaci√≥n Completa]
La implementaci√≥n completa est√° disponible en el archivo [`supabaseAuthUtils.ts` de la aplicaci√≥n de ejemplo](https://github.com/Cap-go/capacitor-social-login/blob/main/example-app/src/supabaseAuthUtils.ts).
:::

### 1. Generaci√≥n de Nonce

La implementaci√≥n genera un par de nonce seguro siguiendo los [requisitos de nonce de Supabase](https://react-native-google-signin.github.io/docs/security#usage-with-supabase):

```typescript
// Genera nonce aleatorio seguro para URL
function getUrlSafeNonce(): string {
  const array = new Uint8Array(32);
  crypto.getRandomValues(array);
  return Array.from(array, (byte) => byte.toString(16).padStart(2, '0')).join('');
}

// Hash del nonce con SHA-256
async function sha256Hash(message: string): Promise<string> {
  const encoder = new TextEncoder();
  const data = encoder.encode(message);
  const hashBuffer = await crypto.subtle.digest('SHA-256', data);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map((b) => b.toString(16).padStart(2, '0')).join('');
}

// Genera par de nonce
async function getNonce(): Promise<{ rawNonce: string; nonceDigest: string }> {
  const rawNonce = getUrlSafeNonce();
  const nonceDigest = await sha256Hash(rawNonce);
  return { rawNonce, nonceDigest };
}
```

**Flujo:**
- `rawNonce`: Cadena aleatoria segura para URL (64 caracteres hexadecimales)
- `nonceDigest`: Hash SHA-256 del `rawNonce` (codificado en hexadecimal)
- `nonceDigest` se pasa a Google Sign-In ‚Üí Google incluye el digest del nonce en el token ID
- `rawNonce` se pasa a Supabase ‚Üí Supabase hashea el nonce raw y lo compara con el nonce del token

### 2. Inicio de Sesi√≥n de Google

La funci√≥n inicializa el Plugin e inicia sesi√≥n con Google:

```typescript
await SocialLogin.initialize({
  google: {
    webClientId: 'YOUR_WEB_CLIENT_ID.apps.googleusercontent.com',
    // Solo iOS:
    iOSClientId: 'YOUR_IOS_CLIENT_ID.apps.googleusercontent.com',
    mode: 'online', // Requerido para obtener idToken
  },
});

const response = await SocialLogin.login({
  provider: 'google',
  options: {
    scopes: ['email', 'profile'],
    nonce: nonceDigest, // Pasa el nonce hasheado con SHA-256
  },
});
```

### 3. Validaci√≥n de JWT

Antes de enviar el token a Supabase, la implementaci√≥n valida el token JWT:

```typescript
function validateJWTToken(idToken: string, expectedNonceDigest: string): { valid: boolean; error?: string } {
  const decodedToken = decodeJWT(idToken);

  // Verifica que la audiencia coincida con tus IDs de Cliente de Google
  const audience = decodedToken.aud;
  if (!VALID_GOOGLE_CLIENT_IDS.includes(audience)) {
    return { valid: false, error: 'Invalid audience' };
  }

  // Verifica que el nonce coincida
  const tokenNonce = decodedToken.nonce;
  if (tokenNonce && tokenNonce !== expectedNonceDigest) {
    return { valid: false, error: 'Nonce mismatch' };
  }

  return { valid: true };
}
```

**¬øPor qu√© validar antes de Supabase?**

Validar el token JWT antes de enviar el token a Supabase sirve varios prop√≥sitos importantes:

1. **Prevenir Solicitudes Inv√°lidas**: Si el token tiene una audiencia incorrecta o discrepancia de nonce, Supabase rechazar√° el token de todos modos. Validar primero evita llamadas innecesarias a la API y proporciona mensajes de Error m√°s claros.

2. **Problemas de Cach√© de Tokens**: En algunas plataformas (especialmente iOS), el SDK de Google Sign-In puede cachear tokens por rendimiento. Cuando se devuelve un token en cach√©, el token en cach√© puede haber sido generado con un nonce diferente (o sin nonce), causando que Supabase rechace el token con un Error de "discrepancia de nonce". Al validar antes de enviar a Supabase, podemos detectar este problema temprano y reintentar autom√°ticamente con un token fresco.

3. **Seguridad** (iOS): En iOS, la validaci√≥n asegura que el token fue emitido para tus IDs de Cliente de Google espec√≠ficos, previniendo potenciales problemas de seguridad por usar tokens destinados a otras aplicaciones.

4. **Mejor Manejo de Errores**: Detectar problemas antes de Supabase permite l√≥gica de reintento autom√°tico, que es esencial para manejar problemas de cach√© de iOS de manera transparente.

Si la validaci√≥n falla, la funci√≥n autom√°ticamente:
1. Cierra sesi√≥n de Google (limpia los tokens en cach√© - cr√≠tico en iOS)
2. Reintenta la autenticaci√≥n una vez (fuerza la generaci√≥n de token fresco con nonce correcto)
3. Si el reintento tambi√©n falla, devuelve un Error

### 4. Inicio de Sesi√≥n en Supabase

Finalmente, el token validado se env√≠a a Supabase:

```typescript
const { data, error } = await supabase.auth.signInWithIdToken({
  provider: 'google',
  token: googleResponse.idToken,
  nonce: rawNonce, // Pasa el nonce raw (sin hashear)
});
```

## Referencia Completa del C√≥digo

La implementaci√≥n completa est√° disponible en el archivo [`supabaseAuthUtils.ts` de la aplicaci√≥n de ejemplo](https://github.com/Cap-go/capacitor-social-login/blob/main/example-app/src/supabaseAuthUtils.ts), que incluye:

- `getUrlSafeNonce()` - Genera nonce aleatorio seguro para URL
- `sha256Hash()` - Hashea cadena con SHA-256
- `getNonce()` - Genera par de nonce
- `decodeJWT()` - Decodifica token JWT
- `validateJWTToken()` - Valida audiencia y nonce del JWT
- `authenticateWithGoogleSupabase()` - Funci√≥n principal de autenticaci√≥n con reintento autom√°tico

### Archivos de Ejemplo Adicionales

- [SupabasePage.tsx](https://github.com/Cap-go/capacitor-social-login/blob/main/example-app/src/SupabasePage.tsx) - Componente de ejemplo con manejo de redirecci√≥n (Web)
- [SupabaseCreateAccountPage.tsx](https://github.com/Cap-go/capacitor-social-login/blob/main/example-app/src/SupabaseCreateAccountPage.tsx) - P√°gina de ejemplo para crear cuenta

## Siguientes Pasos

Por favor contin√∫a con la gu√≠a de configuraci√≥n espec√≠fica de plataforma para tu plataforma objetivo:

- [Configuraci√≥n de Android](../android/)
- [Configuraci√≥n de iOS](../ios/)
- [Configuraci√≥n Web](../web/)
