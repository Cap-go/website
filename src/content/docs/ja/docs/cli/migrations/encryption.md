---
title: 暗号化
description: データを新しい暗号化方式でエンコード
sidebar:
  order: 5
locale: ja
---

この文書では、新しい暗号化システムでデータを暗号化し、古いシステムを削除する方法について説明します

新しい暗号化システムについては、[ブログ記事](/blog/introducing-end-to-end-security-to-capacitor-updater-with-code-signing)で詳しく説明しています

---

まず、次のコマンドで新しい鍵ペアを作成します：

```bash
npx @capgo/cli key create
```

このコマンドはアプリに新しい鍵ペアを作成します。秘密鍵は安全な場所に保管することが非常に重要です。秘密鍵はソースコントロールにコミットしたり、信頼できない相手と共有したりしてはいけません

このコマンドはCapacitorの設定から古い鍵を削除しますが、古い鍵ファイルは削除しません。CLIはアプリストアの更新を受けていない古いプラグインを使用しているアプリに対してライブアップデートを継続して送信できるよう、これらを保持します。これにより移行が容易になります

移行時に「古いアプリをサポートし移行を容易にするために、新しいチャンネルで暗号化を設定しますか？」と尋ねられた場合は、同意してください。これによりCapacitorの設定に新しい「defaultChannel」オプションが追加されます。これによりアプリは「encryption_v2」チャンネルを使用するようになります。これにより、新しい暗号化はそれをサポートするアプリでのみ使用されます。アプリストアの更新を受けていないアプリは、以前のデフォルトチャンネルを使用し続けます

---

次に、JSバンドルをビルドして新しいチャンネルにアップロードする必要があります。次のコマンドを実行してください：

```bash
npx @capgo/cli bundle upload --channel encryption_v2
```

---

次に、アプリが「encryption_v2」チャンネルに自己割り当てできるようにするために、このコマンドを実行します：

:::caution
これは新しい「defaultChannel」オプションが機能するために必要です
:::

```bash
npx @capgo/cli channel set encryption_v2 --self-assign
```

---

これでアプリを実行できます。新しい暗号化システムが使用されます

古いチャンネルに新しいJSバンドルをアップロードするには、次のコマンドを実行するだけです：

```bash
npx @capgo/cli bundle upload --channel production
```

---

Capacitorの設定については心配する必要はありません。これはCapgoにアップロードされることはありません

すべてのユーザーがアプリを更新したら（3〜4ヶ月かかる可能性があります）、Capacitorの設定から「defaultChannel」を削除できます

そして、次のコマンドで古いチャンネルを削除できます：

```bash
npx @capgo/cli channel delete encryption_v2
```

---

「encryption_v2」チャンネルを削除すると、それをデフォルトとして使用していたすべてのアプリは「production」チャンネルの使用を開始します