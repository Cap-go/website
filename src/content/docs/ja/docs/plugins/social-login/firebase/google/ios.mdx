---
title: iOSでのFirebase Googleログイン
locale: ja
description: Capacitor Social LoginプラグインでiOSでFirebase AuthenticationによるGoogleサインインを設定する方法を学びます。
sidebar:
    order: 3
---
import { Steps } from '@astrojs/starlight/components';

## はじめに

このガイドでは、iOSでFirebase AuthenticationとGoogleサインインを統合する方法を説明します。[一般的なFirebase Googleの設定](./general/)をすでに完了していることを前提としています。

:::note
Firebase ConsoleでiOSアプリをまだ作成していないことを前提としています。すでに作成している場合は、手順が少し異なります。
:::

## 設定手順

<Steps>
1. [console.cloud.google.com](https://console.cloud.google.com/)でプロジェクト概要に移動します
    <img src="/social-login-assets/firebase_project_overview.webp" alt="Firebase Project Overview" />

2. `Add app`ボタンをクリックします
    <img src="/social-login-assets/firebase_project_add_app.webp" alt="Firebase Add App Button" />

    :::note
    Firebase Consoleで既に別のアプリを作成している場合は、ここでこのボタンを探す必要がある場合があります。これは、すでにFirebase Consoleで別のアプリを作成している場合にのみ適用されます。
    :::

    <img src="/social-login-assets/firebase_project_add_app_2.webp" alt="Firebase Add App Button" />
3. `iOS`を選択します
    <img src="/social-login-assets/firebase_project_add_app_ios.webp" alt="Firebase Add App iOS Button" />

4. フォームの最初の部分を入力します
   1. `Apple bundle ID`を入力します
      1. `npx cap open ios`を使用してXcodeでアプリを開きます
      2. `App`をダブルクリックします
         <img src="/social-login-assets/xcode_app_click.png" alt="App target in Xcode project navigator" />
      3. `Targets -> App`にいることを確認します
         <img src="/social-login-assets/xcode_targets_app.png" alt="Targets section in Xcode with App selected" />
      4. `Bundle Identifier`を見つけます
          <img src="/social-login-assets/xcode_bundle_id.png" alt="Bundle Identifier field in Xcode project settings" />
          :::note
          ここに表示されるIDは、ガイドの残りの部分で使用するものとは異なります。ガイドの残りの部分では`app.capgo.plugin.SocialLogin`を使用します。
          :::
      5. `Bundle Identifier`をコピーしてFirebase consoleに貼り付けます
         <img src="/social-login-assets/firebase_project_add_app_ios_bundle_id.webp" alt="Firebase Add App iOS Bundle ID Field" />
   2. `Register app`ボタンをクリックします
         <img src="/social-login-assets/firebase_project_add_app_ios_register.webp" alt="Firebase Add App iOS Register Button" />
5. `Download config file`ステップをスキップします
    <img src="/social-login-assets/firebase_project_add_app_ios_skip_download.webp" alt="Firebase Add App iOS Skip Download Button" />
6. `Add firebase SDK`ステップをスキップします
    <img src="/social-login-assets/firebase_project_add_app_ios_skip_download_firebase_sdk_2.webp" alt="Firebase Add App iOS Skip Download Firebase SDK Button" />
7. `Add initialization code`ステップをスキップします
    <img src="/social-login-assets/firebase_project_add_app_ios_skip_download_firebase_sdk.webp" alt="Firebase Add App iOS Skip Add Initialization Code Button" />
8. `Continue to console`ボタンをクリックします
    <img src="/social-login-assets/firebase_project_add_app_ios_continue_to_console.webp" alt="Firebase Add App iOS Continue to Console Button" />
9. iOS client IDと`YOUR_DOT_REVERSED_IOS_CLIENT_ID`を取得します
   1. [console.cloud.google.com](https://console.cloud.google.com/)のGoogle Cloud Consoleにアクセスします
   2. プロジェクトを見つけます
      1. プロジェクトセレクターをクリックします
         <img src="/social-login-assets/firebase_double_check_gc_project_select.webp" alt="Google Cloud Console Project Selector" />
      2. Firebaseプロジェクトの正確な名前でプロジェクトを検索してクリックします。私の場合は`sociallogin-tutorial-app`です。
         <img src="/social-login-assets/firebase_gc_project_select_project.webp" alt="Firebase Project Selector Project" />
   3. 検索バーを開いて`credentials`を開きます
      1. 検索バーを開きます
         <img src="/social-login-assets/firebase_double_check_gc_search_bar.webp" alt="Google Cloud Console Search Bar" />
      2. `credentials`を検索し、`APIs and Services`（スクリーンショットの2番）をクリックします
         <img src="/social-login-assets/firebase_gc_credentials_search.webp" alt="Google Cloud Console Credentials Search" />
   4. `iOS client for [YOUR_APP_ID] (auto created by Google Service)`をクリックします。私の場合は`sociallogin-tutorial-app`です。
      <img src="/social-login-assets/firebase_gc_credentials_ios_client_id.webp" alt="Google Cloud Console Credentials iOS Client ID" />
   5. `Client ID`と`iOS URL scheme`をコピーします。これらがそれぞれ`iOSClientId`と`YOUR_DOT_REVERSED_IOS_CLIENT_ID`になります。

      :::note
      `iOSClientId`はプラグインの`initialize`メソッドで渡し、`YOUR_DOT_REVERSED_IOS_CLIENT_ID`はこのガイドの次のパートで説明されているように、アプリの`Info.plist`ファイルで使用します。
      :::

      <img src="/social-login-assets/firebase_gc_credentials_ios_client_id_copy.webp" alt="Google Cloud Console Credentials iOS Client ID Copy" />
10. Web client IDを取得します
    1. Firebase consoleに戻り、`Build` -> `Authentication`に移動します
        <img src="/social-login-assets/firebase_select_authentication.webp" alt="Firebase Authentication Menu" />
    2. `Sign-in method`ボタンをクリックします
        <img src="/social-login-assets/firebase_select_authentication_sign_in_method.webp" alt="Firebase Authentication Sign-in Method Button" />
    3. `Google`プロバイダーをクリックします
        <img src="/social-login-assets/firebase_select_authentication_sign_in_method_google.webp" alt="Firebase Authentication Sign-in Method Google Provider" />
    4. `Web SDK configuration`ボタンをクリックします
        <img src="/social-login-assets/firebase_select_authentication_sign_in_method_web_sdk_configuration.webp" alt="Firebase Authentication Sign-in Method Web SDK Configuration Button" />
    5. `Web client ID`をコピーします。これがプラグインの`initialize`メソッドの`webClientId`になります。
        <img src="/social-login-assets/firebase_select_authentication_sign_in_method_web_sdk_configuration_web_client_id.webp" alt="Firebase Authentication Sign-in Method Web SDK Configuration Web Client ID" />
11. アプリの Info.plistを変更します
    1. Xcodeを開いて`Info.plist`ファイルを見つけます
        <img src="/social-login-assets/xcode_info_file.png" alt="Info.plist file in Xcode project navigator" />
    2. このファイルを右クリックしてソースコードとして開きます
        <img src="/social-login-assets/xcode_open_as_src_code.png" alt="Right-click menu showing Open As Source Code option" />
    3. `Plist`ファイルの下部に`</dict>`タグが表示されます
        <img src="/social-login-assets/xcode_dict_tag.png" alt="Closing dict tag in Info.plist file" />
    4. 閉じる`</dict>`タグの直前に次のフラグメントを挿入します
        <img src="/social-login-assets/xcode_plist_inserted.png" alt="Info.plist with URL schemes code inserted before closing dict tag" />

        ```xml
        <key>CFBundleURLTypes</key>
        <array>
        <dict>
          <key>CFBundleURLSchemes</key>
          <array>
            <string>YOUR_DOT_REVERSED_IOS_CLIENT_ID</string>
          </array>
        </dict>
        </array>
        <key>GIDClientID</key>
        <string>YOUR_IOS_CLIENT_ID.apps.googleusercontent.com</string>
        ```

    5. `YOUR_DOT_REVERSED_IOS_CLIENT_ID`をステップ9でコピーした値（iOS URL scheme）に変更します
        <img src="/social-login-assets/xcode_plist_final.png" alt="Info.plist with actual reversed client ID inserted in URL schemes" />

        :::caution
        この値が`com.googleusercontent.apps`で**始まる**ことを確認してください
        :::

   6. `YOUR_IOS_CLIENT_ID`をステップ9でコピーしたiOS Client IDに変更します

   7. `Command + S`でファイルを保存します

12. `AppDelegate.swift`を変更します
    1. AppDelegateを開きます
        <img src="/social-login-assets/xcode_app_deleg.png" alt="AppDelegate.swift file in Xcode project navigator" />
    2. ファイルの先頭に`import GoogleSignIn`を挿入します
        <img src="/social-login-assets/xcode_app_deleg_google_sign_in.png" alt="AppDelegate.swift with GoogleSignIn import added" />
    3. `func application(_ app: UIApplication, open url: URL, options: [UIApplication.OpenURLOptionsKey: Any] = [:])`関数を見つけます
        <img src="/social-login-assets/xcode_app_deleg_app_fn.png" alt="Original application openURL function in AppDelegate" />
    4. 関数を次のように変更します

        ```swift
        func application(_ app: UIApplication, open url: URL, options: [UIApplication.OpenURLOptionsKey: Any] = [:]) -> Bool {
            // Called when the app was launched with a url. Feel free to add additional processing here,
            // but if you want the App API to support tracking app url opens, make sure to keep this call

            var handled: Bool

            handled = GIDSignIn.sharedInstance.handle(url)
            if handled {
              return true
            }

            return ApplicationDelegateProxy.shared.application(app, open: url, options: options)
        }
        ```

        <img src="/social-login-assets/xcode_app_deleg_app_fn_mod.png" alt="Modified application openURL function with GoogleSignIn handling" />

    5. `Command + S`でファイルを保存します

15. アプリでGoogleログインを使用する

    この時点で、アプリでGoogleログインを使用する準備が整いました。
    サンプルアプリの[authUtils.ts](https://github.com/Cap-go/capacitor-social-login/blob/main/example-app/src/authUtils.ts)ファイルを使用してGoogleで認証してください。
</Steps>

 ユーザーは初回サインイン時にFirebase Authで自動的に作成されます

## トラブルシューティング

認証がハングまたは失敗する場合:

- `idToken`のaudienceがFirebaseのWeb client IDと一致していることを確認してください
- Firebase ConsoleでGoogleサインインが有効になっていることを確認してください
- Info.plistに正しいURL schemesとGIDClientIDがあることを確認してください
- `iOSServerClientId`がWeb client IDと一致していることを確認してください
- 参考として[サンプルアプリコード](https://github.com/Cap-go/capacitor-social-login/tree/main/example-app/src/authUtils.ts)を確認してください
