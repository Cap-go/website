---
title: はじめに
description: iOS のオーディオルート変更と中断に反応するように AudioSession プラグインを設定する
sidebar:
  order: 2
locale: ja
---

import { Steps } from '@astrojs/starlight/components';
import { PackageManagers } from 'starlight-package-managers'

> ℹ️ **プラットフォームサポート:** オーディオセッション API は iOS で利用可能です。Android と Web での呼び出しは影響なく解決するため、共有ロジックを保持できます。

<Steps>
1. **パッケージをインストール**
   <PackageManagers pkg="@capgo/capacitor-plugin-audiosession" pkgManagers={['npm', 'pnpm', 'yarn', 'bun']} />

2. **iOS プラットフォームを同期**
   <PackageManagers type="exec" pkg="cap" args="sync ios" pkgManagers={['npm', 'pnpm', 'yarn', 'bun']} />
</Steps>

## 利用可能な出力を検査

```typescript
import { AudioSession, AudioSessionPorts } from '@capgo/capacitor-plugin-audiosession';

const outputs = await AudioSession.currentOutputs();

if (outputs.includes(AudioSessionPorts.BLUETOOTH_A2DP)) {
  console.log('Bluetooth speaker connected');
}
```

## スピーカーモードでのオーバーライド

```typescript
import { AudioSession, OutputOverrideType } from '@capgo/capacitor-plugin-audiosession';

await AudioSession.overrideOutput(OutputOverrideType.speaker);

// Restore system routing when you are done
await AudioSession.overrideOutput(OutputOverrideType.default);
```

## ルート変更と中断イベントをリッスン

```typescript
import { AudioSession, RouteChangeReasons, InterruptionTypes } from '@capgo/capacitor-plugin-audiosession';

const routeListener = await AudioSession.addListener('routeChanged', (reason) => {
  if (reason === RouteChangeReasons.NEW_DEVICE_AVAILABLE) {
    console.log('User connected a new audio route');
  }
});

const interruptionListener = await AudioSession.addListener('interruption', (type) => {
  if (type === InterruptionTypes.BEGAN) {
    // Pause playback while we are interrupted
  } else {
    // Resume playback
  }
});

// Later during cleanup
await routeListener.remove();
await interruptionListener.remove();
```

## 権限

- **iOS**: アプリがバックグラウンドでオーディオを再生する場合は、`ios/App/App/Info.plist` 内に必要なバックグラウンド オーディオ モード (`audio`、`voice` など) を追加してください。
- **その他のプラットフォーム**: 追加のセットアップは不要です。メソッドは空の結果で解決します。
