---
title: Facebook 로그인 설정
description: >-
  이 가이드는 Capacitor를 사용하여 Facebook 로그인을 설정하는 포괄적인 안내를 제공하며, 애플리케이션에 대한 원활한 통합 및 향상된 사용자 인증을 보장합니다.
sidebar:
  order: 1
locale: ko
---
import { Steps } from '@astrojs/starlight/components';


## 소개

이 가이드에서는 Capgo Social Login으로 Facebook 로그인을 설정하는 방법을 배우게 됩니다. 다음이 필요합니다:

- Facebook 개발자 계정
- 앱의 패키지 이름/번들 ID
- 키 해시 생성을 위한 터미널 액세스 (Android)

## 일반 설정

Facebook 앱이 아직 없다면 다음 단계를 따르세요:

<Steps>
1. Facebook 앱 생성

   [앱 만들기](https://developers.facebook.com/docs/development/create-an-app/) 튜토리얼을 따르세요

2. 앱에 Facebook 로그인 추가

   Facebook 개발자 대시보드에서 앱에 Facebook 로그인 제품을 추가하세요

3. 앱을 대중에게 공개하기 전에 이 [튜토리얼](https://developers.facebook.com/docs/development/release/)을 따라 게시하세요
</Steps>

## 중요 정보

통합에 필요한 주요 정보를 찾을 수 있는 위치는 다음과 같습니다:

1. `CLIENT_TOKEN`:
   <img src="/social-login-assets/fb_where_to_fiind_client_token.png" alt="클라이언트 토큰을 찾을 수 있는 위치를 보여주는 Facebook 개발자 대시보드" />

2. `APP_ID`:
   <img src="/social-login-assets/fb_where_to_find_app_id.png" alt="앱 ID를 찾을 수 있는 위치를 보여주는 Facebook 개발자 대시보드" />

3. `APP_NAME`:
   <img src="/social-login-assets/fb_where_to_find_app_name.png" alt="앱 이름을 찾을 수 있는 위치를 보여주는 Facebook 개발자 대시보드" />

## Android 설정

<Steps>
1. `AndroidManifest.xml`에 인터넷 권한 추가

   이 줄이 있는지 확인하세요:
   ```xml
   <uses-permission android:name="android.permission.INTERNET"/>
   ```

2. Android 키 해시 생성

   Facebook에서 요구하는 중요한 보안 단계입니다. 터미널을 열고 다음을 실행하세요:

   ```bash
   keytool -exportcert -alias androiddebugkey -keystore ~/.android/debug.keystore | openssl sha1 -binary | openssl base64 -A
   ```

   비밀번호를 묻는 메시지가 표시되면 `android`를 사용하세요

   :::note
   릴리스 빌드의 경우 릴리스 키스토어를 사용해야 합니다:
   ```bash
   keytool -exportcert -alias your-key-name -keystore your-keystore-path | openssl sha1 -binary | openssl base64 -A
   ```
   :::

3. Facebook 앱에 키 해시 추가

   1. Facebook Developers의 앱 대시보드로 이동
   2. 설정 > 기본으로 이동
   3. "Android" 섹션으로 스크롤
   4. Android가 아직 추가되지 않은 경우 "플랫폼 추가"를 클릭하고 세부 정보를 입력
   5. 생성한 키 해시 추가
   6. 프로덕션의 경우 디버그 및 릴리스 키 해시를 모두 추가

4. `AndroidManifest.xml`을 업데이트하여 다음을 포함:

   ```xml
   <application>
       ...
       <activity android:name="com.facebook.FacebookActivity"
           android:configChanges="keyboard|keyboardHidden|screenLayout|screenSize|orientation"
           android:label="@string/app_name" />

       <activity
           android:name="com.facebook.CustomTabActivity"
           android:exported="true">
           <intent-filter>
               <action android:name="android.intent.action.VIEW" />
               <category android:name="android.intent.category.DEFAULT" />
               <category android:name="android.intent.category.BROWSABLE" />
               <data android:scheme="FB[APP_ID]" />
           </intent-filter>
       </activity>
   </application>
   ```

   :::caution
   `android:scheme` 속성에서 `[APP_ID]`를 실제 Facebook 앱 ID로 교체해야 합니다
   :::
</Steps>

## iOS 설정

<Steps>
1. Facebook 개발자 콘솔에 iOS 플랫폼 추가

   1. Facebook Developers의 앱 대시보드로 이동
   2. 설정 > 기본으로 이동
   3. 페이지 맨 아래로 스크롤하여 "플랫폼 추가"를 클릭
   4. iOS를 선택하고 필요한 세부 정보를 입력

2. Xcode 프로젝트를 열고 Info.plist로 이동

3. Info.plist에 다음 항목 추가:

   ```xml
   <key>FacebookAppID</key>
   <string>[APP-ID]</string>
   <key>FacebookClientToken</key>
   <string>[CLIENT-TOKEN]</string>
   <key>FacebookDisplayName</key>
   <string>[APP-NAME]</string>
   <key>LSApplicationQueriesSchemes</key>
   <array>
       <string>fbapi</string>
       <string>fb-messenger-share-api</string>
   </array>
   <key>CFBundleURLTypes</key>
   <array>
       <dict>
           <key>CFBundleURLSchemes</key>
           <array>
               <string>fb[APP-ID]</string>
           </array>
       </dict>
   </array>
   ```

   :::caution
   다음 값을 교체하세요:
   - `[APP-ID]` - Facebook 앱 ID로
   - `[CLIENT-TOKEN]` - 클라이언트 토큰으로
   - `[APP-NAME]` - 앱 이름으로
   :::

4. `AppDelegate.swift` 수정

   ```swift
   import FBSDKCoreKit
   @UIApplicationMain
   class AppDelegate: UIResponder, UIApplicationDelegate {
         func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {
           // Override point for customization after application launch.

           // Initialize Facebook SDK
           FBSDKCoreKit.ApplicationDelegate.shared.application(
               application,
               didFinishLaunchingWithOptions: launchOptions
           )

           return true
       }

       func application(_ app: UIApplication, open url: URL, options: [UIApplication.OpenURLOptionsKey: Any] = [:]) -> Bool {
           // Called when the app was launched with a url. Feel free to add additional processing here,
           // but if you want the App API to support tracking app url opens, make sure to keep this call

           if (FBSDKCoreKit.ApplicationDelegate.shared.application(
               app,
               open: url,
               sourceApplication: options[UIApplication.OpenURLOptionsKey.sourceApplication] as? String,
               annotation: options[UIApplication.OpenURLOptionsKey.annotation]
           )) {
               return true;
           } else {
               return ApplicationDelegateProxy.shared.application(app, open: url, options: options)
           }
       }
   }
   ```
</Steps>

## 앱에서 Facebook 로그인 사용

:::caution
**시작하기 전에**: 새로운 Facebook SDK에서는 받는 토큰 유형이 코드 구성이 아니라 사용자의 앱 추적 선택에 전적으로 달려 있다는 것을 기억하세요. 모든 사용자에 대한 인증이 작동하도록 백엔드에서 액세스 토큰과 JWT 토큰 처리를 모두 구현하세요.
:::

<Steps>
1. 앱에서 Facebook 로그인 초기화

   ```typescript
   import { SocialLogin } from '@capgo/capacitor-social-login';

   // 앱 시작 시 초기화
   await SocialLogin.initialize({
     facebook: {
       appId: 'APP_ID',
       clientToken: 'CLIENT_TOKEN',
     }
   })
   ```

2. 로그인 함수 구현

   ```typescript
   async function loginWithFacebook() {
     try {
       const result = await SocialLogin.login({
         provider: 'facebook',
        options: {
          permissions: ['email', 'public_profile'],
          limitedLogin: false // 중요한 세부 사항은 아래 제한된 로그인 섹션 참조
        }
       });
       console.log('Facebook 로그인 결과:', result);
       // 성공적인 로그인 처리
     } catch (error) {
       console.error('Facebook 로그인 오류:', error);
       // 오류 처리
     }
   }
   ```

   :::note
   **제한된 로그인 (iOS 전용)**: Facebook의 제한된 로그인 기능을 사용하려면 `limitedLogin`을 true로 설정하세요. 이것은 로그인 중 공유되는 데이터를 제한하여 향상된 개인 정보 보호를 제공하는 iOS 전용 기능입니다.

   **중요한 제한 사항:**
   - **iOS 전용**: 제한된 로그인은 iOS 기기에만 영향을 미치며 Android에는 영향을 주지 않습니다
   - **ATT 재정의**: `limitedLogin: false`로 설정해도 사용자가 앱 추적 투명성(ATT) 권한을 부여하지 않았다면 Facebook이 자동으로 true로 강제합니다
   - **항상 두 경우 모두 처리**: 앱은 항상 제한된 로그인과 전체 로그인 시나리오를 모두 처리할 준비가 되어 있어야 합니다

   **ATT 상태 확인:**
   ```typescript
   // 사용자가 추적 권한을 부여했는지 확인
   const trackingStatus = await SocialLogin.providerSpecificCall({
     call: 'facebook#requestTracking',
     options: {}
   });
   console.log('추적 상태:', trackingStatus.status); // 'authorized', 'denied', 'notDetermined', 또는 'restricted'
   ```

   **access_token이 선호되는 경우 권장 구현:**
   ```typescript
   async function loginWithFacebook() {
     try {
       // 먼저 ATT 상태 확인
       const trackingStatus = await SocialLogin.providerSpecificCall({
         call: 'facebook#requestTracking',
         options: {}
       });

       const result = await SocialLogin.login({
         provider: 'facebook',
         options: {
           permissions: ['email', 'public_profile'],
           limitedLogin: trackingStatus.status === 'denied' // ATT에 따라 자동 조정
         }
       });

       // 제한된 로그인에 따라 다른 응답 유형 처리
       if (result.result.accessToken) {
         // 앱 로직은 제한된 로그인과 전체 로그인 모두에서 작동해야 합니다
         console.log('로그인 성공:', result);
       }
     } catch (error) {
       console.error('Facebook 로그인 오류:', error);
     }
   }
   ```

   **제한된 로그인에서 발생하는 일:**
   - **데이터 액세스 감소**: 일부 사용자 데이터를 사용할 수 없을 수 있습니다
   - **다른 토큰 유형**: 액세스 토큰은 다른 기능을 가질 수 있습니다
   - **개인 정보 보호 준수**: iOS 개인 정보 보호 요구 사항을 준수하는 데 도움이 됩니다

   **중요**: 앱이 두 경우 모두에서 올바르게 작동하도록 제한된 로그인과 전체 로그인 시나리오를 모두 테스트하세요. 제한된 로그인에 대해 [여기](https://developers.facebook.com/docs/facebook-login/limited-login/)에서 자세히 알아볼 수 있습니다.
   :::

3. **사용자 프로필 데이터 가져오기**

   성공적인 로그인 후 추가 프로필 정보를 검색할 수 있습니다:

   ```typescript
   async function getFacebookProfile() {
     try {
       const profileResponse = await SocialLogin.providerSpecificCall({
         call: 'facebook#getProfile',
         options: {
           fields: ['id', 'name', 'email', 'first_name', 'last_name', 'picture']
         }
       });

       console.log('Facebook 프로필:', profileResponse.profile);
       return profileResponse.profile;
     } catch (error) {
       console.error('Facebook 프로필 가져오기 실패:', error);
       return null;
     }
   }

   // 로그인 후 사용 예제
   async function loginAndGetProfile() {
     const loginResult = await loginWithFacebook();
     if (loginResult) {
       const profile = await getFacebookProfile();
       if (profile) {
         console.log('사용자 ID:', profile.id);
         console.log('이름:', profile.name);
         console.log('이메일:', profile.email);
         console.log('프로필 사진:', profile.picture?.data?.url);
       }
     }
   }
   ```

   :::tip
   **사용 가능한 프로필 필드**: Facebook의 Graph API에서 사용 가능한 모든 필드를 요청할 수 있습니다. 일반적인 필드에는 `id`, `name`, `email`, `first_name`, `last_name`, `picture`, `birthday`, `gender`, `location`, `hometown`이 포함됩니다. 일부 필드는 추가 권한이 필요할 수 있습니다.
   :::

   :::warning
   **토큰 유형 제한**: `getProfile` 호출은 **액세스 토큰**(추적이 허용된 표준 로그인)이 있을 때만 작동합니다. 사용자가 추적을 거부했거나 제한된 로그인을 사용 중인 경우(JWT 토큰만), 이 호출은 실패합니다. 이 경우 초기 로그인 응답에 제공된 프로필 데이터를 사용하세요.
   :::
</Steps>

## ⚠️ 중요: 백엔드 토큰 처리

:::danger
**중요한 iOS 동작**: 제한된 로그인 및 앱 추적 투명성(ATT)은 **iOS 전용** 기능입니다. Android에서는 `limitedLogin` 설정에 관계없이 항상 액세스 토큰을 받습니다.

**iOS 토큰 동작**:
- **`limitedLogin: true`** → 항상 JWT 토큰 (iOS만)
- **`limitedLogin: false` + 사용자가 추적 허용** → 액세스 토큰
- **`limitedLogin: false` + 사용자가 추적 거부** → JWT 토큰 (iOS가 자동으로 설정 재정의)

**Android 토큰 동작**: 항상 액세스 토큰, `limitedLogin` 설정 무시됨.
:::

백엔드는 **두 가지 다른 토큰 유형**을 처리해야 합니다. iOS 사용자는 앱 추적 투명성 선택에 따라 액세스 토큰 또는 JWT 토큰을 받을 수 있지만 Android 사용자는 항상 액세스 토큰을 받습니다.

### 플랫폼별 토큰 유형

| 플랫폼 | limitedLogin 설정 | 사용자 ATT 선택 | 결과 토큰 유형 |
|----------|---------------------|-----------------|-------------------|
| **iOS** | `true` | 모두 | JWT 토큰 |
| **iOS** | `false` | 추적 허용 | 액세스 토큰 |
| **iOS** | `false` | 추적 거부 | JWT 토큰 (자동 재정의) |
| **Android** | 모두 | 해당 없음 | 액세스 토큰 (항상) |

### 백엔드 구현

<Steps>
1. **토큰 유형 감지 및 적절히 처리**

   ```typescript
   async function loginWithFacebook() {
     try {
       const loginResult = await SocialLogin.login({
         provider: 'facebook',
         options: {
           permissions: ['email', 'public_profile'],
           limitedLogin: false // iOS: ATT에 따라 다름, Android: 무시됨
         }
       });

       if (loginResult.accessToken) {
         // 액세스 토큰 (Android 항상, iOS 추적 허용 시)
         return handleAccessToken(loginResult.accessToken.token);
       } else if (loginResult.idToken) {
         // JWT 토큰 (추적 거부 시 또는 limitedLogin: true일 때 iOS만)
         return handleJWTToken(loginResult.idToken);
       }
     } catch (error) {
       console.error('Facebook 로그인 오류:', error);
     }
   }
   ```

2. **Firebase 통합 예제**

   ```typescript
   import { OAuthProvider, FacebookAuthProvider, signInWithCredential } from 'firebase/auth';

   async function handleAccessToken(accessToken: string, nonce: string) {
     // 액세스 토큰의 경우 OAuthProvider 사용 (새 방법)
     const fbOAuth = new OAuthProvider("facebook.com");
     const credential = fbOAuth.credential({
       idToken: accessToken,
       rawNonce: nonce
     });

     try {
       const userResponse = await signInWithCredential(auth, credential);
       return userResponse;
     } catch (error) {
       console.error('Firebase OAuth 오류:', error);
       return false;
     }
   }

   async function handleJWTToken(jwtToken: string) {
     // JWT 토큰의 경우 검증을 위해 백엔드로 전송
     try {
       const response = await fetch('/api/auth/facebook-jwt', {
         method: 'POST',
         headers: {
           'Content-Type': 'application/json',
         },
         body: JSON.stringify({ jwtToken })
       });

       const result = await response.json();
       return result;
     } catch (error) {
       console.error('JWT 검증 오류:', error);
       return false;
     }
   }
   ```

3. **백엔드 JWT 검증**

   ```typescript
   // 백엔드: Facebook의 JWT 토큰 검증
   import jwt from 'jsonwebtoken';
   import { Request, Response } from 'express';

   app.post('/api/auth/facebook-jwt', async (req: Request, res: Response) => {
     const { jwtToken } = req.body;

     try {
       // Facebook의 공개 키로 JWT 토큰 검증
       // 참조: https://developers.facebook.com/docs/facebook-login/limited-login/token/validating/#standard-claims
       const decoded = jwt.verify(jwtToken, getFacebookPublicKey(), {
         algorithms: ['RS256'],
         audience: process.env.FACEBOOK_APP_ID,
         issuer: 'https://www.facebook.com' // From: https://www.facebook.com/.well-known/openid-configuration/?_rdr
       });

       // JWT에서 사용자 정보 추출
       const userInfo = {
         id: decoded.sub,
         email: decoded.email,
         name: decoded.name,
         isJWTAuth: true
       };

       // 앱의 세션/토큰 생성
       const sessionToken = createUserSession(userInfo);

       res.json({
         success: true,
         token: sessionToken,
         user: userInfo
       });
     } catch (error) {
       console.error('JWT 검증 실패:', error);
       res.status(401).json({ success: false, error: '잘못된 토큰' });
     }
   });
   ```
</Steps>

:::tip
**iOS 필수**: 두 가지 토큰 처리 방법을 모두 구현해야 합니다. 많은 iOS 개발자가 항상 액세스 토큰을 받을 것이라고 가정하지만 사용자가 추적을 거부하면 앱이 중단됩니다.
:::

## 보안 컨텍스트 요구 사항 (Web/Capacitor)

### Crypto API 제한 사항

업데이트된 Facebook 로그인 플로우는 nonce 생성을 위해 **Web Crypto API**가 필요하며, 이는 **보안 컨텍스트**에서만 사용할 수 있습니다:

```typescript
// 보안 컨텍스트 필요 (HTTPS 또는 localhost)
async function sha256(message: string) {
  const msgBuffer = new TextEncoder().encode(message);
  const hashBuffer = await crypto.subtle.digest("SHA-256", msgBuffer); // ❌ 비보안 컨텍스트에서 실패
  // ...
}
```

### 개발 환경 문제

**일반적인 문제**: HTTP URL을 사용하는 `ionic serve`는 Facebook 인증을 중단시킵니다

| 환경 | Crypto API 사용 가능 | Facebook 로그인 작동 |
|-------------|---------------------|---------------------|
| `http://localhost:3000` | ✅ 예 | ✅ 예 |
| `http://127.0.0.1:3000` | ✅ 예 | ✅ 예 |
| `http://192.168.1.100:3000` | ❌ 아니요 | ❌ 아니요 |
| `https://any-domain.com` | ✅ 예 | ✅ 예 |

### Capacitor 개발을 위한 솔루션

<Steps>
1. **웹 테스트에 localhost 사용**
   ```bash
   # ionic serve --host=0.0.0.0 대신
   ionic serve --host=localhost
   ```

2. **Ionic에서 HTTPS 활성화**
   ```bash
   ionic serve --ssl
   ```

3. **실제 기기에서 테스트**
   ```bash
   # Capacitor 앱은 기기에서 보안 컨텍스트로 실행됩니다
   ionic cap run ios
   ionic cap run android
   ```
</Steps>

:::warning
**개발 제한**: 네트워크 IP(localhost가 아님)에서 `ionic serve`를 사용하는 경우 crypto API 제한으로 인해 Facebook 로그인이 실패합니다. 웹 테스트에는 localhost 또는 HTTPS를 사용하세요.
:::

:::tip
**프로덕션 안전성**: iOS/Android의 Capacitor 앱은 항상 보안 컨텍스트에서 실행되므로 이 제한은 웹 개발 환경에만 영향을 미칩니다.
:::

## 문제 해결

### 일반적인 문제 및 해결 방법

1. **Android의 키 해시 오류**
   - Facebook 대시보드에 올바른 키 해시를 추가했는지 다시 확인
   - 릴리스 빌드의 경우 디버그 및 릴리스 키 해시를 모두 추가했는지 확인
   - 해시 생성 시 올바른 키스토어를 사용하고 있는지 확인

2. **Facebook 로그인 버튼이 나타나지 않음**
   - 모든 매니페스트 항목이 올바른지 확인
   - Facebook 앱 ID 및 클라이언트 토큰이 올바른지 확인
   - SDK를 제대로 초기화했는지 확인

3. **일반적인 iOS 문제**
   - 모든 Info.plist 항목이 올바른지 확인
   - URL 스킴이 제대로 구성되었는지 확인
   - 번들 ID가 Facebook 대시보드에 등록된 것과 일치하는지 확인

### 테스트

1. **테스트하기 전에 Facebook 개발자 콘솔에서 테스트 사용자 추가**
   - 역할 > 테스트 사용자로 이동
   - 테스트 사용자 생성
   - 테스트에 이러한 자격 증명 사용

2. **디버그 및 릴리스 빌드 모두 테스트**
   - 디버그 키 해시를 사용한 디버그 빌드
   - 릴리스 키 해시를 사용한 릴리스 빌드
   - 에뮬레이터 및 실제 기기 모두에서 테스트

다음을 포함한 전체 로그인 플로우를 테스트하는 것을 잊지 마세요:
- 성공적인 로그인
- 로그인 취소
- 오류 처리
- 로그아웃 기능
