---
title: "GitHub Actions é›†æˆ"
locale: zh
description: "äº†è§£å¦‚ä½•å°† Capgo Live Updates ä¸ GitHub Actions é›†æˆ,å®ç°åº”ç”¨æ›´æ–°çš„è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚"
sidebar:
  order: 3
---

import { Aside, Steps } from '@astrojs/starlight/components';

å°† Capgo Live Updates ä¸ GitHub Actions é›†æˆ,åœ¨æ‚¨æ¨é€ä»£ç æ›´æ”¹æ—¶è‡ªåŠ¨éƒ¨ç½²åº”ç”¨æ›´æ–°ã€‚æœ¬æŒ‡å—æ¶µç›–äº†ä½¿ç”¨ GitHub å¼ºå¤§çš„ CI/CD å¹³å°è®¾ç½®è‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²å·¥ä½œæµã€‚

## å‰ç½®è¦æ±‚

åœ¨è®¾ç½® GitHub Actions é›†æˆä¹‹å‰,è¯·ç¡®ä¿æ‚¨å…·å¤‡:

- åŒ…å«åº”ç”¨æºä»£ç çš„ GitHub å­˜å‚¨åº“
- å·²é…ç½®åº”ç”¨çš„ Capgo è´¦æˆ·
- é¡¹ç›®ä¸­å·²é…ç½® Node.js å’Œ npm/yarn
- ä¸ºæ‚¨çš„å­˜å‚¨åº“å¯ç”¨ GitHub Actions

## è®¾ç½® GitHub Secrets

### æ­¥éª¤ 1:é…ç½®å­˜å‚¨åº“ Secrets

åœ¨æ‚¨çš„ GitHub å­˜å‚¨åº“ä¸­è®¾ç½®å¿…è¦çš„ secrets:

<Steps>

1. å¯¼èˆªåˆ°æ‚¨çš„ GitHub å­˜å‚¨åº“
2. è¿›å…¥ **Settings** â†’ **Secrets and variables** â†’ **Actions**
3. ç‚¹å‡» **New repository secret** å¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹:

</Steps>

| Secret åç§° | å€¼ |
|-------------|-------|
| `CAPGO_TOKEN` | æ‚¨çš„ Capgo API token |

<Aside type="tip">

ä» [console.capgo.app/apikeys](https://console.capgo.app/apikeys) è·å–æ‚¨çš„ Capgo API tokenã€‚æ‚¨çš„åº”ç”¨ ID å·²åœ¨ `capacitor.config.ts` æ–‡ä»¶ä¸­é…ç½®ã€‚

</Aside>

## ç®€å•ç”Ÿäº§éƒ¨ç½²

ä»è¿™ä¸ªåŸºæœ¬é…ç½®å¼€å§‹,åœ¨æ¯æ¬¡æ¨é€åˆ°ä¸»åˆ†æ”¯æ—¶éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ:

```yaml
# ç”¨äº Capgo Live Updates çš„ç®€å• GitHub Actions å·¥ä½œæµ
name: Deploy to Capgo

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: '24'
          cache: 'npm'

      - name: Install, test and build
        run: |
          npm ci
          npm run test
          npm run build

      - name: Deploy to Capgo
         run: |
           npm install -g @capgo/cli
           npx @capgo/cli bundle upload --channel production
          env:
            CAPGO_TOKEN: ${{ secrets.CAPGO_TOKEN }}
           # å¯¹äºåŠ å¯†ä¸Šä¼ ,æ·»åŠ : --key-data-v2 "${{ secrets.CAPGO_PRIVATE_KEY }}"
```

## é«˜çº§å¤šæ¸ é“é…ç½®

### åŠŸèƒ½åˆ†æ”¯éƒ¨ç½²

å°†åŠŸèƒ½åˆ†æ”¯éƒ¨ç½²åˆ°ä¸´æ—¶æ¸ é“ä»¥è¿›è¡Œæµ‹è¯•:

```yaml
# åŠŸèƒ½åˆ†æ”¯éƒ¨ç½²
name: Deploy Feature Branch to Capgo

on:
  push:
    branches:
      - 'feature/**'

jobs:
  deploy-feature:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6
      - uses: actions/setup-node@v6
        with:
          node-version: '24'
          cache: 'npm'

      - run: |
          npm ci
          npm run test
          npm run build

      - name: Deploy to feature channel
        run: |
          CHANNEL_NAME=$(echo "${{ github.ref_name }}" | sed 's/[^a-zA-Z0-9]/-/g' | tr '[:upper:]' '[:lower:]')
          npm install -g @capgo/cli
          npx @capgo/cli channel create $CHANNEL_NAME --apikey ${{ secrets.CAPGO_TOKEN }} || true
                     npx @capgo/cli bundle upload --apikey ${{ secrets.CAPGO_TOKEN }} --channel $CHANNEL_NAME
```

### ä½¿ç”¨åŠ å¯†

å¦‚æœæ‚¨ä½¿ç”¨ [Capgo çš„åŠ å¯†åŠŸèƒ½](/docs/live-updates/encryption/),åˆ™éœ€è¦åœ¨ CI/CD ç¯å¢ƒä¸­å®‰å…¨åœ°å­˜å‚¨æ‚¨çš„ç§é’¥ã€‚

åœ¨æœ¬åœ°[è®¾ç½®åŠ å¯†å¯†é’¥](/docs/live-updates/encryption/#setting-up-encryption)å,å°†æ‚¨çš„ç§é’¥æ·»åŠ åˆ° GitHub secrets:

```shell
# æ˜¾ç¤ºæ‚¨çš„ç§é’¥å†…å®¹(å¤åˆ¶æ­¤è¾“å‡º)
cat .capgo_key_v2
```

å°†æ­¤å†…å®¹ä½œä¸º `CAPGO_PRIVATE_KEY` æ·»åŠ åˆ°æ‚¨çš„ GitHub å­˜å‚¨åº“ secrets,ç„¶ååœ¨å·¥ä½œæµä¸­ä½¿ç”¨å®ƒ:

```yaml
# ä½¿ç”¨åŠ å¯†éƒ¨ç½²
- name: Deploy to Capgo with Encryption
  run: |
    npm install -g @capgo/cli
    npx @capgo/cli bundle upload --apikey ${{ secrets.CAPGO_TOKEN }} --key-data-v2 "${{ secrets.CAPGO_PRIVATE_KEY }}" --channel production
```

<Aside type="caution">

**å®‰å…¨æœ€ä½³å®è·µ:**
- åˆ‡å‹¿å°† `.capgo_key_v2` æ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- ä»…åœ¨å®‰å…¨çš„ CI/CD å¯†é’¥ç®¡ç†ä¸­å­˜å‚¨ç§é’¥
- ä¸ºä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„å¯†é’¥

</Aside>

### å¤šæ¸ é“é…ç½®

æœ‰å…³è®¾ç½®å’Œç®¡ç†å¤šä¸ªéƒ¨ç½²æ¸ é“çš„ç»¼åˆä¿¡æ¯,è¯·å‚é˜…[æ¸ é“æ–‡æ¡£](/docs/live-updates/channels/)ã€‚

åŒ…å«å¼€å‘ã€æ‹‰å–è¯·æ±‚å’Œç”Ÿäº§éƒ¨ç½²çš„å®Œæ•´å·¥ä½œæµ:

```yaml
# å®Œæ•´çš„å¤šç¯å¢ƒå·¥ä½œæµ
name: Deploy to Capgo

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6
      - uses: actions/setup-node@v6
        with:
          node-version: '24'
          cache: 'npm'

      - run: |
          npm ci
          npm run test
          npm run build

      - uses: actions/upload-artifact@v4
        with:
          name: dist
          path: dist/

  deploy-development:
    if: github.ref == 'refs/heads/develop'
    needs: build
    runs-on: ubuntu-latest
    environment: development
    steps:
      - uses: actions/setup-node@v6
        with:
          node-version: '24'

      - uses: actions/download-artifact@v4
        with:
          name: dist
          path: dist/

      - run: |
          npm install -g @capgo/cli
          npx @capgo/cli bundle upload --apikey ${{ secrets.CAPGO_TOKEN }} --channel development

  deploy-pr:
    if: github.event_name == 'pull_request'
    needs: build
    runs-on: ubuntu-latest
    steps:
      - uses: actions/setup-node@v6
        with:
          node-version: '24'

      - uses: actions/download-artifact@v4
        with:
          name: dist
          path: dist/

      - name: Deploy to PR channel
        run: |
          CHANNEL_NAME="pr-${{ github.event.number }}"
          npm install -g @capgo/cli
          npx @capgo/cli channel create $CHANNEL_NAME --apikey ${{ secrets.CAPGO_TOKEN }} || true
          npx @capgo/cli bundle upload --apikey ${{ secrets.CAPGO_TOKEN }} --channel $CHANNEL_NAME

      - name: Comment PR
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `ğŸš€ æ­¤ PR å·²éƒ¨ç½²åˆ° Capgo æ¸ é“: \`pr-${{ github.event.number }}\`\n\nè¦åœ¨æ‚¨çš„åº”ç”¨ä¸­æµ‹è¯•æ­¤æ›´æ–°,è¯·å°†å…¶é…ç½®ä¸ºä½¿ç”¨æ­¤æ¸ é“ã€‚[äº†è§£å¦‚ä½•é…ç½®æ¸ é“ â†’](/docs/live-updates/channels/#configuring-the-channel-in-your-app)`
            })

  deploy-production:
    if: github.ref == 'refs/heads/main'
    needs: build
    runs-on: ubuntu-latest
    environment: production
    steps:
      - uses: actions/setup-node@v6
        with:
          node-version: '24'

      - uses: actions/download-artifact@v4
        with:
          name: dist
          path: dist/

      - run: |
          npm install -g @capgo/cli
          npx @capgo/cli bundle upload --apikey ${{ secrets.CAPGO_TOKEN }} --channel production
```

<Aside type="tip">

**ä½¿ç”¨æ¸ é“è¿›è¡Œæµ‹è¯•**:éƒ¨ç½²åˆ° PR æˆ–å¼€å‘æ¸ é“å,æ‚¨å¯ä»¥é€šè¿‡é…ç½®åº”ç”¨ä½¿ç”¨è¯¥ç‰¹å®šæ¸ é“æ¥æµ‹è¯•æ›´æ–°ã€‚äº†è§£æ›´å¤šå…³äº[åœ¨åº”ç”¨ä¸­é…ç½®æ¸ é“](/docs/live-updates/channels/#configuring-the-channel-in-your-app)çš„ä¿¡æ¯ã€‚

</Aside>

### æ¸…ç†åŠŸèƒ½æ¸ é“

åœ¨åˆ é™¤åˆ†æ”¯æ—¶è‡ªåŠ¨æ¸…ç†åŠŸèƒ½æ¸ é“:

```yaml
name: Cleanup Feature Channels

on:
  delete:

jobs:
  cleanup:
    runs-on: ubuntu-latest
    if: github.event.ref_type == 'branch' && startsWith(github.event.ref, 'feature/')
    steps:
      - uses: actions/setup-node@v6
        with:
          node-version: '24'

      - name: Delete Capgo channel
        run: |
          CHANNEL_NAME=$(echo "${{ github.event.ref }}" | sed 's/[^a-zA-Z0-9]/-/g' | tr '[:upper:]' '[:lower:]')
          npm install -g @capgo/cli
          npx @capgo/cli channel delete $CHANNEL_NAME --apikey ${{ secrets.CAPGO_TOKEN }} || true
```

## å®‰å…¨å’Œæœ€ä½³å®è·µ

### ç¯å¢ƒä¿æŠ¤è§„åˆ™

åœ¨ GitHub ä¸­è®¾ç½®ç¯å¢ƒä¿æŠ¤è§„åˆ™:

<Steps>

1. åœ¨æ‚¨çš„å­˜å‚¨åº“ä¸­è¿›å…¥ **Settings** â†’ **Environments**
2. åˆ›å»ºç¯å¢ƒ:`development`ã€`staging`ã€`production`
3. å¯¹äºç”Ÿäº§ç¯å¢ƒ,æ·»åŠ :
   - **Required reviewers**:æ·»åŠ å¿…é¡»æ‰¹å‡†éƒ¨ç½²çš„å›¢é˜Ÿæˆå‘˜
   - **Wait timer**:æ·»åŠ éƒ¨ç½²å‰çš„å»¶è¿Ÿ(å¯é€‰)
   - **Deployment branches**:ä»…é™åˆ¶ä¸º `main` åˆ†æ”¯

</Steps>

### å®‰å…¨ Secrets ç®¡ç†

ä½¿ç”¨ç‰¹å®šäºç¯å¢ƒçš„ secrets:

```yaml
# æ¯ä¸ªç¯å¢ƒä½¿ç”¨ä¸åŒçš„ secrets
deploy-production:
  environment: production
  steps:
    - name: Deploy to Production
      run: |
        npx @capgo/cli bundle upload \
          --apikey ${{ secrets.CAPGO_PROD_TOKEN }} \
          --app ${{ secrets.CAPGO_PROD_APP_ID }} \
          --channel production
```

## ç›‘æ§å’Œé€šçŸ¥

### Slack é›†æˆ

å‘å·¥ä½œæµæ·»åŠ  Slack é€šçŸ¥:

```yaml
name: Deploy with Notifications

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      # ... éƒ¨ç½²æ­¥éª¤

      - name: Notify Slack on Success
        if: success()
        uses: 8398a7/action-slack@v3
        with:
          status: success
          text: 'âœ… Capgo éƒ¨ç½²æˆåŠŸ!'
          fields: repo,message,commit,author,action,eventName,ref,workflow
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}

      - name: Notify Slack on Failure
        if: failure()
        uses: 8398a7/action-slack@v3
        with:
          status: failure
          text: 'âŒ Capgo éƒ¨ç½²å¤±è´¥!'
          fields: repo,message,commit,author,action,eventName,ref,workflow
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
```

### Discord é›†æˆ

å‘ Discord å‘é€é€šçŸ¥:

```yaml
- name: Discord notification
  if: always()
  uses: Ilshidur/action-discord@master
  with:
    args: |
      Capgo éƒ¨ç½² ${{ job.status }}!
      åº”ç”¨: ${{ secrets.CAPGO_APP_ID }}
      æ¸ é“: ${{ github.ref_name }}
      æäº¤: ${{ github.sha }}
  env:
    DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
```

### é‚®ä»¶é€šçŸ¥

é…ç½®é‚®ä»¶é€šçŸ¥:

```yaml
- name: Send email notification
  if: failure()
  uses: dawidd6/action-send-mail@v3
  with:
    server_address: smtp.gmail.com
    server_port: 465
    username: ${{ secrets.EMAIL_USERNAME }}
    password: ${{ secrets.EMAIL_PASSWORD }}
    subject: 'Capgo éƒ¨ç½²å¤±è´¥ - ${{ github.repository }}'
    to: team@yourcompany.com
    from: ci-cd@yourcompany.com
    body: |
      ${{ github.repository }} çš„éƒ¨ç½²å¤±è´¥
      åˆ†æ”¯: ${{ github.ref_name }}
      æäº¤: ${{ github.sha }}
      å·¥ä½œæµ: ${{ github.workflow }}
```

## æ•…éšœæ’é™¤

### è°ƒè¯•å·¥ä½œæµ

æ·»åŠ è°ƒè¯•æ­¥éª¤ä»¥è§£å†³é—®é¢˜:

```yaml
- name: Debug environment
  run: |
    echo "Node version: $(node --version)"
    echo "NPM version: $(npm --version)"
    echo "Working directory: $(pwd)"
    echo "Files in dist/: $(ls -la dist/ || echo 'No dist directory')"
    echo "Environment variables:"
    env | grep -E "(GITHUB_|CAPGO_)" | sort

- name: Test Capgo CLI
  run: |
    npx @capgo/cli --version
    npx @capgo/cli app debug --apikey ${{ secrets.CAPGO_TOKEN }} --app ${{ secrets.CAPGO_APP_ID }}
```

### å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

**å·¥ä½œæµå¤±è´¥å¹¶æ˜¾ç¤º "CAPGO_TOKEN not found":**

```yaml
- name: Verify secrets
  run: |
    if [ -z "${{ secrets.CAPGO_TOKEN }}" ]; then
      echo "ERROR: CAPGO_TOKEN secret is not set"
      exit 1
    fi
    echo "CAPGO_TOKEN is set (length: ${#CAPGO_TOKEN})"
  env:
    CAPGO_TOKEN: ${{ secrets.CAPGO_TOKEN }}
```

**æ‰¾ä¸åˆ°æ„å»ºäº§ç‰©:**

```yaml
- name: Debug artifacts
  run: |
    echo "Checking for build artifacts..."
    ls -la dist/ || echo "No dist directory found"
    find . -name "*.js" -o -name "*.html" | head -10
```

**ç½‘ç»œè¿æ¥é—®é¢˜:**

```yaml
- name: Test connectivity
  run: |
    ping -c 3 api.capgo.io || echo "Ping failed"
    curl -I https://api.capgo.io/health || echo "Health check failed"
```

## å¯é‡ç”¨å·¥ä½œæµ

åˆ›å»ºå¯é‡ç”¨å·¥ä½œæµä»¥åœ¨é¡¹ç›®é—´ä¿æŒä¸€è‡´æ€§:

```yaml
# .github/workflows/reusable-capgo-deploy.yml
name: Reusable Capgo Deploy

on:
  workflow_call:
    inputs:
      environment:
        required: true
        type: string
      channel:
        required: true
        type: string
    secrets:
      CAPGO_TOKEN:
        required: true
      CAPGO_APP_ID:
        required: true

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: ${{ inputs.environment }}
    steps:
      - uses: actions/checkout@v6

      - name: Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: '24'
          cache: 'npm'

      - name: Install and build
        run: |
          npm ci
          npm run build

      - name: Deploy to Capgo
        run: |
          npm install -g @capgo/cli
          npx @capgo/cli bundle upload \
            --apikey ${{ secrets.CAPGO_TOKEN }} \
            --app ${{ secrets.CAPGO_APP_ID }} \
            --channel ${{ inputs.channel }}
```

ä½¿ç”¨å¯é‡ç”¨å·¥ä½œæµ:

```yaml
# .github/workflows/deploy.yml
name: Deploy App

on:
  push:
    branches: [main, develop]

jobs:
  deploy-dev:
    if: github.ref == 'refs/heads/develop'
    uses: ./.github/workflows/reusable-capgo-deploy.yml
    with:
      environment: development
      channel: development
    secrets:
      CAPGO_TOKEN: ${{ secrets.CAPGO_TOKEN }}
      CAPGO_APP_ID: ${{ secrets.CAPGO_APP_ID }}

  deploy-prod:
    if: github.ref == 'refs/heads/main'
    uses: ./.github/workflows/reusable-capgo-deploy.yml
    with:
      environment: production
      channel: production
    secrets:
      CAPGO_TOKEN: ${{ secrets.CAPGO_TOKEN }}
      CAPGO_APP_ID: ${{ secrets.CAPGO_APP_ID }}
```

## ä¸‹ä¸€æ­¥

- äº†è§£[æ¸ é“](/docs/live-updates/channels/)ä»¥ç®¡ç†ä¸åŒçš„éƒ¨ç½²ç¯å¢ƒ
- æ¢ç´¢[è‡ªå®šä¹‰å­˜å‚¨](/docs/live-updates/custom-storage/)ä»¥è¿›è¡Œé«˜çº§éƒ¨ç½²åœºæ™¯
- è®¾ç½®[åŠ å¯†](/docs/live-updates/encryption/)ä»¥è¿›è¡Œå®‰å…¨éƒ¨ç½²
- é…ç½®[æ›´æ–°è¡Œä¸º](/docs/live-updates/update-behavior/)ä»¥è‡ªå®šä¹‰æ›´æ–°çš„åº”ç”¨æ–¹å¼

é€šè¿‡ GitHub Actions é›†æˆ,æ‚¨å¯ä»¥åˆ©ç”¨ GitHub å¼ºå¤§çš„ CI/CD å¹³å°ä¸º Capgo Live Updates åˆ›å»ºå¤æ‚çš„éƒ¨ç½²å·¥ä½œæµ,å¹¶å†…ç½®å®‰å…¨æ€§ã€ç›‘æ§å’Œåä½œåŠŸèƒ½ã€‚
