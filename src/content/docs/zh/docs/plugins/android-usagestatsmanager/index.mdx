---
title: "@capgo/capacitor-android-usagestatsmanager"
locale: zh
description: é€‚ç”¨äº Capacitor åº”ç”¨çš„ Android ä½¿ç”¨ç»Ÿè®¡æ’ä»¶ï¼Œå…·æœ‰åº”ç”¨ä½¿ç”¨è·Ÿè¸ªã€å±å¹•æ—¶é—´ç›‘æ§å’Œä½¿ç”¨åˆ†æåŠŸèƒ½ã€‚
tableOfContents: false
next: false
prev: false
sidebar:
  order: 1
  label: "ä»‹ç»"
hero:
  tagline: è®¿é—® Android ä½¿ç”¨ç»Ÿè®¡æ•°æ®ä»¥ç›‘æ§åº”ç”¨ä½¿ç”¨æƒ…å†µã€å±å¹•æ—¶é—´å’Œå…·æœ‰ç³»ç»Ÿçº§æ•°æ®çš„ç”¨æˆ·è¡Œä¸ºåˆ†æã€‚
  image:
    file: ~public/icons/plugins/android-usagestatsmanager.svg
  actions:
    - text: å¼€å§‹ä½¿ç”¨
      link: /docs/plugins/android-usagestatsmanager/getting-started/
      icon: right-arrow
      variant: primary
    - text: Github
      link: https://github.com/Cap-go/capacitor-android-usagestatsmanager/
      icon: external
      variant: minimal
---

import { Card, CardGrid } from '@astrojs/starlight/components';

## æ¦‚è¿°

Capacitor Android Usage Stats Manager æ’ä»¶å°† Android çš„ UsageStatsManager SDK å…¬å¼€ç»™ Capacitor åº”ç”¨ç¨‹åºï¼Œä½¿å…¶èƒ½å¤Ÿè®¿é—®è¯¦ç»†çš„åº”ç”¨ä½¿ç”¨ç»Ÿè®¡æ•°æ®å’Œè®¾å¤‡ä½¿ç”¨æ•°æ®ã€‚æ­¤æ’ä»¶å…è®¸å¼€å‘äººå‘˜è·Ÿè¸ªåº”ç”¨ä½¿ç”¨æ¨¡å¼ã€å±å¹•æ—¶é—´å’Œ Android è®¾å¤‡ä¸Šçš„ç”¨æˆ·è¡Œä¸ºåˆ†æã€‚

<CardGrid stagger>
  <Card title="ä½¿ç”¨ç»Ÿè®¡" icon="rocket">
    è®¿é—® Android UsageStatsManager SDK æ•°æ® ğŸ“±
  </Card>
  <Card title="åº”ç”¨ç›‘æ§" icon="moon">
    è·Ÿè¸ªå•ä¸ªåº”ç”¨çš„ä½¿ç”¨æ—¶é—´å’Œé¢‘ç‡ ğŸ•
  </Card>
  <Card title="æƒé™ç®¡ç†" icon="approve-check">
    æ— ç¼å¤„ç†ä½¿ç”¨ç»Ÿè®¡æƒé™ ğŸ›¡ï¸
  </Card>
  <Card title="åŒ…ä¿¡æ¯" icon="puzzle">
    æŸ¥è¯¢å·²å®‰è£…åŒ…çš„è¯¦ç»†ä¿¡æ¯å’Œå…ƒæ•°æ® ğŸ“¦
  </Card>
</CardGrid>

## å®‰è£…

```bash
npm install @capgo/capacitor-android-usagestatsmanager
npx cap sync
```

## æ‰€éœ€æƒé™

å°†è¿™äº›æƒé™æ·»åŠ åˆ°æ‚¨çš„ `android/app/src/main/AndroidManifest.xml`ï¼š

```xml
<uses-permission android:name="android.permission.PACKAGE_USAGE_STATS" />
<uses-permission android:name="android.permission.QUERY_ALL_PACKAGES" />
```

## æ ¸å¿ƒ API æ–¹æ³•

### ä½¿ç”¨ç»Ÿè®¡
- `queryAndAggregateUsageStats(options)` - æ£€ç´¢å·²å®‰è£…åº”ç”¨çš„è¯¦ç»†ä½¿ç”¨ç»Ÿè®¡æ•°æ®
- `isUsageStatsPermissionGranted()` - æ£€æŸ¥æ˜¯å¦æˆäºˆäº†ä½¿ç”¨ç»Ÿè®¡æƒé™
- `openUsageStatsSettings()` - æ‰“å¼€ç”¨äºä½¿ç”¨ç»Ÿè®¡æƒé™çš„ç³»ç»Ÿè®¾ç½®

### åŒ…ä¿¡æ¯
- `queryAllPackages()` - è·å–æ‰€æœ‰å·²å®‰è£…åŒ…çš„ä¿¡æ¯

## ä½¿ç”¨ç¤ºä¾‹

```typescript
import { AndroidUsageStatsManager } from '@capgo/capacitor-android-usagestatsmanager';

// æ£€æŸ¥æ˜¯å¦æˆäºˆäº†æƒé™
const permissionResult = await AndroidUsageStatsManager.isUsageStatsPermissionGranted();
if (!permissionResult.granted) {
  // æ‰“å¼€è®¾ç½®ä»¥æˆäºˆæƒé™
  await AndroidUsageStatsManager.openUsageStatsSettings();
  return;
}

// æŸ¥è¯¢ä½¿ç”¨ç»Ÿè®¡æ•°æ®
const statsOptions = {
  intervalType: 0, // INTERVAL_DAILY
  startTime: Date.now() - (7 * 24 * 60 * 60 * 1000), // 7 å¤©å‰
  endTime: Date.now()
};

const usageStats = await AndroidUsageStatsManager.queryAndAggregateUsageStats(statsOptions);
console.log('Usage statistics:', usageStats);

// è·å–æ‰€æœ‰å·²å®‰è£…çš„åŒ…
const packages = await AndroidUsageStatsManager.queryAllPackages();
console.log('Installed packages:', packages);
```

## æƒé™å¤„ç†

è¯¥æ’ä»¶éœ€è¦æ— æ³•é€šè¿‡æ­£å¸¸çš„è¿è¡Œæ—¶æƒé™è¯·æ±‚æˆäºˆçš„ç‰¹æ®Šæƒé™ï¼š

1. **PACKAGE_USAGE_STATS**ï¼šå…è®¸è®¿é—®ä½¿ç”¨ç»Ÿè®¡æ•°æ®
2. **QUERY_ALL_PACKAGES**ï¼šåŒ…ä¿¡æ¯æ‰€éœ€ï¼ˆAndroid 11+ï¼‰

ç”¨æˆ·å¿…é¡»é€šè¿‡ç³»ç»Ÿè®¾ç½®æ‰‹åŠ¨æˆäºˆè¿™äº›æƒé™ã€‚ä½¿ç”¨ `openUsageStatsSettings()` å°†ç”¨æˆ·å¼•å¯¼åˆ°é€‚å½“çš„è®¾ç½®é¡µé¢ã€‚

## æ•°æ®ç±»å‹

### ä½¿ç”¨ç»Ÿè®¡
- åº”ç”¨ä½¿ç”¨æ—¶é—´å’Œé¢‘ç‡
- é¦–æ¬¡å’Œæœ€åä¸€æ¬¡ä½¿ç”¨æ—¶é—´
- å‰å°æ€»æ—¶é—´
- å¯åŠ¨æ¬¡æ•°

### åŒ…ä¿¡æ¯
- åŒ…åå’Œç‰ˆæœ¬
- å®‰è£…æ—¶é—´
- åº”ç”¨æ ‡ç­¾å’Œå›¾æ ‡
- ç³»ç»Ÿåº”ç”¨ä¸ç”¨æˆ·åº”ç”¨

## ä½¿ç”¨åœºæ™¯

- **æ•°å­—å¥åº·åº”ç”¨**ï¼šç›‘æ§å±å¹•æ—¶é—´å’Œåº”ç”¨ä½¿ç”¨æƒ…å†µ
- **å®¶é•¿æ§åˆ¶**ï¼šè·Ÿè¸ªå„¿ç«¥çš„è®¾å¤‡ä½¿ç”¨æƒ…å†µ
- **ç”Ÿäº§åŠ›åº”ç”¨**ï¼šåˆ†æå·¥ä½œæ¨¡å¼å’Œä¸“æ³¨æ—¶é—´
- **åˆ†æ**ï¼šäº†è§£ç”¨æˆ·è¡Œä¸ºå’Œåº”ç”¨å‚ä¸åº¦

## Android å…¼å®¹æ€§

- **æœ€ä½ Android ç‰ˆæœ¬**ï¼šAPI level 21ï¼ˆAndroid 5.0ï¼‰
- **é«˜çº§åŠŸèƒ½**ï¼šAPI level 29+ï¼ˆAndroid 10+ï¼‰ä»¥è·å¾—å¢å¼ºçš„ç»Ÿè®¡æ•°æ®
- **åŒ…æŸ¥è¯¢**ï¼šAPI level 30+ï¼ˆAndroid 11+ï¼‰éœ€è¦ QUERY_ALL_PACKAGES

## å®‰å…¨æ³¨æ„äº‹é¡¹

- ä½¿ç”¨ç»Ÿè®¡æƒé™æ˜¯æ•æ„Ÿçš„ï¼Œéœ€è¦ç”¨æˆ·åŒæ„
- æ”¶é›†ä½¿ç”¨æ•°æ®æ—¶è€ƒè™‘ç”¨æˆ·éšç§
- å®æ–½é€‚å½“çš„æ•°æ®å¤„ç†å’Œå­˜å‚¨å®è·µ
- éµå¾ª Google Play çš„ä½¿ç”¨æ•°æ®æ”¶é›†æ”¿ç­–

## æ–‡æ¡£

æŸ¥çœ‹[å®Œæ•´æ–‡æ¡£](/docs/plugins/android-usagestatsmanager/getting-started/)ä»¥è·å–è¯¦ç»†çš„å®ç°æŒ‡å—å’Œé«˜çº§ä½¿ç”¨æ¨¡å¼ã€‚
