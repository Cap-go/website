---
title: 部署实时更新
locale: zh
description: "了解如何使用 Capgo 的实时更新功能向您的应用部署实时更新,实现实时 UI 和逻辑更新,无需应用商店重新提交。"
sidebar:
  order: 4
---
import { Steps, LinkCard, Tabs, TabItem } from '@astrojs/starlight/components';

使用 Capgo 的实时更新功能远程、实时更新应用的 UI 和业务逻辑。直接向用户推送 JS bundle 更新,无需通过应用商店即可立即修复错误和发布新功能。

本指南假设您已完成 [Capgo 快速入门](/docs/getting-started/quickstart)并已经:

<Steps>

1. 在 Capacitor 应用中安装了 `@capgo/capacitor-updater` SDK

2. 在 `capacitor.config.ts` 中配置了应用 ID 和更新渠道

3. 在代码中添加了 `CapacitorUpdater.notifyAppReady()` 方法

</Steps>

如果您还没有完成这些步骤,请返回并首先完成快速入门。

<LinkCard href="/docs/getting-started/add-an-app/" title="添加应用" description="将应用添加到您的 Capgo 账户,并在应用中安装插件" />

## 上传 Bundle

安装并配置好 Capgo SDK 后,您就可以上传第一个实时更新 bundle 了:

1. 构建您的 Web 资源:
   ```shell
   npm run build
   ```

2. 将 bundle 上传到 Capgo:
    <Tabs>
      <TabItem label="控制台">
        ```shell
      npx @capgo/cli@latest bundle upload --channel=production
      ```
      </TabItem>
      <TabItem label="Github Actions">
      ```yml
      // .github/workflows/build_and_deploy.yml
    name: Build source code and send to Capgo

    concurrency:
      group: ${{ github.workflow }}-${{ github.ref }}
      cancel-in-progress: true

    on:
      push:
        branches:
          - main

    jobs:
      deploy_to_capgo:
        runs-on: ubuntu-latest
        steps:
          - name: Checkout
            uses: actions/checkout@v6
          - uses: actions/setup-node@v6
            with:
              node-version: '24'
          - name: Install dependencies
            run: npm install
          - name: Build
            run: npm run build
          - name: Deploy to Capgo
            run: npx @capgo/cli@latest bundle upload -a ${{ secrets.CAPGO_TOKEN }} --channel ${{ env.CHANNEL }}
            env:
              CAPGO_TOKEN: ${{ secrets.CAPGO_TOKEN }}
      ```
      </TabItem>
      <TabItem label="Gitlab">
      ```yml
      // .gitlab-ci.yml
      stages:
        - build

      build:
        stage: build
        image: node:18
        cache:
          - key:
              files:
                - package-lock.json
            paths:
              - .node_modules/
        script:
          - npm install
          - npm run build
          - npx @capgo/cli@latest bundle upload -a $CAPGO_TOKEN --channel $CAPGO_CHANNEL
        artifacts:
          paths:
            - node_modules/
            - dist/
        only:
          - master
      ```
      </TabItem>
    </Tabs>
   这将上传新的 bundle 版本到命令中指定的渠道。

### 上传故障排除

如果上传失败,请仔细检查:
- `capacitor.config.ts` 中的应用 ID 与 Capgo 仪表板中的应用匹配
- 您从 Capacitor 项目的根目录运行上传命令
- 您的 Web 资源已构建且是最新的

如果您仍然遇到问题,请转到[故障排除](/docs/getting-started/troubleshooting/)部分。

## 在设备上接收更新

上传 bundle 后,您可以在设备上测试实时更新:

1. 将应用同步到设备:
   ```shell
   npx cap sync ios
   ```

2. 打开另一个终端并运行以下命令以检查更新状态:
   ```shell
   npx @capgo/cli@latest app debug
   ```

3. 在本地运行您的应用:
   ```shell
   npx cap run ios
   ```
   或在 Xcode/Android Studio 中打开 iOS/Android 项目并执行原生运行。

4. 保持应用打开约 30 秒,以允许更新在后台下载。

5. 日志将需要几秒钟更新并显示更新状态。

6. 关闭并重新打开应用。您应该看到实时更新已应用!

请参考 [Capgo 快速入门](/docs/getting-started/quickstart#receiving-a-live-update-on-a-device)以获取有关测试实时更新的更多详细信息。

## 后续步骤

恭喜您使用 Capgo 部署了第一个实时更新!

要了解更多信息,请查看其余的 [Capgo 实时更新文档](/docs/live-updates)。一些需要查看的关键主题:
- [使用渠道定位更新](/docs/live-updates/channels)
- [自定义更新行为](/docs/live-updates/update-behavior)
- [实时更新回滚](/docs/live-updates/rollbacks)
