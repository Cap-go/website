---
title: iOS Builds
description: Configure and build iOS apps with Capgo Cloud Build
sidebar:
  order: 2
---

import { Steps, Aside, Card, CardGrid } from '@astrojs/starlight/components';

Build and submit iOS apps to TestFlight and the App Store using Capgo's dedicated Mac infrastructure.

## What you will learn

 - You will learn how to upload your app via Capgo Native build
 - You will learn how to configure the certificates for Capgo Native Build

## Prerequisites

 - A Capgo account with an active subscription
 - Your app already registered in Capgo (run `npx @capgo/cli@latest app add` if not)
 - A Mac computer with Xcode installed (it's possible to setup the build on a linux/windows machine, but it's yet documented)
 - Valid Apple Developer account ($99/year) (You must have admin or owner rights on the Applle Developer account)
 - Your app must be able to build successfully via Xcode
 - A Capacitor app
 - A configured icon for the app. Apps without an icon cannot be uploaded to the App Store.
 
 :::note
 I will use the following app for the tutorial: https://github.com/Cap-go/capgo-native-build-tutorial-app
 :::


## The first manual build

Before we can start thinking about building the app with Capgo, we should first set it up, and do a first testflight build by hand.
There are some advantages to doing a manual build first:

- You will setup the distribution certificate on your local machine
- You will create the appstore record if you haven't done it yet
- You will be able to figure out any issues with the build process linked to your app code

Before we can begin, you must have the deployment certificate installed on your local machine.
This is quite a bit complex, but I will explain it bellow.

### Setting up the deployment certificate

<Steps>
1. Open Xcode
2. Click on `XCode` -> `Settings`
    Alternatively, you can use the shortcut `Cmd + ,`

    ![Xcode settings](/native-build-assets/xcode-settings.webp)
3. Go to `Apple Accounts`
    ![Xcode apple accounts](/native-build-assets/xcode-apple-accounts.webp)
4. Find the Apple Account that is added to the Apple Developer Account
    ![Xcode selected apple account](/native-build-assets/xcode-selected-account.webp)
5. Find the team that you will use to deploy the app
    ![Xcode find team](/native-build-assets/xcode-find-team.webp)
6. Click on the `Manage Certificates` button
    ![Xcode manage certificates](/native-build-assets/xcode-manage-certificates.webp)
7. Make sure you can see the deployment certificate in the list
    ![Xcode deployment certificate](/native-build-assets/xcode-deployment-certificate.webp)
8. If you do not, you need to create a new certificate

    :::note
      Apple limits the numbers of deployment certificates you can have to 3. If you have more than 3 certificates, you need to delete one in order to create a new one. I will not convert that in the tutorial.
    :::

    1. Click on the `+` button and then on `Apple distribution`
        ![Xcode add certificate](/native-build-assets/xcode-add-certificate.webp)
    2. The certificate will be created automatically. You can see it in the list. Look at the previous step to confirm that you see it.
</Steps>

Now that you have the deployment certificate installed, you can begin the build process.

### Manual build to Testflight

<Steps>
  1. Open the app in Xcode

      Run `npx cap open ios` to open the app in Xcode.

  2. Find and click on the `archive` button

      In the Xcode toolbar, find and click on the `product` -> `archive` button.

      ![Xcode toolbar](/native-build-assets/xcode-toolbar.webp)
  3. Wait for the build to complete
  4. Click on the `Distribute App` button

      ![Xcode distribute button](/native-build-assets/xcode-distribue-app.webp)
  5. Select `TestFlight Internal Only` as the distribution method and click on `Distribute` button

      ![Xcode TestFlight internal only distribution method](/native-build-assets/xcode-distribue-testflight-1.webp)
  6. Configure the app record

      Fill in the following fields:
        1. Name: The name of your app - visible in the App Store
        2. SKU - the SKU of your app - this is used to identify your app in the App Store
        3. The primary language - the primary language of your app

      Then, click on the `next` button

      ![Xcode TestFlight configure app record](/native-build-assets/xcode-configure-app-record-testflight.webp)

    7. If the creation of the app record fails, try to close the window and try to archive the app again.

    8. Wait for the upload to complete

    9. If everything went well, you should see the following screen
      ![Xcode TestFlight upload complete](/native-build-assets/xcode-upload-complete-testflight.webp)
    10. Click on the `Done` button
</Steps>  


You may instinctively think that all is good now and that you will be able to see your app in Testflight now, but there are a few more things needed to be done before you can see your app in Testflight:

  1. You need to add yourself to TestFlight
  2. You need to promise Apple that your app doesn't use any non-standard (like a custom algorithm) encryption. If you app does use any non-standard encryption, I suggest reading the [Apple documentation](https://developer.apple.com/help/app-store-connect/manage-app-information/overview-of-export-compliance) on how to handle this.

Let's start with the first one:

### Adding yourself to TestFlight

<Steps>
  1. Go to the [Appstore Connect](https://appstoreconnect.apple.com/) page
    ![Appstore Connect login page](/native-build-assets/appstore-connect-login.webp)
  2. Sign in with your Apple Developer account
  3. Select the team that you used when you created the app record. If you are only in one developer account, can skip this step.
    ![Appstore Connect team selection](/native-build-assets/appstore-connect-select-team.webp)
  4. Click on the `Apps` button
    ![Appstore Connect apps button](/native-build-assets/appstore-connect-apps-button.webp)
  5. Find the app you created in the previous step and click on it
    ![Appstore Connect app selection](/native-build-assets/appstore-connect-select-app.webp)
  6. Click on the `TestFlight` button
    ![Appstore Connect testflight button](/native-build-assets/appstore-connect-testflight-button.webp)
  7. Click on the `Internal Testers plus` button
    ![Appstore Connect internal testers plus button](/native-build-assets/appstore-connect-testflight-internal-testing-plus.webp)
  8. Create a new group

      I like to name the group "internal". You can name it whatever you want.

      ![Appstore Connect create new group](/native-build-assets/appstore-connect-testflight-internal-create-group.webp)
  9. Click on `Invite testers` button
    ![Appstore Connect invite testers button](/native-build-assets/appstore-connect-testflight-internal-invite-testers.webp)
  10. Add yourself to the group

      Find yourself in the list and select the checkbox next to your name. (You may need to refresh the page to see yourself)
      Then, click on the `Add` button.

      ![Appstore Connect invite tester checkbox](/native-build-assets/appstore-connect-testflight-internal-invite-tester-checkbox.webp)
  11. Verify that you are added to the group

      Now, you should see yourself in the group.

      ![Appstore Connect verify tester](/native-build-assets/appstore-connect-testflight-internal-verify-tester.webp)
</Steps>

Congratilations ðŸŽ‰
You have added yourself to testflight. Now, there is just one more thing 
you need to do before you can configure Capgo Native Build.

### Setting up the compliance information

You now need to promise Apple that your app doesn't use any non-standard (like a custom algorithm) encryption. If you app does use any non-standard encryption, I suggest reading the [Apple documentation](https://developer.apple.com/help/app-store-connect/manage-app-information/overview-of-export-compliance) on how to handle this.
There are two ways to do this:

1. You can do this by hand every time you build your app.
2. You can configure your plist file to automatically set this value to `false`.

Let's start with the first one:

<Steps>
  1. Follow all the steps from the previous section to find the TestFlight seciton in AppStore Connect
  2. Click on `Builds -> iOS`
    ![Appstore Connect builds iOS button](/native-build-assets/appstore-connect-builds-ios-button.webp)
  3. Find the build with missing compliance information and click on `Manage`
    ![Appstore Connect manage build](/native-build-assets/appstore-connect-manage-build.webp)
  4. Select the option that best describes your app

      For me, this is `none`, but it might be different for you.
      After, click save

      ![Appstore Connect save compliance information](/native-build-assets/appstore-connect-manage-build-compliance.webp)
  5. Your app should now say `ready to test`

      ![Appstore Connect ready to test](/native-build-assets/appstore-connect-ready-to-test.webp)
</Steps>

As for the second one, here are the steps:

<Steps>
  1. Open the `Info.plist` file
  2. Add the following key:

      ```xml
      <key>ITSAppUsesNonExemptEncryption</key>
      <false/>
      ```

  3. Save the file
</Steps>

:::note
[Here](https://developer.apple.com/documentation/security/complying-with-encryption-export-regulations) is the official Apple documentation on how to inform Apple of your compliance with encryption export regulations.
:::

### Installing the TestFlight app and accepting the invitation

Now, you are **ALMOST** ready to test your app in Testflight.
Before, you need to do the following things:

1. Download the [TestFlight app](https://apps.apple.com/us/app/testflight/id899247664) from the App Store on your iOS/iPadOS device
2. Accept the invitation to test your app

I will skip the details of how to install the TestFlight app on your device. If you are not sure how to install an app, google has some great guides on how to do it.

As for accepting the invitation, you will receive an email from Apple with a link to accept the invitation.

<Steps>

  1. Open the email from Apple with the link to accept the invitation
  2. Click on `View in TestFlight` button
    ![TestFlight email button](/native-build-assets/testflight-email-button.webp)
  3. Click on the `Install` button
    ![TestFlight install button](/native-build-assets/testflight-install-button.webp)
  4. Install the app on your device

      If you have installed the app previously using Xcode, you may see the following screen. Please click on the `install` button.
      ![TestFlight install app](/native-build-assets/testflight-install-app.webp)

  5. Wait for the app to install
  6. Click on the `Open` button and click it

      <video src="/native-build-assets/testflight-open-app.mp4" controls autoplay loop muted playsinline></video>
</Steps>

Congratulations ðŸŽ‰
You have accepted the invitation to test your app in Testflight. Now, you can configure Capgo Native Build to build and submit your app to Testflight.


## Configuring Capgo Native Build

There are a few things you need to configure in Capgo Native Build to be able to build and submit your app to Testflight.
Here is a list of the things you will pass to the Capgo CLI:

| Parameter | Description |
|-----------|-------------|
| `--platform` | The platform to build for (`ios`) |
| `--apple-team-id` | Your Apple Developer Team ID (found in [Apple Developer Portal](https://developer.apple.com/account)) |
| `--apple-key` | Path to your App Store Connect API Key file (`.p8` file) |
| `--apple-key-id` | The Key ID of your App Store Connect API Key |
| `--apple-issuer-id` | Your App Store Connect Issuer ID |
| `--certificate` | Path to your distribution certificate (`.p12` file) |
| `--provisioning-profile` | Path to your provisioning profile (`.mobileprovision` file) |
| `--apple-profile-name` | The name of your provisioning profile |

Example command:

```bash
npx @capgo/cli build credentials save \
  --platform ios \
  --apple-team-id YOUR_TEAM_ID \
  --apple-key '/path/to/AuthKey_XXXXX.p8' \
  --apple-key-id YOUR_KEY_ID \
  --apple-issuer-id YOUR_ISSUER_ID \
  --certificate '/path/to/certificate.p12' \
  --provisioning-profile '/path/to/profile.mobileprovision' \
  --apple-profile-name your-profile-name
```


### Team ID

Let's start with the team ID. Finding it is quite easy.

<Steps>
   1. Go to [Apple Developer Account](https://developer.apple.com/account/) and scroll down
   
   2. Find the `Team ID`
      <img src="/native-build-assets/apple_dev_team_id.png" alt="Team ID location in developer account" />
</Steps>


### Apple key, Apple key ID and Apple issuer ID

Now, let's move on to the Apple key.

<Steps>
   1. Go to [Appstore Connect user and access page](https://appstoreconnect.apple.com/access/users/)
      :::note
      For me the link sometimes doesn't work. Reload the page it doesn't work for you.
      :::
   2. Select the correct team in the dropdown
      1. Click on your name in the top right corner
      2. Click on the team you want to use
        ![Apple Developer keys team selection](/native-build-assets/apple-developer-select-team.webp)
  3. Click on the `Integrations` button
      ![Appstore Connect integrations button](/native-build-assets/appstore-connect-integrations-button.webp)
  4. Find the `issuer`
      :::caution
      This **IS TO BE SAVED** - you will need it later
      :::

      Click on the `copy` button to copy the issuer
      ![Appstore Connect copy issuer](/native-build-assets/appstore-connect-copy-issuer.webp)
  5. Click on the plus button
    ![Appstore Connect add key button](/native-build-assets/appstore-connect-add-key-button.webp)
  6. Set the name of the key and set the access to `App manager` and click on the `Generate` button
    ![Appstore Connect add key name, set access to app manager and generate button](/native-build-assets/appstore-connect-add-key-name.webp)
  7. Save the key ID
      :::caution
      This **IS TO BE SAVED** - you will need it later
      :::

      ![Appstore Connect copy key ID](/native-build-assets/appstore-connect-copy-key-id.webp)
  8. Download the key
      :::caution
      This **IS TO BE SAVED** - you will need it later
      :::

      :::danger
      **NEVER SHARE THE KEY WITH ANYONE - USE IT ONLY IN THE CAPGO CLI**
      :::

      ![Appstore Connect download key](/native-build-assets/appstore-connect-download-key.webp)

      ![Appstore Connect download key warning](/native-build-assets/appstore-connect-download-key-warning.webp)
</Steps>

Congratulations ðŸŽ‰
You have created the Apple key, Apple key ID and Apple issuer ID.

### Certificate

Now, you are ready to export the certificate. As you remember, one of the first steps of this guide was setting up the deployment certificate.

However, Apple in their infinite wisdom, decided that the way you export the certificate is quite different from the way you create them ðŸ™ƒ
Let's get into setting it up:

<Steps>
   1. Open Keychain Access
      1. Click `Command + Space` to open the search bar
      2. Search for `Keychain Access`
      3. Click on the `Keychain Access` app


      <video 
        src="/native-build-assets/open-keychain-macos.mp4" 
        controls 
        autoplay 
        loop 
        muted 
        playsinline 
        aria-label="Demonstrati
        
        on of opening Keychain Access on macOS"
      ></video>
  2. Select the `login` category and click on the `My Certificates` button
    ![Keychain Access login category](/native-build-assets/keychain-access-login-category.webp)
  3. Find your certificate in the list
    
      The certificate should be named `Apple Distribution: [Your Name/Company] (your team ID)`
      ![Keychain Access find certificate](/native-build-assets/keychain-access-find-certificate.webp)
  4. Right-click on the certificate and select `Export`
    ![Keychain Access export certificate](/native-build-assets/keychain-access-export-certificate.webp)
  5. Save the certificate as a `.p12` file
      :::caution
      This **IS TO BE SAVED** - you will need it later
      :::

      1. Make sure to select a good name for the certificate file
      2. Make sure the file format is set to `Personal Information Exchange (.p12)`
      3. Click on the `Save` button

      ![Keychain Access save certificate dialog](/native-build-assets/keychain-access-save-certificate.webp)
  6. When asked for the password, **DO NOT SET IT**

      Click on the `OK` button without setting a password

      ![Keychain Access save certificate without password](/native-build-assets/keychain-access-save-certificate-password-dialog.webp)
  7. When asked for the "login keychain password", give the password you use to login to your Mac

      Give the password you use to login to your Mac. Then, click on the `Allow` button.

      ![Keychain Access save certificate login keychain password](/native-build-assets/keychain-access-save-certificate-login-keychain-password.webp)
</Steps>

Congratulations ðŸŽ‰
You have exported the certificate.

### Provisioning profile

Now, you are ready to export the provisioning profile. I promise, this this the last thing you will need to get from Apple.

<Steps>
   1. Go to [Apple Developer Profiles](https://developer.apple.com/account/resources/profiles/list)
   2. Select the correct team in the dropdown
      1. Click on your name in the top right corner
      2. Click on the team you want to use
        ![Apple Developer keys team selection](/native-build-assets/apple-developer-select-team.webp)
  3. Make sure you are on the correct page
      It should look like this, if it doesn't click on `profiles` in the sidebar
    
      ![Apple Developer profiles page](/native-build-assets/apple-developer-profiles-page.webp)
  4. Click on the `+` button
    ![Apple Developer add profile button](/native-build-assets/apple-developer-add-profile-button.webp)
  5. Select the profile type
      Select `App Store Connect` and click on the `Continue` button
      
      ![Apple Developer select profile type](/native-build-assets/apple-developer-select-profile-type.webp)
  6. Select the app you want to build

      Find your app in the dropdown and click on the `Continue` button

      ![Apple Developer select app](/native-build-assets/apple-developer-select-app.webp)
  7. Select the correct deployment certificate

      Select the certificate you exported in the previous step and click on the `Continue` button

      ![Apple Developer select deployment certificate](/native-build-assets/apple-developer-select-deployment-certificate.webp)

      If you are unsure which certificate to select, come back to keychain access and find the certificate you exported. Then look at the expiration date.
      
      ![Apple Developer select deployment certificate expiration date](/native-build-assets/apple-developer-select-deployment-certificate-expiration-date.webp)
  8. Name the profile

      Give the profile a name and click on the `Generate` button

      :::caution
      This name **IS TO BE SAVED** - you will need it later
      :::

      ![Apple Developer name profile](/native-build-assets/apple-developer-name-profile.webp)
  9. Download the profile

      Click on the `Download` button to download the profile

      :::caution
      This file **IS TO BE SAVED** - you will need it later
      :::

      ![Apple Developer download profile](/native-build-assets/apple-developer-name-provisioning-profile.webp)
</Steps>

Congratulations ðŸŽ‰
You have now got everything you need to configure Capgo Native Build.

:::caution
Never commit the credentials you just created to your repository.
Keep them safe! ðŸ”’
:::

### Running the configuration command

