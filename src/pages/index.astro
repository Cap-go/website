---
import Layout from '@/layouts/Layout.astro'
import { shortNumber } from '@/services/misc'
import Orgs from '@/components/Orgs.astro'
import ProblemSolution from '@/components/ProblemSolution.astro'
import Testimonials from '@/components/Testimonials.astro'
import SharedNumbers from '@/components/SharedNumbers.astro'
import Hero from '@/components/Hero.astro'
import Manifesto from '@/components/Manifesto.astro'
import * as m from '@/paraglide/messages'
import CompaniesLogo from '@/components/companies-logo.astro'
import HowItWorks from '@/components/HowItWorks.astro'
import GlobalInfrastructure from '@/components/GlobalInfrastructure.astro'
import MonitoringFeatures from '@/components/landing/MonitoringFeatures.astro'
import AutomationFeatures from '@/components/landing/AutomationFeatures.astro'
import BuiltForDevelopers from '@/components/BuiltForDevelopers.astro'
import { createLdJsonGraph, createServiceLdJson, createSoftwareApplicationLdJson } from '@/lib/ldJson'
import AppflowShutdown from '@/components/AppflowShutdown.astro'

const config = Astro.locals.runtimeConfig

const stats = {
  stars: shortNumber(645),
  apps: shortNumber(1400),
  updates: shortNumber(947593631),
}

const tmp = await fetch(`${config.public.baseApiUrl}/private/website_stats`)
if (tmp.ok) {
  const res = await tmp.json()
  if (res) {
    if (res.apps) stats.apps = shortNumber(res.apps)
    if (res.updates) stats.updates = shortNumber(res.updates)
    if (res.stars) stats.stars = shortNumber(res.stars)
  }
}

// Create comprehensive homepage content definition
const title = `${config.public.brand} - ${m.instant_updates_for_capacitor({}, { locale: Astro.locals.locale })}`
const description = m.ship_updates_fixes_changes_and_features({}, { locale: Astro.locals.locale })

// Create comprehensive LD+JSON for homepage
const capgoService = createServiceLdJson(config.public, {
  name: 'Capgo - Live Updates for Capacitor Apps',
  description: 'Instant over-the-air / CodePush updates for Capacitor mobile applications. Deploy OTA, bug fixes, feature updates, and improvements without app store delays.',
  url: config.public.baseUrl,
  serviceType: 'Software Development Service',
  areaServed: ['Worldwide'],
})

// Create SoftwareApplication schema for the Capgo platform
const capgoSoftware = createSoftwareApplicationLdJson(config.public, {
  name: 'Capgo Live Update Platform',
  description: 'Professional live update platform for Capacitor developers. Deploy updates instantly to iOS and Android apps.',
  url: config.public.baseUrl,
  applicationCategory: 'DeveloperApplication',
  operatingSystem: 'Web, iOS, Android',
  softwareVersion: '1.0',
  aggregateRating: {
    ratingValue: 4.8,
    reviewCount: parseInt(stats.apps.replace(/[^\d]/g, '')) || 1400,
  },
  offers: {
    price: '0',
    priceCurrency: 'USD',
    availability: 'https://schema.org/InStock',
  },
})

// Create comprehensive LD+JSON graph for homepage
const content = {
  title,
  description,
  image: `${config.public.baseUrl}/capgo_social.png`,
  ldJSON: createLdJsonGraph(config.public, capgoService, {
    includeOrganization: true,
    includeBreadcrumbs: true,
    breadcrumbs: [
      {
        name: 'Home',
        url: config.public.baseUrl,
      },
      {
        name: 'Platform',
        url: `${config.public.baseUrl}/app_mobile/`,
      },
      {
        name: 'Pricing',
        url: `${config.public.baseUrl}/pricing/`,
      },
      {
        name: 'Documentation',
        url: `${config.public.baseUrl}/docs/`,
      },
    ],
  }),
}

// Add the SoftwareApplication to the graph
content.ldJSON['@graph'].push(capgoSoftware)

---

<Layout content={content}>
  <div>
    <Hero />
    <!-- <CompaniesLogo /> -->
    <ProblemSolution />
    <Manifesto />
    <HowItWorks />
    <MonitoringFeatures />
    <AutomationFeatures />
    <GlobalInfrastructure />
    <BuiltForDevelopers />
    <SharedNumbers />
    <Testimonials />
    <Orgs />
    <AppflowShutdown />
  </div>



  <style is:global>
    /* Minimum required CSS for animations */
    .teleport-line-animation {
      left: -100%;
      background: rgba(56, 189, 248, 0.3);
      animation: teleport-line 5s cubic-bezier(0.1, 0.9, 0.2, 1) infinite;
    }

    @keyframes teleport-line {
      0% {
        transform: translateX(0) scaleX(0.1);
        opacity: 0;
      }
      10% {
        opacity: 0.5;
      }
      100% {
        transform: translateX(200%) scaleX(1);
        opacity: 0;
      }
    }

    /* Portal glow effect */
    .portal-glow-animation {
      background: rgba(56, 189, 248, 0.12);
      filter: blur(20px);
      animation: portal-pulse 8s ease-in-out infinite;
    }

    @keyframes portal-pulse {
      0%,
      100% {
        opacity: 0.5;
        transform: translateY(-50%) scale(1);
      }
      50% {
        opacity: 0.7;
        transform: translateY(-50%) scale(1.1);
      }
    }

    /* Vertical data streams */
    .data-stream-animation {
      top: -100%;
      background: rgba(56, 189, 248, 0.25);
      animation: data-stream 8s linear infinite;
    }

    @keyframes data-stream {
      0% {
        transform: translateY(0);
        opacity: 0;
      }
      10% {
        opacity: 0.5;
      }
      100% {
        transform: translateY(200%);
        opacity: 0;
      }
    }

    @keyframes teleport-button {
      0% {
        transform: translateX(0) skewX(-20deg);
        opacity: 0;
      }
      10% {
        opacity: 0.5;
      }
      100% {
        transform: translateX(200%) skewX(-20deg);
        opacity: 0;
      }
    }


  </style>
</Layout>
